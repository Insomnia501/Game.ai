"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/inference/chat/route";
exports.ids = ["app/api/inference/chat/route"];
exports.modules = {

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Finference%2Fchat%2Froute&page=%2Fapi%2Finference%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Finference%2Fchat%2Froute.ts&appDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Finference%2Fchat%2Froute&page=%2Fapi%2Finference%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Finference%2Fchat%2Froute.ts&appDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_daniel_Code_10_project_Game_server_app_api_inference_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/inference/chat/route.ts */ \"(rsc)/./app/api/inference/chat/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/inference/chat/route\",\n        pathname: \"/api/inference/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/inference/chat/route\"\n    },\n    resolvedPagePath: \"/Users/daniel/Code/10_project/Game/server/app/api/inference/chat/route.ts\",\n    nextConfigOutput,\n    userland: _Users_daniel_Code_10_project_Game_server_app_api_inference_chat_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/inference/chat/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZpbmZlcmVuY2UlMkZjaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZpbmZlcmVuY2UlMkZjaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGaW5mZXJlbmNlJTJGY2hhdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmRhbmllbCUyRkNvZGUlMkYxMF9wcm9qZWN0JTJGR2FtZSUyRnNlcnZlciUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZkYW5pZWwlMkZDb2RlJTJGMTBfcHJvamVjdCUyRkdhbWUlMkZzZXJ2ZXImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3lCO0FBQ3RHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdhbWUtYWkvc2VydmVyLz9iZDZiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9kYW5pZWwvQ29kZS8xMF9wcm9qZWN0L0dhbWUvc2VydmVyL2FwcC9hcGkvaW5mZXJlbmNlL2NoYXQvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2luZmVyZW5jZS9jaGF0L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvaW5mZXJlbmNlL2NoYXRcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2luZmVyZW5jZS9jaGF0L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2RhbmllbC9Db2RlLzEwX3Byb2plY3QvR2FtZS9zZXJ2ZXIvYXBwL2FwaS9pbmZlcmVuY2UvY2hhdC9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvaW5mZXJlbmNlL2NoYXQvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Finference%2Fchat%2Froute&page=%2Fapi%2Finference%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Finference%2Fchat%2Froute.ts&appDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/inference/chat/route.ts":
/*!*****************************************!*\
  !*** ./app/api/inference/chat/route.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/mongodb */ \"(rsc)/./lib/mongodb.ts\");\n/* harmony import */ var _lib_dify__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/dify */ \"(rsc)/./lib/dify.ts\");\n/* harmony import */ var _lib_address_utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/address-utils */ \"(rsc)/./lib/address-utils.ts\");\n/**\n * AI 健康咨询 API 路由\n *\n * 功能：\n * 1. 检查用户订阅状态\n * 2. 调用 Dify API 获取 AI 回答\n * 3. 返回回答结果\n *\n * 请求方式: POST /api/inference/chat\n *\n * 请求体格式:\n * {\n *   \"userAddress\": \"0x...\",\n *   \"question\": \"我每天睡6小时够吗？\",\n *   \"conversationId\": \"uuid\" // 可选，用于多轮对话\n * }\n *\n * 响应格式:\n * {\n *   \"answer\": \"根据健康研究...\",\n *   \"conversationId\": \"uuid\",\n *   \"subscriptionStatus\": {\n *     \"isActive\": true,\n *     \"daysRemaining\": 15\n *   }\n * }\n */ \n\n\n\n/**\n * 验证用户订阅状态\n * 检查数据库中的订阅记录是否有效\n */ async function checkSubscription(userAddress) {\n    try {\n        const db = await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectDB)();\n        const subscription = await db.collection(\"subscriptions\").findOne({\n            userAddress,\n            status: \"active\"\n        });\n        if (!subscription) {\n            return {\n                isActive: false,\n                error: \"No active subscription found\"\n            };\n        }\n        const now = Math.floor(Date.now() / 1000) // 转换为秒级 Unix 时间戳\n        ;\n        const isExpired = subscription.expiresAt < now;\n        if (isExpired) {\n            return {\n                isActive: false,\n                error: \"Subscription has expired\"\n            };\n        }\n        const daysRemaining = Math.ceil((subscription.expiresAt - now) / (24 * 3600));\n        return {\n            isActive: true,\n            expiresAt: subscription.expiresAt,\n            daysRemaining,\n            transactionHash: subscription.transactionHash,\n            startedAt: subscription.startedAt\n        };\n    } catch (error) {\n        console.error(\"[Chat API] 订阅状态检查失败:\", error);\n        return {\n            isActive: false,\n            error: \"Failed to check subscription status\"\n        };\n    }\n}\n/**\n * 处理 POST 请求\n */ async function POST(request) {\n    try {\n        const body = await request.json();\n        const { userAddress, question, conversationId } = body;\n        // 参数验证\n        if (!userAddress || !question) {\n            console.warn(\"[Chat API] 缺少必需参数: userAddress 或 question\");\n            return corsJson({\n                error: \"Missing required parameters: userAddress and question\"\n            }, {\n                status: 400\n            });\n        }\n        // 验证地址格式\n        if (!(0,_lib_address_utils__WEBPACK_IMPORTED_MODULE_3__.isValidAddress)(userAddress)) {\n            console.warn(\"[Chat API] 无效的钱包地址:\", userAddress);\n            return corsJson({\n                error: \"Invalid wallet address format\"\n            }, {\n                status: 400\n            });\n        }\n        const normalizedAddress = (0,_lib_address_utils__WEBPACK_IMPORTED_MODULE_3__.normalizeAddress)(userAddress);\n        // 验证问题长度\n        if (typeof question !== \"string\" || question.trim().length === 0) {\n            console.warn(\"[Chat API] 问题内容无效\");\n            return corsJson({\n                error: \"Question must be a non-empty string\"\n            }, {\n                status: 400\n            });\n        }\n        if (question.length > 2000) {\n            console.warn(\"[Chat API] 问题内容过长\");\n            return corsJson({\n                error: \"Question must be less than 2000 characters\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(\"[Chat API] 收到请求 | 用户:\", normalizedAddress, \"| 问题长度:\", question.length);\n        if (conversationId) {\n            console.log(\"[Chat API] 对话ID:\", conversationId);\n        }\n        // 1. 检查订阅状态\n        console.log(\"[Chat API] 检查订阅状态...\");\n        const subscriptionStatus = await checkSubscription(normalizedAddress);\n        if (!subscriptionStatus.isActive) {\n            console.warn(\"[Chat API] 订阅验证失败:\", subscriptionStatus.error);\n            return corsJson({\n                error: subscriptionStatus.error,\n                code: \"SUBSCRIPTION_INACTIVE\"\n            }, {\n                status: 403\n            });\n        }\n        console.log(\"[Chat API] 订阅有效 | 剩余天数:\", subscriptionStatus.daysRemaining);\n        // 2. 初始化 Dify 客户端\n        const apiKey = process.env.DIFY_API_KEY;\n        if (!apiKey) {\n            console.error(\"[Chat API] DIFY_API_KEY 环境变量未配置\");\n            return corsJson({\n                error: \"AI service is not properly configured\",\n                code: \"CONFIG_ERROR\"\n            }, {\n                status: 500\n            });\n        }\n        const difyClient = (0,_lib_dify__WEBPACK_IMPORTED_MODULE_2__.createDifyClient)(apiKey);\n        // 3. 调用 Dify API\n        console.log(\"[Chat API] 调用 Dify API...\");\n        let difyResponse;\n        try {\n            difyResponse = await difyClient.sendMessage(question, normalizedAddress, conversationId);\n        } catch (difyError) {\n            console.error(\"[Chat API] Dify API 调用失败:\", difyError.message);\n            // 处理特定的 Dify 错误\n            if (difyError.response?.status === 401) {\n                return corsJson({\n                    error: \"AI service authentication failed\",\n                    code: \"DIFY_AUTH_FAILED\"\n                }, {\n                    status: 401\n                });\n            }\n            if (difyError.response?.status === 429) {\n                return corsJson({\n                    error: \"AI service rate limit exceeded, please try again later\",\n                    code: \"DIFY_RATE_LIMITED\"\n                }, {\n                    status: 429\n                });\n            }\n            throw difyError;\n        }\n        console.log(\"[Chat API] Dify 响应成功\");\n        // 4. 保存对话记录到 MongoDB（可选但推荐）\n        try {\n            const db = await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectDB)();\n            await db.collection(\"chat_logs\").insertOne({\n                userAddress: normalizedAddress,\n                question,\n                answer: difyResponse.answer,\n                conversationId: difyResponse.conversation_id,\n                messageId: difyResponse.message_id,\n                taskId: difyResponse.task_id,\n                timestamp: new Date(),\n                metadata: difyResponse.metadata\n            });\n            console.log(\"[Chat API] 对话记录已保存到 MongoDB\");\n        } catch (logError) {\n            console.warn(\"[Chat API] 对话记录保存失败 (非致命错误):\", logError);\n        // 不中断请求，只记录警告\n        }\n        // 5. 返回响应\n        return corsJson({\n            answer: difyResponse.answer,\n            conversationId: difyResponse.conversation_id,\n            messageId: difyResponse.message_id,\n            taskId: difyResponse.task_id,\n            subscriptionStatus: {\n                isActive: subscriptionStatus.isActive,\n                daysRemaining: subscriptionStatus.daysRemaining\n            }\n        }, {\n            status: 200\n        });\n    } catch (error) {\n        console.error(\"[Chat API] 处理请求失败:\", error);\n        // 处理网络/超时错误\n        if (error instanceof Error) {\n            if (error.message.includes(\"ECONNREFUSED\") || error.message.includes(\"ENOTFOUND\")) {\n                return corsJson({\n                    error: \"Failed to connect to AI service\",\n                    code: \"SERVICE_UNAVAILABLE\"\n                }, {\n                    status: 503\n                });\n            }\n            if (error.message.includes(\"timeout\") || error.message.includes(\"ETIMEDOUT\")) {\n                return corsJson({\n                    error: \"Request to AI service timed out, please try again\",\n                    code: \"REQUEST_TIMEOUT\"\n                }, {\n                    status: 504\n                });\n            }\n        }\n        return corsJson({\n            error: \"Failed to process chat request\",\n            code: \"INTERNAL_ERROR\",\n            details: error instanceof Error ? error.message : \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * 处理 OPTIONS 请求（用于 CORS 预检）\n */ async function OPTIONS() {\n    return corsJson(null, {\n        status: 200\n    });\n}\nfunction corsJson(body, init) {\n    const response = body === null ? new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(null, init) : next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(body, init);\n    response.headers.set(\"Access-Control-Allow-Origin\", \"*\");\n    response.headers.set(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n    response.headers.set(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n    response.headers.set(\"Access-Control-Allow-Credentials\", \"true\");\n    return response;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUk7WUFFbEI7UUFDRjtRQUVBLE9BQU9xQixTQUNMO1lBQ0VuQixPQUFPO1lBQ1B5QixNQUFNO1lBQ051QixTQUFTaEQsaUJBQWlCOEMsUUFBUTlDLE1BQU1rQyxPQUFPLEdBQUc7UUFDcEQsR0FDQTtZQUFFcEMsUUFBUTtRQUFJO0lBRWxCO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLGVBQWVtRDtJQUNwQixPQUFPOUIsU0FBUyxNQUFNO1FBQUVyQixRQUFRO0lBQUk7QUFDdEM7QUFFQSxTQUFTcUIsU0FBU0wsSUFBUyxFQUFFb0MsSUFBbUI7SUFDOUMsTUFBTWYsV0FBV3JCLFNBQVMsT0FDdEIsSUFBSTNCLHFEQUFZQSxDQUFDLE1BQU0rRCxRQUN2Qi9ELHFEQUFZQSxDQUFDNEIsSUFBSSxDQUFDRCxNQUFNb0M7SUFDNUJmLFNBQVNnQixPQUFPLENBQUNDLEdBQUcsQ0FBQywrQkFBK0I7SUFDcERqQixTQUFTZ0IsT0FBTyxDQUFDQyxHQUFHLENBQUMsZ0NBQWdDO0lBQ3JEakIsU0FBU2dCLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGdDQUFnQztJQUNyRGpCLFNBQVNnQixPQUFPLENBQUNDLEdBQUcsQ0FBQyxvQ0FBb0M7SUFDekQsT0FBT2pCO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2FtZS1haS9zZXJ2ZXIvLi9hcHAvYXBpL2luZmVyZW5jZS9jaGF0L3JvdXRlLnRzPzk2NWIiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBSSDlgaXlurflkqjor6IgQVBJIOi3r+eUsVxuICpcbiAqIOWKn+iDve+8mlxuICogMS4g5qOA5p+l55So5oi36K6i6ZiF54q25oCBXG4gKiAyLiDosIPnlKggRGlmeSBBUEkg6I635Y+WIEFJIOWbnuetlFxuICogMy4g6L+U5Zue5Zue562U57uT5p6cXG4gKlxuICog6K+35rGC5pa55byPOiBQT1NUIC9hcGkvaW5mZXJlbmNlL2NoYXRcbiAqXG4gKiDor7fmsYLkvZPmoLzlvI86XG4gKiB7XG4gKiAgIFwidXNlckFkZHJlc3NcIjogXCIweC4uLlwiLFxuICogICBcInF1ZXN0aW9uXCI6IFwi5oiR5q+P5aSp552hNuWwj+aXtuWkn+WQl++8n1wiLFxuICogICBcImNvbnZlcnNhdGlvbklkXCI6IFwidXVpZFwiIC8vIOWPr+mAie+8jOeUqOS6juWkmui9ruWvueivnVxuICogfVxuICpcbiAqIOWTjeW6lOagvOW8jzpcbiAqIHtcbiAqICAgXCJhbnN3ZXJcIjogXCLmoLnmja7lgaXlurfnoJTnqbYuLi5cIixcbiAqICAgXCJjb252ZXJzYXRpb25JZFwiOiBcInV1aWRcIixcbiAqICAgXCJzdWJzY3JpcHRpb25TdGF0dXNcIjoge1xuICogICAgIFwiaXNBY3RpdmVcIjogdHJ1ZSxcbiAqICAgICBcImRheXNSZW1haW5pbmdcIjogMTVcbiAqICAgfVxuICogfVxuICovXG5cbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7IGNvbm5lY3REQiB9IGZyb20gJ0AvbGliL21vbmdvZGInXG5pbXBvcnQgeyBjcmVhdGVEaWZ5Q2xpZW50IH0gZnJvbSAnQC9saWIvZGlmeSdcbmltcG9ydCB7IGlzVmFsaWRBZGRyZXNzLCBub3JtYWxpemVBZGRyZXNzIH0gZnJvbSAnQC9saWIvYWRkcmVzcy11dGlscydcblxuLyoqXG4gKiDpqozor4HnlKjmiLforqLpmIXnirbmgIFcbiAqIOajgOafpeaVsOaNruW6k+S4reeahOiuoumYheiusOW9leaYr+WQpuacieaViFxuICovXG5hc3luYyBmdW5jdGlvbiBjaGVja1N1YnNjcmlwdGlvbih1c2VyQWRkcmVzczogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBjb25uZWN0REIoKVxuXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgZGJcbiAgICAgIC5jb2xsZWN0aW9uKCdzdWJzY3JpcHRpb25zJylcbiAgICAgIC5maW5kT25lKHtcbiAgICAgICAgdXNlckFkZHJlc3MsXG4gICAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICB9KVxuXG4gICAgaWYgKCFzdWJzY3JpcHRpb24pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdObyBhY3RpdmUgc3Vic2NyaXB0aW9uIGZvdW5kJyxcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBub3cgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSAvLyDovazmjaLkuLrnp5LnuqcgVW5peCDml7bpl7TmiLNcbiAgICBjb25zdCBpc0V4cGlyZWQgPSBzdWJzY3JpcHRpb24uZXhwaXJlc0F0IDwgbm93XG5cbiAgICBpZiAoaXNFeHBpcmVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnU3Vic2NyaXB0aW9uIGhhcyBleHBpcmVkJyxcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBkYXlzUmVtYWluaW5nID0gTWF0aC5jZWlsKChzdWJzY3JpcHRpb24uZXhwaXJlc0F0IC0gbm93KSAvICgyNCAqIDM2MDApKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgZXhwaXJlc0F0OiBzdWJzY3JpcHRpb24uZXhwaXJlc0F0LFxuICAgICAgZGF5c1JlbWFpbmluZyxcbiAgICAgIHRyYW5zYWN0aW9uSGFzaDogc3Vic2NyaXB0aW9uLnRyYW5zYWN0aW9uSGFzaCxcbiAgICAgIHN0YXJ0ZWRBdDogc3Vic2NyaXB0aW9uLnN0YXJ0ZWRBdCxcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW0NoYXQgQVBJXSDorqLpmIXnirbmgIHmo4Dmn6XlpLHotKU6JywgZXJyb3IpXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNoZWNrIHN1YnNjcmlwdGlvbiBzdGF0dXMnLFxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIOWkhOeQhiBQT1NUIOivt+axglxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuICAgIGNvbnN0IHsgdXNlckFkZHJlc3MsIHF1ZXN0aW9uLCBjb252ZXJzYXRpb25JZCB9ID0gYm9keVxuXG4gICAgLy8g5Y+C5pWw6aqM6K+BXG4gICAgaWYgKCF1c2VyQWRkcmVzcyB8fCAhcXVlc3Rpb24pIHtcbiAgICAgIGNvbnNvbGUud2FybignW0NoYXQgQVBJXSDnvLrlsJHlv4XpnIDlj4LmlbA6IHVzZXJBZGRyZXNzIOaIliBxdWVzdGlvbicpXG4gICAgICByZXR1cm4gY29yc0pzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogJ01pc3NpbmcgcmVxdWlyZWQgcGFyYW1ldGVyczogdXNlckFkZHJlc3MgYW5kIHF1ZXN0aW9uJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8g6aqM6K+B5Zyw5Z2A5qC85byPXG4gICAgaWYgKCFpc1ZhbGlkQWRkcmVzcyh1c2VyQWRkcmVzcykpIHtcbiAgICAgIGNvbnNvbGUud2FybignW0NoYXQgQVBJXSDml6DmlYjnmoTpkrHljIXlnLDlnYA6JywgdXNlckFkZHJlc3MpXG4gICAgICByZXR1cm4gY29yc0pzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgd2FsbGV0IGFkZHJlc3MgZm9ybWF0JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3Qgbm9ybWFsaXplZEFkZHJlc3MgPSBub3JtYWxpemVBZGRyZXNzKHVzZXJBZGRyZXNzKVxuXG4gICAgLy8g6aqM6K+B6Zeu6aKY6ZW/5bqmXG4gICAgaWYgKHR5cGVvZiBxdWVzdGlvbiAhPT0gJ3N0cmluZycgfHwgcXVlc3Rpb24udHJpbSgpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc29sZS53YXJuKCdbQ2hhdCBBUEldIOmXrumimOWGheWuueaXoOaViCcpXG4gICAgICByZXR1cm4gY29yc0pzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogJ1F1ZXN0aW9uIG11c3QgYmUgYSBub24tZW1wdHkgc3RyaW5nJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgaWYgKHF1ZXN0aW9uLmxlbmd0aCA+IDIwMDApIHtcbiAgICAgIGNvbnNvbGUud2FybignW0NoYXQgQVBJXSDpl67popjlhoXlrrnov4fplb8nKVxuICAgICAgcmV0dXJuIGNvcnNKc29uKFxuICAgICAgICB7XG4gICAgICAgICAgZXJyb3I6ICdRdWVzdGlvbiBtdXN0IGJlIGxlc3MgdGhhbiAyMDAwIGNoYXJhY3RlcnMnLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnW0NoYXQgQVBJXSDmlLbliLDor7fmsYIgfCDnlKjmiLc6Jywgbm9ybWFsaXplZEFkZHJlc3MsICd8IOmXrumimOmVv+W6pjonLCBxdWVzdGlvbi5sZW5ndGgpXG4gICAgaWYgKGNvbnZlcnNhdGlvbklkKSB7XG4gICAgICBjb25zb2xlLmxvZygnW0NoYXQgQVBJXSDlr7nor51JRDonLCBjb252ZXJzYXRpb25JZClcbiAgICB9XG5cbiAgICAvLyAxLiDmo4Dmn6XorqLpmIXnirbmgIFcbiAgICBjb25zb2xlLmxvZygnW0NoYXQgQVBJXSDmo4Dmn6XorqLpmIXnirbmgIEuLi4nKVxuICAgIGNvbnN0IHN1YnNjcmlwdGlvblN0YXR1cyA9IGF3YWl0IGNoZWNrU3Vic2NyaXB0aW9uKG5vcm1hbGl6ZWRBZGRyZXNzKVxuXG4gICAgaWYgKCFzdWJzY3JpcHRpb25TdGF0dXMuaXNBY3RpdmUpIHtcbiAgICAgIGNvbnNvbGUud2FybignW0NoYXQgQVBJXSDorqLpmIXpqozor4HlpLHotKU6Jywgc3Vic2NyaXB0aW9uU3RhdHVzLmVycm9yKVxuICAgICAgcmV0dXJuIGNvcnNKc29uKFxuICAgICAgICB7XG4gICAgICAgICAgZXJyb3I6IHN1YnNjcmlwdGlvblN0YXR1cy5lcnJvcixcbiAgICAgICAgICBjb2RlOiAnU1VCU0NSSVBUSU9OX0lOQUNUSVZFJyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1tDaGF0IEFQSV0g6K6i6ZiF5pyJ5pWIIHwg5Ymp5L2Z5aSp5pWwOicsIHN1YnNjcmlwdGlvblN0YXR1cy5kYXlzUmVtYWluaW5nKVxuXG4gICAgLy8gMi4g5Yid5aeL5YyWIERpZnkg5a6i5oi356uvXG4gICAgY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuRElGWV9BUElfS0VZXG4gICAgaWYgKCFhcGlLZXkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tDaGF0IEFQSV0gRElGWV9BUElfS0VZIOeOr+Wig+WPmOmHj+acqumFjee9ricpXG4gICAgICByZXR1cm4gY29yc0pzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogJ0FJIHNlcnZpY2UgaXMgbm90IHByb3Blcmx5IGNvbmZpZ3VyZWQnLFxuICAgICAgICAgIGNvZGU6ICdDT05GSUdfRVJST1InLFxuICAgICAgICB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCBkaWZ5Q2xpZW50ID0gY3JlYXRlRGlmeUNsaWVudChhcGlLZXkpXG5cbiAgICAvLyAzLiDosIPnlKggRGlmeSBBUElcbiAgICBjb25zb2xlLmxvZygnW0NoYXQgQVBJXSDosIPnlKggRGlmeSBBUEkuLi4nKVxuICAgIGxldCBkaWZ5UmVzcG9uc2VcbiAgICB0cnkge1xuICAgICAgZGlmeVJlc3BvbnNlID0gYXdhaXQgZGlmeUNsaWVudC5zZW5kTWVzc2FnZShcbiAgICAgICAgcXVlc3Rpb24sXG4gICAgICAgIG5vcm1hbGl6ZWRBZGRyZXNzLFxuICAgICAgICBjb252ZXJzYXRpb25JZFxuICAgICAgKVxuICAgIH0gY2F0Y2ggKGRpZnlFcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbQ2hhdCBBUEldIERpZnkgQVBJIOiwg+eUqOWksei0pTonLCBkaWZ5RXJyb3IubWVzc2FnZSlcblxuICAgICAgLy8g5aSE55CG54m55a6a55qEIERpZnkg6ZSZ6K+vXG4gICAgICBpZiAoZGlmeUVycm9yLnJlc3BvbnNlPy5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICByZXR1cm4gY29yc0pzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgZXJyb3I6ICdBSSBzZXJ2aWNlIGF1dGhlbnRpY2F0aW9uIGZhaWxlZCcsXG4gICAgICAgICAgICBjb2RlOiAnRElGWV9BVVRIX0ZBSUxFRCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICBpZiAoZGlmeUVycm9yLnJlc3BvbnNlPy5zdGF0dXMgPT09IDQyOSkge1xuICAgICAgICByZXR1cm4gY29yc0pzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgZXJyb3I6ICdBSSBzZXJ2aWNlIHJhdGUgbGltaXQgZXhjZWVkZWQsIHBsZWFzZSB0cnkgYWdhaW4gbGF0ZXInLFxuICAgICAgICAgICAgY29kZTogJ0RJRllfUkFURV9MSU1JVEVEJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MjkgfVxuICAgICAgICApXG4gICAgICB9XG5cbiAgICAgIHRocm93IGRpZnlFcnJvclxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdbQ2hhdCBBUEldIERpZnkg5ZON5bqU5oiQ5YqfJylcblxuICAgIC8vIDQuIOS/neWtmOWvueivneiusOW9leWIsCBNb25nb0RC77yI5Y+v6YCJ5L2G5o6o6I2Q77yJXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRiID0gYXdhaXQgY29ubmVjdERCKClcbiAgICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NoYXRfbG9ncycpLmluc2VydE9uZSh7XG4gICAgICAgIHVzZXJBZGRyZXNzOiBub3JtYWxpemVkQWRkcmVzcyxcbiAgICAgICAgcXVlc3Rpb24sXG4gICAgICAgIGFuc3dlcjogZGlmeVJlc3BvbnNlLmFuc3dlcixcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IGRpZnlSZXNwb25zZS5jb252ZXJzYXRpb25faWQsXG4gICAgICAgIG1lc3NhZ2VJZDogZGlmeVJlc3BvbnNlLm1lc3NhZ2VfaWQsXG4gICAgICAgIHRhc2tJZDogZGlmeVJlc3BvbnNlLnRhc2tfaWQsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgbWV0YWRhdGE6IGRpZnlSZXNwb25zZS5tZXRhZGF0YSxcbiAgICAgIH0pXG4gICAgICBjb25zb2xlLmxvZygnW0NoYXQgQVBJXSDlr7nor53orrDlvZXlt7Lkv53lrZjliLAgTW9uZ29EQicpXG4gICAgfSBjYXRjaCAobG9nRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignW0NoYXQgQVBJXSDlr7nor53orrDlvZXkv53lrZjlpLHotKUgKOmdnuiHtOWRvemUmeivryk6JywgbG9nRXJyb3IpXG4gICAgICAvLyDkuI3kuK3mlq3or7fmsYLvvIzlj6rorrDlvZXorablkYpcbiAgICB9XG5cbiAgICAvLyA1LiDov5Tlm57lk43lupRcbiAgICByZXR1cm4gY29yc0pzb24oXG4gICAgICB7XG4gICAgICAgIGFuc3dlcjogZGlmeVJlc3BvbnNlLmFuc3dlcixcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IGRpZnlSZXNwb25zZS5jb252ZXJzYXRpb25faWQsXG4gICAgICAgIG1lc3NhZ2VJZDogZGlmeVJlc3BvbnNlLm1lc3NhZ2VfaWQsXG4gICAgICAgIHRhc2tJZDogZGlmeVJlc3BvbnNlLnRhc2tfaWQsXG4gICAgICAgIHN1YnNjcmlwdGlvblN0YXR1czoge1xuICAgICAgICAgIGlzQWN0aXZlOiBzdWJzY3JpcHRpb25TdGF0dXMuaXNBY3RpdmUsXG4gICAgICAgICAgZGF5c1JlbWFpbmluZzogc3Vic2NyaXB0aW9uU3RhdHVzLmRheXNSZW1haW5pbmcsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDIwMCB9XG4gICAgKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tDaGF0IEFQSV0g5aSE55CG6K+35rGC5aSx6LSlOicsIGVycm9yKVxuXG4gICAgLy8g5aSE55CG572R57ucL+i2heaXtumUmeivr1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnRUNPTk5SRUZVU0VEJykgfHwgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnRU5PVEZPVU5EJykpIHtcbiAgICAgICAgcmV0dXJuIGNvcnNKc29uKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNvbm5lY3QgdG8gQUkgc2VydmljZScsXG4gICAgICAgICAgICBjb2RlOiAnU0VSVklDRV9VTkFWQUlMQUJMRScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNTAzIH1cbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygndGltZW91dCcpIHx8IGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0VUSU1FRE9VVCcpKSB7XG4gICAgICAgIHJldHVybiBjb3JzSnNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBlcnJvcjogJ1JlcXVlc3QgdG8gQUkgc2VydmljZSB0aW1lZCBvdXQsIHBsZWFzZSB0cnkgYWdhaW4nLFxuICAgICAgICAgICAgY29kZTogJ1JFUVVFU1RfVElNRU9VVCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNTA0IH1cbiAgICAgICAgKVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb3JzSnNvbihcbiAgICAgIHtcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gcHJvY2VzcyBjaGF0IHJlcXVlc3QnLFxuICAgICAgICBjb2RlOiAnSU5URVJOQUxfRVJST1InLFxuICAgICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuLyoqXG4gKiDlpITnkIYgT1BUSU9OUyDor7fmsYLvvIjnlKjkuo4gQ09SUyDpooTmo4DvvIlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIE9QVElPTlMoKSB7XG4gIHJldHVybiBjb3JzSnNvbihudWxsLCB7IHN0YXR1czogMjAwIH0pXG59XG5cbmZ1bmN0aW9uIGNvcnNKc29uKGJvZHk6IGFueSwgaW5pdD86IFJlc3BvbnNlSW5pdCkge1xuICBjb25zdCByZXNwb25zZSA9IGJvZHkgPT09IG51bGxcbiAgICA/IG5ldyBOZXh0UmVzcG9uc2UobnVsbCwgaW5pdClcbiAgICA6IE5leHRSZXNwb25zZS5qc29uKGJvZHksIGluaXQpXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ1BPU1QsIE9QVElPTlMnKVxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycycsICdDb250ZW50LVR5cGUsIEF1dGhvcml6YXRpb24nKVxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHMnLCAndHJ1ZScpXG4gIHJldHVybiByZXNwb25zZVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNvbm5lY3REQiIsImNyZWF0ZURpZnlDbGllbnQiLCJpc1ZhbGlkQWRkcmVzcyIsIm5vcm1hbGl6ZUFkZHJlc3MiLCJjaGVja1N1YnNjcmlwdGlvbiIsInVzZXJBZGRyZXNzIiwiZGIiLCJzdWJzY3JpcHRpb24iLCJjb2xsZWN0aW9uIiwiZmluZE9uZSIsInN0YXR1cyIsImlzQWN0aXZlIiwiZXJyb3IiLCJub3ciLCJNYXRoIiwiZmxvb3IiLCJEYXRlIiwiaXNFeHBpcmVkIiwiZXhwaXJlc0F0IiwiZGF5c1JlbWFpbmluZyIsImNlaWwiLCJ0cmFuc2FjdGlvbkhhc2giLCJzdGFydGVkQXQiLCJjb25zb2xlIiwiUE9TVCIsInJlcXVlc3QiLCJib2R5IiwianNvbiIsInF1ZXN0aW9uIiwiY29udmVyc2F0aW9uSWQiLCJ3YXJuIiwiY29yc0pzb24iLCJub3JtYWxpemVkQWRkcmVzcyIsInRyaW0iLCJsZW5ndGgiLCJsb2ciLCJzdWJzY3JpcHRpb25TdGF0dXMiLCJjb2RlIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIkRJRllfQVBJX0tFWSIsImRpZnlDbGllbnQiLCJkaWZ5UmVzcG9uc2UiLCJzZW5kTWVzc2FnZSIsImRpZnlFcnJvciIsIm1lc3NhZ2UiLCJyZXNwb25zZSIsImluc2VydE9uZSIsImFuc3dlciIsImNvbnZlcnNhdGlvbl9pZCIsIm1lc3NhZ2VJZCIsIm1lc3NhZ2VfaWQiLCJ0YXNrSWQiLCJ0YXNrX2lkIiwidGltZXN0YW1wIiwibWV0YWRhdGEiLCJsb2dFcnJvciIsIkVycm9yIiwiaW5jbHVkZXMiLCJkZXRhaWxzIiwiT1BUSU9OUyIsImluaXQiLCJoZWFkZXJzIiwic2V0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/inference/chat/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/address-utils.ts":
/*!******************************!*\
  !*** ./lib/address-utils.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isValidAddress: () => (/* binding */ isValidAddress),\n/* harmony export */   isValidTransactionHash: () => (/* binding */ isValidTransactionHash),\n/* harmony export */   normalizeAddress: () => (/* binding */ normalizeAddress)\n/* harmony export */ });\n/**\n * 地址验证和规范化工具\n * 独立于 ethers，避免 Next.js 兼容性问题\n */ /**\n * 验证是否为有效的以太坊地址\n * @param address 地址字符串\n * @returns 是否有效\n */ function isValidAddress(address) {\n    return /^0x[a-fA-F0-9]{40}$/.test(address);\n}\n/**\n * 规范化地址为小写格式\n * @param address 地址字符串\n * @returns 规范化后的地址\n */ function normalizeAddress(address) {\n    if (!isValidAddress(address)) {\n        throw new Error(\"Invalid address format\");\n    }\n    return address.toLowerCase();\n}\n/**\n * 验证交易哈希格式\n * @param hash 交易哈希\n * @returns 是否有效\n */ function isValidTransactionHash(hash) {\n    return /^0x[a-fA-F0-9]{64}$/.test(hash);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYWRkcmVzcy11dGlscy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7O0NBR0MsR0FFRDs7OztDQUlDLEdBQ00sU0FBU0EsZUFBZUMsT0FBZTtJQUM1QyxPQUFPLHNCQUFzQkMsSUFBSSxDQUFDRDtBQUNwQztBQUVBOzs7O0NBSUMsR0FDTSxTQUFTRSxpQkFBaUJGLE9BQWU7SUFDOUMsSUFBSSxDQUFDRCxlQUFlQyxVQUFVO1FBQzVCLE1BQU0sSUFBSUcsTUFBTTtJQUNsQjtJQUNBLE9BQU9ILFFBQVFJLFdBQVc7QUFDNUI7QUFFQTs7OztDQUlDLEdBQ00sU0FBU0MsdUJBQXVCQyxJQUFZO0lBQ2pELE9BQU8sc0JBQXNCTCxJQUFJLENBQUNLO0FBQ3BDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdhbWUtYWkvc2VydmVyLy4vbGliL2FkZHJlc3MtdXRpbHMudHM/NjNmMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIOWcsOWdgOmqjOivgeWSjOinhOiMg+WMluW3peWFt1xuICog54us56uL5LqOIGV0aGVyc++8jOmBv+WFjSBOZXh0LmpzIOWFvOWuueaAp+mXrumimFxuICovXG5cbi8qKlxuICog6aqM6K+B5piv5ZCm5Li65pyJ5pWI55qE5Lul5aSq5Z2K5Zyw5Z2AXG4gKiBAcGFyYW0gYWRkcmVzcyDlnLDlnYDlrZfnrKbkuLJcbiAqIEByZXR1cm5zIOaYr+WQpuacieaViFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZEFkZHJlc3MoYWRkcmVzczogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiAvXjB4W2EtZkEtRjAtOV17NDB9JC8udGVzdChhZGRyZXNzKVxufVxuXG4vKipcbiAqIOinhOiMg+WMluWcsOWdgOS4uuWwj+WGmeagvOW8j1xuICogQHBhcmFtIGFkZHJlc3Mg5Zyw5Z2A5a2X56ym5LiyXG4gKiBAcmV0dXJucyDop4TojIPljJblkI7nmoTlnLDlnYBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUFkZHJlc3MoYWRkcmVzczogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFpc1ZhbGlkQWRkcmVzcyhhZGRyZXNzKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhZGRyZXNzIGZvcm1hdCcpXG4gIH1cbiAgcmV0dXJuIGFkZHJlc3MudG9Mb3dlckNhc2UoKVxufVxuXG4vKipcbiAqIOmqjOivgeS6pOaYk+WTiOW4jOagvOW8j1xuICogQHBhcmFtIGhhc2gg5Lqk5piT5ZOI5biMXG4gKiBAcmV0dXJucyDmmK/lkKbmnInmlYhcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzVmFsaWRUcmFuc2FjdGlvbkhhc2goaGFzaDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiAvXjB4W2EtZkEtRjAtOV17NjR9JC8udGVzdChoYXNoKVxufVxuIl0sIm5hbWVzIjpbImlzVmFsaWRBZGRyZXNzIiwiYWRkcmVzcyIsInRlc3QiLCJub3JtYWxpemVBZGRyZXNzIiwiRXJyb3IiLCJ0b0xvd2VyQ2FzZSIsImlzVmFsaWRUcmFuc2FjdGlvbkhhc2giLCJoYXNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/address-utils.ts\n");

/***/ }),

/***/ "(rsc)/./lib/dify.ts":
/*!*********************!*\
  !*** ./lib/dify.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DifyClient: () => (/* binding */ DifyClient),\n/* harmony export */   createDifyClient: () => (/* binding */ createDifyClient)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"(rsc)/./node_modules/axios/lib/axios.js\");\n/**\n * Dify API 集成模块\n * 用于调用 Dify 聊天对话 API\n *\n * Dify API 文档: https://docs.dify.ai/\n * 基础 URL: https://api.dify.ai/v1\n */ \n/**\n * Dify 客户端类\n */ class DifyClient {\n    client;\n    apiKey;\n    constructor(config){\n        this.apiKey = config.apiKey;\n        const baseURL = config.baseUrl || \"https://api.dify.ai/v1\";\n        const timeout = config.timeout || 30000;\n        this.client = axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].create({\n            baseURL,\n            timeout,\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Accept\": \"application/json\"\n            }\n        });\n    }\n    /**\n   * 发送聊天消息到 Dify\n   * 支持两种模式：\n   * - blocking: 阻塞模式，等待执行完毕后返回结果（推荐用于 API）\n   * - streaming: 流式模式，基于 SSE 实现流式返回\n   *\n   * @param message 用户输入/提问内容\n   * @param userId 用户标识（必需）\n   * @param conversationId 会话 ID（可选，用于多轮对话）\n   * @param inputs 应用定义的变量值（可选）\n   * @returns Dify 响应数据\n   */ async sendMessage(message, userId, conversationId, inputs) {\n        try {\n            console.log(\"[Dify] 发送消息...\");\n            console.log(\"[Dify] 用户ID:\", userId);\n            console.log(\"[Dify] 消息内容:\", message);\n            const requestData = {\n                query: message,\n                user: userId,\n                response_mode: \"blocking\",\n                inputs: inputs || {}\n            };\n            // 如果提供了 conversation_id，表示继续已有的对话\n            if (conversationId) {\n                requestData.conversation_id = conversationId;\n                console.log(\"[Dify] 使用已有对话ID:\", conversationId);\n            } else {\n                console.log(\"[Dify] 创建新对话\");\n            }\n            console.log(\"[Dify] 请求数据:\", JSON.stringify(requestData));\n            const response = await this.client.post(\"/chat-messages\", requestData, {\n                headers: {\n                    \"Authorization\": `Bearer ${this.apiKey}`\n                }\n            });\n            console.log(\"[Dify] 响应状态:\", response.status);\n            console.log(\"[Dify] 获取到AI回复:\", response.data.answer.substring(0, 100) + \"...\");\n            return response.data;\n        } catch (error) {\n            console.error(\"[Dify] API 调用失败:\", error);\n            throw error;\n        }\n    }\n    /**\n   * 获取会话历史消息\n   *\n   * @param conversationId 会话 ID\n   * @param userId 用户标识\n   * @param limit 返回的消息条数，默认 20\n   * @param firstId 当前页第一条聊天记录的 ID（用于分页）\n   * @returns 消息列表和分页信息\n   */ async getMessages(conversationId, userId, limit = 20, firstId) {\n        try {\n            console.log(\"[Dify] 获取会话消息...\");\n            console.log(\"[Dify] 对话ID:\", conversationId);\n            const params = {\n                conversation_id: conversationId,\n                user: userId,\n                limit\n            };\n            if (firstId) {\n                params.first_id = firstId;\n            }\n            const response = await this.client.get(\"/messages\", {\n                params,\n                headers: {\n                    \"Authorization\": `Bearer ${this.apiKey}`\n                }\n            });\n            console.log(\"[Dify] 获取到消息数量:\", response.data.data?.length);\n            return response.data;\n        } catch (error) {\n            console.error(\"[Dify] 获取消息失败:\", error);\n            throw error;\n        }\n    }\n    /**\n   * 获取用户的会话列表\n   *\n   * @param userId 用户标识\n   * @param limit 返回的会话条数，默认 20\n   * @param lastId 当前页最后一条记录的 ID（用于分页）\n   * @returns 会话列表和分页信息\n   */ async getConversations(userId, limit = 20, lastId) {\n        try {\n            console.log(\"[Dify] 获取会话列表...\");\n            console.log(\"[Dify] 用户ID:\", userId);\n            const params = {\n                user: userId,\n                limit\n            };\n            if (lastId) {\n                params.last_id = lastId;\n            }\n            const response = await this.client.get(\"/conversations\", {\n                params,\n                headers: {\n                    \"Authorization\": `Bearer ${this.apiKey}`\n                }\n            });\n            console.log(\"[Dify] 获取到会话数量:\", response.data.data?.length);\n            return response.data;\n        } catch (error) {\n            console.error(\"[Dify] 获取会话列表失败:\", error);\n            throw error;\n        }\n    }\n    /**\n   * 删除会话\n   *\n   * @param conversationId 会话 ID\n   * @param userId 用户标识\n   */ async deleteConversation(conversationId, userId) {\n        try {\n            console.log(\"[Dify] 删除会话...\");\n            console.log(\"[Dify] 对话ID:\", conversationId);\n            const response = await this.client.delete(`/conversations/${conversationId}`, {\n                data: {\n                    user: userId\n                },\n                headers: {\n                    \"Authorization\": `Bearer ${this.apiKey}`\n                }\n            });\n            console.log(\"[Dify] 会话已删除\");\n            return response.data;\n        } catch (error) {\n            console.error(\"[Dify] 删除会话失败:\", error);\n            throw error;\n        }\n    }\n    /**\n   * 重命名会话\n   *\n   * @param conversationId 会话 ID\n   * @param name 新的会话名称（可选）\n   * @param userId 用户标识\n   * @param autoGenerate 是否自动生成标题，默认 false\n   */ async renameConversation(conversationId, userId, name, autoGenerate = false) {\n        try {\n            console.log(\"[Dify] 重命名会话...\");\n            console.log(\"[Dify] 对话ID:\", conversationId);\n            const response = await this.client.post(`/conversations/${conversationId}/name`, {\n                user: userId,\n                name,\n                auto_generate: autoGenerate\n            }, {\n                headers: {\n                    \"Authorization\": `Bearer ${this.apiKey}`\n                }\n            });\n            console.log(\"[Dify] 会话已重命名\");\n            return response.data;\n        } catch (error) {\n            console.error(\"[Dify] 重命名会话失败:\", error);\n            throw error;\n        }\n    }\n    /**\n   * 获取应用基本信息\n   */ async getAppInfo() {\n        try {\n            console.log(\"[Dify] 获取应用信息...\");\n            const response = await this.client.get(\"/info\", {\n                headers: {\n                    \"Authorization\": `Bearer ${this.apiKey}`\n                }\n            });\n            console.log(\"[Dify] 应用信息获取成功:\", response.data.name);\n            return response.data;\n        } catch (error) {\n            console.error(\"[Dify] 获取应用信息失败:\", error);\n            throw error;\n        }\n    }\n    /**\n   * 获取应用参数配置\n   * 包括开场白、建议问题、文件上传配置等\n   */ async getParameters() {\n        try {\n            console.log(\"[Dify] 获取应用参数...\");\n            const response = await this.client.get(\"/parameters\", {\n                headers: {\n                    \"Authorization\": `Bearer ${this.apiKey}`\n                }\n            });\n            console.log(\"[Dify] 应用参数获取成功\");\n            return response.data;\n        } catch (error) {\n            console.error(\"[Dify] 获取应用参数失败:\", error);\n            throw error;\n        }\n    }\n}\n/**\n * 创建 Dify 客户端实例\n *\n * @param apiKey Dify API Key\n * @returns DifyClient 实例\n */ function createDifyClient(apiKey) {\n    return new DifyClient({\n        apiKey,\n        baseUrl: process.env.DIFY_API_BASE_URL || \"https://api.dify.ai/v1\"\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxHQUFHLENBQUM7WUFFWixNQUFNUSxXQUFXLE1BQU0sSUFBSSxDQUFDdkIsTUFBTSxDQUFDbUMsR0FBRyxDQUFDLGVBQWU7Z0JBQ3BEM0IsU0FBUztvQkFDUCxpQkFBaUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDUCxNQUFNLENBQUMsQ0FBQztnQkFDMUM7WUFDRjtZQUVBYSxRQUFRQyxHQUFHLENBQUM7WUFDWixPQUFPUSxTQUFTRyxJQUFJO1FBQ3RCLEVBQUUsT0FBT0csT0FBTztZQUNkZixRQUFRZSxLQUFLLENBQUMsb0JBQW9CQTtZQUNsQyxNQUFNQTtRQUNSO0lBQ0Y7QUFDRjtBQUVBOzs7OztDQUtDLEdBQ00sU0FBU21CLGlCQUFpQi9DLE1BQWM7SUFDN0MsT0FBTyxJQUFJRixXQUFXO1FBQ3BCRTtRQUNBSSxTQUFTNEMsUUFBUUMsR0FBRyxDQUFDQyxpQkFBaUIsSUFBSTtJQUM1QztBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdhbWUtYWkvc2VydmVyLy4vbGliL2RpZnkudHM/MTkzYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIERpZnkgQVBJIOmbhuaIkOaooeWdl1xuICog55So5LqO6LCD55SoIERpZnkg6IGK5aSp5a+56K+dIEFQSVxuICpcbiAqIERpZnkgQVBJIOaWh+ahozogaHR0cHM6Ly9kb2NzLmRpZnkuYWkvXG4gKiDln7rnoYAgVVJMOiBodHRwczovL2FwaS5kaWZ5LmFpL3YxXG4gKi9cblxuaW1wb3J0IGF4aW9zLCB7IEF4aW9zSW5zdGFuY2UgfSBmcm9tICdheGlvcydcblxuLyoqXG4gKiBEaWZ5IOa2iOaBr+WTjeW6lOexu+Wei1xuICovXG5pbnRlcmZhY2UgRGlmeU1lc3NhZ2VSZXNwb25zZSB7XG4gIGV2ZW50OiBzdHJpbmdcbiAgdGFza19pZDogc3RyaW5nXG4gIGlkOiBzdHJpbmdcbiAgbWVzc2FnZV9pZDogc3RyaW5nXG4gIGNvbnZlcnNhdGlvbl9pZDogc3RyaW5nXG4gIG1vZGU6IHN0cmluZ1xuICBhbnN3ZXI6IHN0cmluZ1xuICBtZXRhZGF0YT86IHtcbiAgICB1c2FnZT86IHtcbiAgICAgIHByb21wdF90b2tlbnM6IG51bWJlclxuICAgICAgY29tcGxldGlvbl90b2tlbnM6IG51bWJlclxuICAgICAgdG90YWxfdG9rZW5zOiBudW1iZXJcbiAgICB9XG4gICAgcmV0cmlldmVyX3Jlc291cmNlcz86IGFueVtdXG4gIH1cbiAgY3JlYXRlZF9hdDogbnVtYmVyXG59XG5cbi8qKlxuICogRGlmeSDlrqLmiLfnq6/phY3nva5cbiAqL1xuaW50ZXJmYWNlIERpZnlDb25maWcge1xuICBhcGlLZXk6IHN0cmluZ1xuICBiYXNlVXJsPzogc3RyaW5nXG4gIHRpbWVvdXQ/OiBudW1iZXJcbn1cblxuLyoqXG4gKiBEaWZ5IOWuouaIt+err+exu1xuICovXG5leHBvcnQgY2xhc3MgRGlmeUNsaWVudCB7XG4gIHByaXZhdGUgY2xpZW50OiBBeGlvc0luc3RhbmNlXG4gIHByaXZhdGUgYXBpS2V5OiBzdHJpbmdcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IERpZnlDb25maWcpIHtcbiAgICB0aGlzLmFwaUtleSA9IGNvbmZpZy5hcGlLZXlcbiAgICBjb25zdCBiYXNlVVJMID0gY29uZmlnLmJhc2VVcmwgfHwgJ2h0dHBzOi8vYXBpLmRpZnkuYWkvdjEnXG4gICAgY29uc3QgdGltZW91dCA9IGNvbmZpZy50aW1lb3V0IHx8IDMwMDAwXG5cbiAgICB0aGlzLmNsaWVudCA9IGF4aW9zLmNyZWF0ZSh7XG4gICAgICBiYXNlVVJMLFxuICAgICAgdGltZW91dCxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiDlj5HpgIHogYrlpKnmtojmga/liLAgRGlmeVxuICAgKiDmlK/mjIHkuKTnp43mqKHlvI/vvJpcbiAgICogLSBibG9ja2luZzog6Zi75aGe5qih5byP77yM562J5b6F5omn6KGM5a6M5q+V5ZCO6L+U5Zue57uT5p6c77yI5o6o6I2Q55So5LqOIEFQSe+8iVxuICAgKiAtIHN0cmVhbWluZzog5rWB5byP5qih5byP77yM5Z+65LqOIFNTRSDlrp7njrDmtYHlvI/ov5Tlm55cbiAgICpcbiAgICogQHBhcmFtIG1lc3NhZ2Ug55So5oi36L6T5YWlL+aPkOmXruWGheWuuVxuICAgKiBAcGFyYW0gdXNlcklkIOeUqOaIt+agh+ivhu+8iOW/hemcgO+8iVxuICAgKiBAcGFyYW0gY29udmVyc2F0aW9uSWQg5Lya6K+dIElE77yI5Y+v6YCJ77yM55So5LqO5aSa6L2u5a+56K+d77yJXG4gICAqIEBwYXJhbSBpbnB1dHMg5bqU55So5a6a5LmJ55qE5Y+Y6YeP5YC877yI5Y+v6YCJ77yJXG4gICAqIEByZXR1cm5zIERpZnkg5ZON5bqU5pWw5o2uXG4gICAqL1xuICBhc3luYyBzZW5kTWVzc2FnZShcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgY29udmVyc2F0aW9uSWQ/OiBzdHJpbmcsXG4gICAgaW5wdXRzPzogUmVjb3JkPHN0cmluZywgYW55PlxuICApOiBQcm9taXNlPERpZnlNZXNzYWdlUmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1tEaWZ5XSDlj5HpgIHmtojmga8uLi4nKVxuICAgICAgY29uc29sZS5sb2coJ1tEaWZ5XSDnlKjmiLdJRDonLCB1c2VySWQpXG4gICAgICBjb25zb2xlLmxvZygnW0RpZnldIOa2iOaBr+WGheWuuTonLCBtZXNzYWdlKVxuXG4gICAgICBjb25zdCByZXF1ZXN0RGF0YSA9IHtcbiAgICAgICAgcXVlcnk6IG1lc3NhZ2UsXG4gICAgICAgIHVzZXI6IHVzZXJJZCxcbiAgICAgICAgcmVzcG9uc2VfbW9kZTogJ2Jsb2NraW5nJywgLy8g5L2/55So6Zi75aGe5qih5byP77yM55u05o6l6L+U5Zue5a6M5pW057uT5p6cXG4gICAgICAgIGlucHV0czogaW5wdXRzIHx8IHt9LFxuICAgICAgfSBhcyBhbnlcblxuICAgICAgLy8g5aaC5p6c5o+Q5L6b5LqGIGNvbnZlcnNhdGlvbl9pZO+8jOihqOekuue7p+e7reW3suacieeahOWvueivnVxuICAgICAgaWYgKGNvbnZlcnNhdGlvbklkKSB7XG4gICAgICAgIHJlcXVlc3REYXRhLmNvbnZlcnNhdGlvbl9pZCA9IGNvbnZlcnNhdGlvbklkXG4gICAgICAgIGNvbnNvbGUubG9nKCdbRGlmeV0g5L2/55So5bey5pyJ5a+56K+dSUQ6JywgY29udmVyc2F0aW9uSWQpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZygnW0RpZnldIOWIm+W7uuaWsOWvueivnScpXG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCdbRGlmeV0g6K+35rGC5pWw5o2uOicsIEpTT04uc3RyaW5naWZ5KHJlcXVlc3REYXRhKSlcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5wb3N0PERpZnlNZXNzYWdlUmVzcG9uc2U+KFxuICAgICAgICAnL2NoYXQtbWVzc2FnZXMnLFxuICAgICAgICByZXF1ZXN0RGF0YSxcbiAgICAgICAge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3RoaXMuYXBpS2V5fWAsXG4gICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgICAgKVxuXG4gICAgICBjb25zb2xlLmxvZygnW0RpZnldIOWTjeW6lOeKtuaAgTonLCByZXNwb25zZS5zdGF0dXMpXG4gICAgICBjb25zb2xlLmxvZygnW0RpZnldIOiOt+WPluWIsEFJ5Zue5aSNOicsIHJlc3BvbnNlLmRhdGEuYW5zd2VyLnN1YnN0cmluZygwLCAxMDApICsgJy4uLicpXG5cbiAgICAgIHJldHVybiByZXNwb25zZS5kYXRhXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tEaWZ5XSBBUEkg6LCD55So5aSx6LSlOicsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+W5Lya6K+d5Y6G5Y+y5raI5oGvXG4gICAqXG4gICAqIEBwYXJhbSBjb252ZXJzYXRpb25JZCDkvJror50gSURcbiAgICogQHBhcmFtIHVzZXJJZCDnlKjmiLfmoIfor4ZcbiAgICogQHBhcmFtIGxpbWl0IOi/lOWbnueahOa2iOaBr+adoeaVsO+8jOm7mOiupCAyMFxuICAgKiBAcGFyYW0gZmlyc3RJZCDlvZPliY3pobXnrKzkuIDmnaHogYrlpKnorrDlvZXnmoQgSUTvvIjnlKjkuo7liIbpobXvvIlcbiAgICogQHJldHVybnMg5raI5oGv5YiX6KGo5ZKM5YiG6aG15L+h5oGvXG4gICAqL1xuICBhc3luYyBnZXRNZXNzYWdlcyhcbiAgICBjb252ZXJzYXRpb25JZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGxpbWl0OiBudW1iZXIgPSAyMCxcbiAgICBmaXJzdElkPzogc3RyaW5nXG4gICkge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnW0RpZnldIOiOt+WPluS8muivnea2iOaBry4uLicpXG4gICAgICBjb25zb2xlLmxvZygnW0RpZnldIOWvueivnUlEOicsIGNvbnZlcnNhdGlvbklkKVxuXG4gICAgICBjb25zdCBwYXJhbXM6IGFueSA9IHtcbiAgICAgICAgY29udmVyc2F0aW9uX2lkOiBjb252ZXJzYXRpb25JZCxcbiAgICAgICAgdXNlcjogdXNlcklkLFxuICAgICAgICBsaW1pdCxcbiAgICAgIH1cblxuICAgICAgaWYgKGZpcnN0SWQpIHtcbiAgICAgICAgcGFyYW1zLmZpcnN0X2lkID0gZmlyc3RJZFxuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2xpZW50LmdldCgnL21lc3NhZ2VzJywge1xuICAgICAgICBwYXJhbXMsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0aGlzLmFwaUtleX1gLFxuICAgICAgICB9LFxuICAgICAgfSlcblxuICAgICAgY29uc29sZS5sb2coJ1tEaWZ5XSDojrflj5bliLDmtojmga/mlbDph486JywgcmVzcG9uc2UuZGF0YS5kYXRhPy5sZW5ndGgpXG5cbiAgICAgIHJldHVybiByZXNwb25zZS5kYXRhXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tEaWZ5XSDojrflj5bmtojmga/lpLHotKU6JywgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnlKjmiLfnmoTkvJror53liJfooahcbiAgICpcbiAgICogQHBhcmFtIHVzZXJJZCDnlKjmiLfmoIfor4ZcbiAgICogQHBhcmFtIGxpbWl0IOi/lOWbnueahOS8muivneadoeaVsO+8jOm7mOiupCAyMFxuICAgKiBAcGFyYW0gbGFzdElkIOW9k+WJjemhteacgOWQjuS4gOadoeiusOW9leeahCBJRO+8iOeUqOS6juWIhumhte+8iVxuICAgKiBAcmV0dXJucyDkvJror53liJfooajlkozliIbpobXkv6Hmga9cbiAgICovXG4gIGFzeW5jIGdldENvbnZlcnNhdGlvbnMoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgbGltaXQ6IG51bWJlciA9IDIwLFxuICAgIGxhc3RJZD86IHN0cmluZ1xuICApIHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1tEaWZ5XSDojrflj5bkvJror53liJfooaguLi4nKVxuICAgICAgY29uc29sZS5sb2coJ1tEaWZ5XSDnlKjmiLdJRDonLCB1c2VySWQpXG5cbiAgICAgIGNvbnN0IHBhcmFtczogYW55ID0ge1xuICAgICAgICB1c2VyOiB1c2VySWQsXG4gICAgICAgIGxpbWl0LFxuICAgICAgfVxuXG4gICAgICBpZiAobGFzdElkKSB7XG4gICAgICAgIHBhcmFtcy5sYXN0X2lkID0gbGFzdElkXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuZ2V0KCcvY29udmVyc2F0aW9ucycsIHtcbiAgICAgICAgcGFyYW1zLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hcGlLZXl9YCxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIGNvbnNvbGUubG9nKCdbRGlmeV0g6I635Y+W5Yiw5Lya6K+d5pWw6YePOicsIHJlc3BvbnNlLmRhdGEuZGF0YT8ubGVuZ3RoKVxuXG4gICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbRGlmeV0g6I635Y+W5Lya6K+d5YiX6KGo5aSx6LSlOicsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5Yig6Zmk5Lya6K+dXG4gICAqXG4gICAqIEBwYXJhbSBjb252ZXJzYXRpb25JZCDkvJror50gSURcbiAgICogQHBhcmFtIHVzZXJJZCDnlKjmiLfmoIfor4ZcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUNvbnZlcnNhdGlvbihjb252ZXJzYXRpb25JZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZykge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnW0RpZnldIOWIoOmZpOS8muivnS4uLicpXG4gICAgICBjb25zb2xlLmxvZygnW0RpZnldIOWvueivnUlEOicsIGNvbnZlcnNhdGlvbklkKVxuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2xpZW50LmRlbGV0ZShcbiAgICAgICAgYC9jb252ZXJzYXRpb25zLyR7Y29udmVyc2F0aW9uSWR9YCxcbiAgICAgICAge1xuICAgICAgICAgIGRhdGE6IHsgdXNlcjogdXNlcklkIH0sXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hcGlLZXl9YCxcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICApXG5cbiAgICAgIGNvbnNvbGUubG9nKCdbRGlmeV0g5Lya6K+d5bey5Yig6ZmkJylcbiAgICAgIHJldHVybiByZXNwb25zZS5kYXRhXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tEaWZ5XSDliKDpmaTkvJror53lpLHotKU6JywgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDph43lkb3lkI3kvJror51cbiAgICpcbiAgICogQHBhcmFtIGNvbnZlcnNhdGlvbklkIOS8muivnSBJRFxuICAgKiBAcGFyYW0gbmFtZSDmlrDnmoTkvJror53lkI3np7DvvIjlj6/pgInvvIlcbiAgICogQHBhcmFtIHVzZXJJZCDnlKjmiLfmoIfor4ZcbiAgICogQHBhcmFtIGF1dG9HZW5lcmF0ZSDmmK/lkKboh6rliqjnlJ/miJDmoIfpopjvvIzpu5jorqQgZmFsc2VcbiAgICovXG4gIGFzeW5jIHJlbmFtZUNvbnZlcnNhdGlvbihcbiAgICBjb252ZXJzYXRpb25JZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIG5hbWU/OiBzdHJpbmcsXG4gICAgYXV0b0dlbmVyYXRlOiBib29sZWFuID0gZmFsc2VcbiAgKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbRGlmeV0g6YeN5ZG95ZCN5Lya6K+dLi4uJylcbiAgICAgIGNvbnNvbGUubG9nKCdbRGlmeV0g5a+56K+dSUQ6JywgY29udmVyc2F0aW9uSWQpXG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQucG9zdChcbiAgICAgICAgYC9jb252ZXJzYXRpb25zLyR7Y29udmVyc2F0aW9uSWR9L25hbWVgLFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcjogdXNlcklkLFxuICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgYXV0b19nZW5lcmF0ZTogYXV0b0dlbmVyYXRlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hcGlLZXl9YCxcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICApXG5cbiAgICAgIGNvbnNvbGUubG9nKCdbRGlmeV0g5Lya6K+d5bey6YeN5ZG95ZCNJylcbiAgICAgIHJldHVybiByZXNwb25zZS5kYXRhXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tEaWZ5XSDph43lkb3lkI3kvJror53lpLHotKU6JywgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blupTnlKjln7rmnKzkv6Hmga9cbiAgICovXG4gIGFzeW5jIGdldEFwcEluZm8oKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbRGlmeV0g6I635Y+W5bqU55So5L+h5oGvLi4uJylcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5nZXQoJy9pbmZvJywge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5hcGlLZXl9YCxcbiAgICAgICAgfSxcbiAgICAgIH0pXG5cbiAgICAgIGNvbnNvbGUubG9nKCdbRGlmeV0g5bqU55So5L+h5oGv6I635Y+W5oiQ5YqfOicsIHJlc3BvbnNlLmRhdGEubmFtZSlcbiAgICAgIHJldHVybiByZXNwb25zZS5kYXRhXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tEaWZ5XSDojrflj5blupTnlKjkv6Hmga/lpLHotKU6JywgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5blupTnlKjlj4LmlbDphY3nva5cbiAgICog5YyF5ous5byA5Zy655m944CB5bu66K6u6Zeu6aKY44CB5paH5Lu25LiK5Lyg6YWN572u562JXG4gICAqL1xuICBhc3luYyBnZXRQYXJhbWV0ZXJzKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnW0RpZnldIOiOt+WPluW6lOeUqOWPguaVsC4uLicpXG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQuZ2V0KCcvcGFyYW1ldGVycycsIHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3RoaXMuYXBpS2V5fWAsXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICBjb25zb2xlLmxvZygnW0RpZnldIOW6lOeUqOWPguaVsOiOt+WPluaIkOWKnycpXG4gICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbRGlmeV0g6I635Y+W5bqU55So5Y+C5pWw5aSx6LSlOicsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiDliJvlu7ogRGlmeSDlrqLmiLfnq6/lrp7kvotcbiAqXG4gKiBAcGFyYW0gYXBpS2V5IERpZnkgQVBJIEtleVxuICogQHJldHVybnMgRGlmeUNsaWVudCDlrp7kvotcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURpZnlDbGllbnQoYXBpS2V5OiBzdHJpbmcpOiBEaWZ5Q2xpZW50IHtcbiAgcmV0dXJuIG5ldyBEaWZ5Q2xpZW50KHtcbiAgICBhcGlLZXksXG4gICAgYmFzZVVybDogcHJvY2Vzcy5lbnYuRElGWV9BUElfQkFTRV9VUkwgfHwgJ2h0dHBzOi8vYXBpLmRpZnkuYWkvdjEnLFxuICB9KVxufVxuIl0sIm5hbWVzIjpbImF4aW9zIiwiRGlmeUNsaWVudCIsImNsaWVudCIsImFwaUtleSIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiYmFzZVVSTCIsImJhc2VVcmwiLCJ0aW1lb3V0IiwiY3JlYXRlIiwiaGVhZGVycyIsInNlbmRNZXNzYWdlIiwibWVzc2FnZSIsInVzZXJJZCIsImNvbnZlcnNhdGlvbklkIiwiaW5wdXRzIiwiY29uc29sZSIsImxvZyIsInJlcXVlc3REYXRhIiwicXVlcnkiLCJ1c2VyIiwicmVzcG9uc2VfbW9kZSIsImNvbnZlcnNhdGlvbl9pZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXNwb25zZSIsInBvc3QiLCJzdGF0dXMiLCJkYXRhIiwiYW5zd2VyIiwic3Vic3RyaW5nIiwiZXJyb3IiLCJnZXRNZXNzYWdlcyIsImxpbWl0IiwiZmlyc3RJZCIsInBhcmFtcyIsImZpcnN0X2lkIiwiZ2V0IiwibGVuZ3RoIiwiZ2V0Q29udmVyc2F0aW9ucyIsImxhc3RJZCIsImxhc3RfaWQiLCJkZWxldGVDb252ZXJzYXRpb24iLCJkZWxldGUiLCJyZW5hbWVDb252ZXJzYXRpb24iLCJuYW1lIiwiYXV0b0dlbmVyYXRlIiwiYXV0b19nZW5lcmF0ZSIsImdldEFwcEluZm8iLCJnZXRQYXJhbWV0ZXJzIiwiY3JlYXRlRGlmeUNsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJESUZZX0FQSV9CQVNFX1VSTCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/dify.ts\n");

/***/ }),

/***/ "(rsc)/./lib/mongodb.ts":
/*!************************!*\
  !*** ./lib/mongodb.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cleanupExpiredSubscriptions: () => (/* binding */ cleanupExpiredSubscriptions),\n/* harmony export */   closeDB: () => (/* binding */ closeDB),\n/* harmony export */   connectDB: () => (/* binding */ connectDB),\n/* harmony export */   getDB: () => (/* binding */ getDB),\n/* harmony export */   initializeDatabase: () => (/* binding */ initializeDatabase)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n/**\n * MongoDB 连接管理模块\n * 使用单例模式缓存连接，避免每次重复连接\n */ \nconst MONGODB_URI = process.env.MONGODB_URI || \"mongodb://localhost:27017\";\nconst MONGODB_DB_NAME = process.env.MONGODB_DB_NAME || \"game-ai\";\n/**\n * 缓存的连接实例\n */ let cachedClient = null;\nlet cachedDb = null;\n/**\n * 连接到 MongoDB\n * 使用单例模式确保只创建一个连接\n */ async function connectDB() {\n    // 如果已有连接，直接返回\n    if (cachedClient && cachedDb) {\n        console.log(\"[MongoDB] 使用缓存连接\");\n        return cachedDb;\n    }\n    try {\n        console.log(\"[MongoDB] 正在连接...\");\n        const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(MONGODB_URI, {\n            maxPoolSize: 10,\n            minPoolSize: 2,\n            maxIdleTimeMS: 60000\n        });\n        await client.connect();\n        console.log(\"[MongoDB] 连接成功\");\n        // 获取数据库实例\n        const db = client.db(MONGODB_DB_NAME);\n        // 缓存连接和数据库实例\n        cachedClient = client;\n        cachedDb = db;\n        return db;\n    } catch (error) {\n        console.error(\"[MongoDB] 连接失败:\", error);\n        throw error;\n    }\n}\n/**\n * 关闭 MongoDB 连接\n */ async function closeDB() {\n    if (cachedClient) {\n        await cachedClient.close();\n        cachedClient = null;\n        cachedDb = null;\n        console.log(\"[MongoDB] 连接已关闭\");\n    }\n}\n/**\n * 获取当前数据库实例\n */ function getDB() {\n    if (!cachedDb) {\n        throw new Error(\"Database not connected. Call connectDB() first.\");\n    }\n    return cachedDb;\n}\n/**\n * 创建必要的集合和索引\n */ async function initializeDatabase() {\n    try {\n        const db = await connectDB();\n        console.log(\"[MongoDB] 初始化数据库...\");\n        // 创建 subscriptions 集合\n        try {\n            await db.createCollection(\"subscriptions\");\n            console.log(\"[MongoDB] subscriptions 集合已创建\");\n        } catch (error) {\n            if (error.code === 48) {\n                // 集合已存在\n                console.log(\"[MongoDB] subscriptions 集合已存在\");\n            } else {\n                throw error;\n            }\n        }\n        // 创建 subscriptions 索引\n        await db.collection(\"subscriptions\").createIndex({\n            userAddress: 1\n        }, {\n            unique: true\n        });\n        console.log(\"[MongoDB] subscriptions.userAddress 唯一索引已创建\");\n        await db.collection(\"subscriptions\").createIndex({\n            expiresAt: 1\n        });\n        console.log(\"[MongoDB] subscriptions.expiresAt 索引已创建\");\n        await db.collection(\"subscriptions\").createIndex({\n            status: 1\n        });\n        console.log(\"[MongoDB] subscriptions.status 索引已创建\");\n        // 创建 chat_logs 集合（可选）\n        try {\n            await db.createCollection(\"chat_logs\");\n            console.log(\"[MongoDB] chat_logs 集合已创建\");\n        } catch (error) {\n            if (error.code === 48) {\n                console.log(\"[MongoDB] chat_logs 集合已存在\");\n            } else {\n                throw error;\n            }\n        }\n        // 创建 chat_logs 索引\n        await db.collection(\"chat_logs\").createIndex({\n            userAddress: 1\n        });\n        console.log(\"[MongoDB] chat_logs.userAddress 索引已创建\");\n        await db.collection(\"chat_logs\").createIndex({\n            timestamp: 1\n        });\n        console.log(\"[MongoDB] chat_logs.timestamp 索引已创建\");\n        // 创建 gameContent 集合\n        try {\n            await db.createCollection(\"gameContent\");\n            console.log(\"[MongoDB] gameContent 集合已创建\");\n        } catch (error) {\n            if (error.code === 48) {\n                console.log(\"[MongoDB] gameContent 集合已存在\");\n            } else {\n                throw error;\n            }\n        }\n        // 创建 gameContent 索引\n        await db.collection(\"gameContent\").createIndex({\n            contentId: 1\n        }, {\n            unique: true\n        });\n        console.log(\"[MongoDB] gameContent.contentId 唯一索引已创建\");\n        await db.collection(\"gameContent\").createIndex({\n            userAddress: 1\n        });\n        console.log(\"[MongoDB] gameContent.userAddress 索引已创建\");\n        await db.collection(\"gameContent\").createIndex({\n            gameTitle: 1\n        });\n        console.log(\"[MongoDB] gameContent.gameTitle 索引已创建\");\n        await db.collection(\"gameContent\").createIndex({\n            createdAt: 1\n        });\n        console.log(\"[MongoDB] gameContent.createdAt 索引已创建\");\n        // 创建 dividendWithdrawals 集合\n        try {\n            await db.createCollection(\"dividendWithdrawals\");\n            console.log(\"[MongoDB] dividendWithdrawals 集合已创建\");\n        } catch (error) {\n            if (error.code === 48) {\n                console.log(\"[MongoDB] dividendWithdrawals 集合已存在\");\n            } else {\n                throw error;\n            }\n        }\n        // 创建 dividendWithdrawals 索引\n        await db.collection(\"dividendWithdrawals\").createIndex({\n            withdrawalId: 1\n        }, {\n            unique: true\n        });\n        console.log(\"[MongoDB] dividendWithdrawals.withdrawalId 唯一索引已创建\");\n        await db.collection(\"dividendWithdrawals\").createIndex({\n            userAddress: 1\n        });\n        console.log(\"[MongoDB] dividendWithdrawals.userAddress 索引已创建\");\n        await db.collection(\"dividendWithdrawals\").createIndex({\n            transactionHash: 1\n        });\n        console.log(\"[MongoDB] dividendWithdrawals.transactionHash 索引已创建\");\n        await db.collection(\"dividendWithdrawals\").createIndex({\n            createdAt: 1\n        });\n        console.log(\"[MongoDB] dividendWithdrawals.createdAt 索引已创建\");\n        await db.collection(\"dividendWithdrawals\").createIndex({\n            status: 1\n        });\n        console.log(\"[MongoDB] dividendWithdrawals.status 索引已创建\");\n        console.log(\"[MongoDB] 数据库初始化完成\");\n    } catch (error) {\n        console.error(\"[MongoDB] 初始化失败:\", error);\n        throw error;\n    }\n}\n/**\n * 清理过期的订阅\n * 定期调用此函数删除已过期的订阅记录\n */ async function cleanupExpiredSubscriptions() {\n    try {\n        const db = await connectDB();\n        const now = Math.floor(Date.now() / 1000);\n        const result = await db.collection(\"subscriptions\").deleteMany({\n            expiresAt: {\n                $lt: now\n            },\n            status: \"inactive\"\n        });\n        console.log(`[MongoDB] 已清理 ${result.deletedCount} 条过期订阅记录`);\n        return result.deletedCount;\n    } catch (error) {\n        console.error(\"[MongoDB] 清理过期订阅失败:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVFDLEdBQUcsQ0FBQztRQUVaLE1BQU1NLEdBQUdTLFVBQVUsQ0FBQyx1QkFBdUJDLFdBQVcsQ0FBQztZQUFFVSxpQkFBaUI7UUFBRTtRQUM1RTNCLFFBQVFDLEdBQUcsQ0FBQztRQUVaLE1BQU1NLEdBQUdTLFVBQVUsQ0FBQyx1QkFBdUJDLFdBQVcsQ0FBQztZQUFFUSxXQUFXO1FBQUU7UUFDdEV6QixRQUFRQyxHQUFHLENBQUM7UUFFWixNQUFNTSxHQUFHUyxVQUFVLENBQUMsdUJBQXVCQyxXQUFXLENBQUM7WUFBRUksUUFBUTtRQUFFO1FBQ25FckIsUUFBUUMsR0FBRyxDQUFDO1FBRVpELFFBQVFDLEdBQUcsQ0FBQztJQUNkLEVBQUUsT0FBT08sT0FBTztRQUNkUixRQUFRUSxLQUFLLENBQUMsb0JBQW9CQTtRQUNsQyxNQUFNQTtJQUNSO0FBQ0Y7QUFFQTs7O0NBR0MsR0FDTSxlQUFlb0I7SUFDcEIsSUFBSTtRQUNGLE1BQU1yQixLQUFLLE1BQU1SO1FBQ2pCLE1BQU04QixNQUFNQyxLQUFLQyxLQUFLLENBQUNDLEtBQUtILEdBQUcsS0FBSztRQUVwQyxNQUFNSSxTQUFTLE1BQU0xQixHQUFHUyxVQUFVLENBQUMsaUJBQWlCa0IsVUFBVSxDQUFDO1lBQzdEZCxXQUFXO2dCQUFFZSxLQUFLTjtZQUFJO1lBQ3RCUixRQUFRO1FBQ1Y7UUFFQXJCLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGNBQWMsRUFBRWdDLE9BQU9HLFlBQVksQ0FBQyxRQUFRLENBQUM7UUFDMUQsT0FBT0gsT0FBT0csWUFBWTtJQUM1QixFQUFFLE9BQU81QixPQUFPO1FBQ2RSLFFBQVFRLEtBQUssQ0FBQyx1QkFBdUJBO1FBQ3JDLE1BQU1BO0lBQ1I7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL0BnYW1lLWFpL3NlcnZlci8uL2xpYi9tb25nb2RiLnRzPzA1YmQiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNb25nb0RCIOi/nuaOpeeuoeeQhuaooeWdl1xuICog5L2/55So5Y2V5L6L5qih5byP57yT5a2Y6L+e5o6l77yM6YG/5YWN5q+P5qyh6YeN5aSN6L+e5o6lXG4gKi9cblxuaW1wb3J0IHsgTW9uZ29DbGllbnQsIERiIH0gZnJvbSAnbW9uZ29kYidcblxuY29uc3QgTU9OR09EQl9VUkkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSSB8fCAnbW9uZ29kYjovL2xvY2FsaG9zdDoyNzAxNydcbmNvbnN0IE1PTkdPREJfREJfTkFNRSA9IHByb2Nlc3MuZW52Lk1PTkdPREJfREJfTkFNRSB8fCAnZ2FtZS1haSdcblxuLyoqXG4gKiDnvJPlrZjnmoTov57mjqXlrp7kvotcbiAqL1xubGV0IGNhY2hlZENsaWVudDogTW9uZ29DbGllbnQgfCBudWxsID0gbnVsbFxubGV0IGNhY2hlZERiOiBEYiB8IG51bGwgPSBudWxsXG5cbi8qKlxuICog6L+e5o6l5YiwIE1vbmdvREJcbiAqIOS9v+eUqOWNleS+i+aooeW8j+ehruS/neWPquWIm+W7uuS4gOS4qui/nuaOpVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29ubmVjdERCKCk6IFByb21pc2U8RGI+IHtcbiAgLy8g5aaC5p6c5bey5pyJ6L+e5o6l77yM55u05o6l6L+U5ZueXG4gIGlmIChjYWNoZWRDbGllbnQgJiYgY2FjaGVkRGIpIHtcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIOS9v+eUqOe8k+WtmOi/nuaOpScpXG4gICAgcmV0dXJuIGNhY2hlZERiXG4gIH1cblxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0g5q2j5Zyo6L+e5o6lLi4uJylcblxuICAgIGNvbnN0IGNsaWVudCA9IG5ldyBNb25nb0NsaWVudChNT05HT0RCX1VSSSEsIHtcbiAgICAgIG1heFBvb2xTaXplOiAxMCxcbiAgICAgIG1pblBvb2xTaXplOiAyLFxuICAgICAgbWF4SWRsZVRpbWVNUzogNjAwMDAsXG4gICAgfSlcblxuICAgIGF3YWl0IGNsaWVudC5jb25uZWN0KClcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIOi/nuaOpeaIkOWKnycpXG5cbiAgICAvLyDojrflj5bmlbDmja7lupPlrp7kvotcbiAgICBjb25zdCBkYiA9IGNsaWVudC5kYihNT05HT0RCX0RCX05BTUUpXG5cbiAgICAvLyDnvJPlrZjov57mjqXlkozmlbDmja7lupPlrp7kvotcbiAgICBjYWNoZWRDbGllbnQgPSBjbGllbnRcbiAgICBjYWNoZWREYiA9IGRiXG5cbiAgICByZXR1cm4gZGJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbTW9uZ29EQl0g6L+e5o6l5aSx6LSlOicsIGVycm9yKVxuICAgIHRocm93IGVycm9yXG4gIH1cbn1cblxuLyoqXG4gKiDlhbPpl60gTW9uZ29EQiDov57mjqVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsb3NlREIoKTogUHJvbWlzZTx2b2lkPiB7XG4gIGlmIChjYWNoZWRDbGllbnQpIHtcbiAgICBhd2FpdCBjYWNoZWRDbGllbnQuY2xvc2UoKVxuICAgIGNhY2hlZENsaWVudCA9IG51bGxcbiAgICBjYWNoZWREYiA9IG51bGxcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIOi/nuaOpeW3suWFs+mXrScpXG4gIH1cbn1cblxuLyoqXG4gKiDojrflj5blvZPliY3mlbDmja7lupPlrp7kvotcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERCKCk6IERiIHtcbiAgaWYgKCFjYWNoZWREYikge1xuICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2Ugbm90IGNvbm5lY3RlZC4gQ2FsbCBjb25uZWN0REIoKSBmaXJzdC4nKVxuICB9XG4gIHJldHVybiBjYWNoZWREYlxufVxuXG4vKipcbiAqIOWIm+W7uuW/heimgeeahOmbhuWQiOWSjOe0ouW8lVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZURhdGFiYXNlKCk6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgY29ubmVjdERCKClcblxuICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0g5Yid5aeL5YyW5pWw5o2u5bqTLi4uJylcblxuICAgIC8vIOWIm+W7uiBzdWJzY3JpcHRpb25zIOmbhuWQiFxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkYi5jcmVhdGVDb2xsZWN0aW9uKCdzdWJzY3JpcHRpb25zJylcbiAgICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0gc3Vic2NyaXB0aW9ucyDpm4blkIjlt7LliJvlu7onKVxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSA0OCkge1xuICAgICAgICAvLyDpm4blkIjlt7LlrZjlnKhcbiAgICAgICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBzdWJzY3JpcHRpb25zIOmbhuWQiOW3suWtmOWcqCcpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOWIm+W7uiBzdWJzY3JpcHRpb25zIOe0ouW8lVxuICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3N1YnNjcmlwdGlvbnMnKS5jcmVhdGVJbmRleChcbiAgICAgIHsgdXNlckFkZHJlc3M6IDEgfSxcbiAgICAgIHsgdW5pcXVlOiB0cnVlIH1cbiAgICApXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBzdWJzY3JpcHRpb25zLnVzZXJBZGRyZXNzIOWUr+S4gOe0ouW8leW3suWIm+W7uicpXG5cbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdzdWJzY3JpcHRpb25zJykuY3JlYXRlSW5kZXgoeyBleHBpcmVzQXQ6IDEgfSlcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIHN1YnNjcmlwdGlvbnMuZXhwaXJlc0F0IOe0ouW8leW3suWIm+W7uicpXG5cbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdzdWJzY3JpcHRpb25zJykuY3JlYXRlSW5kZXgoeyBzdGF0dXM6IDEgfSlcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIHN1YnNjcmlwdGlvbnMuc3RhdHVzIOe0ouW8leW3suWIm+W7uicpXG5cbiAgICAvLyDliJvlu7ogY2hhdF9sb2dzIOmbhuWQiO+8iOWPr+mAie+8iVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkYi5jcmVhdGVDb2xsZWN0aW9uKCdjaGF0X2xvZ3MnKVxuICAgICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBjaGF0X2xvZ3Mg6ZuG5ZCI5bey5Yib5bu6JylcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gNDgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBjaGF0X2xvZ3Mg6ZuG5ZCI5bey5a2Y5ZyoJylcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IGVycm9yXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g5Yib5bu6IGNoYXRfbG9ncyDntKLlvJVcbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjaGF0X2xvZ3MnKS5jcmVhdGVJbmRleCh7IHVzZXJBZGRyZXNzOiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBjaGF0X2xvZ3MudXNlckFkZHJlc3Mg57Si5byV5bey5Yib5bu6JylcblxuICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NoYXRfbG9ncycpLmNyZWF0ZUluZGV4KHsgdGltZXN0YW1wOiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBjaGF0X2xvZ3MudGltZXN0YW1wIOe0ouW8leW3suWIm+W7uicpXG5cbiAgICAvLyDliJvlu7ogZ2FtZUNvbnRlbnQg6ZuG5ZCIXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGRiLmNyZWF0ZUNvbGxlY3Rpb24oJ2dhbWVDb250ZW50JylcbiAgICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0gZ2FtZUNvbnRlbnQg6ZuG5ZCI5bey5Yib5bu6JylcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gNDgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBnYW1lQ29udGVudCDpm4blkIjlt7LlrZjlnKgnKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDliJvlu7ogZ2FtZUNvbnRlbnQg57Si5byVXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbignZ2FtZUNvbnRlbnQnKS5jcmVhdGVJbmRleCh7IGNvbnRlbnRJZDogMSB9LCB7IHVuaXF1ZTogdHJ1ZSB9KVxuICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0gZ2FtZUNvbnRlbnQuY29udGVudElkIOWUr+S4gOe0ouW8leW3suWIm+W7uicpXG5cbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdnYW1lQ29udGVudCcpLmNyZWF0ZUluZGV4KHsgdXNlckFkZHJlc3M6IDEgfSlcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIGdhbWVDb250ZW50LnVzZXJBZGRyZXNzIOe0ouW8leW3suWIm+W7uicpXG5cbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdnYW1lQ29udGVudCcpLmNyZWF0ZUluZGV4KHsgZ2FtZVRpdGxlOiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBnYW1lQ29udGVudC5nYW1lVGl0bGUg57Si5byV5bey5Yib5bu6JylcblxuICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2dhbWVDb250ZW50JykuY3JlYXRlSW5kZXgoeyBjcmVhdGVkQXQ6IDEgfSlcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIGdhbWVDb250ZW50LmNyZWF0ZWRBdCDntKLlvJXlt7LliJvlu7onKVxuXG4gICAgLy8g5Yib5bu6IGRpdmlkZW5kV2l0aGRyYXdhbHMg6ZuG5ZCIXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGRiLmNyZWF0ZUNvbGxlY3Rpb24oJ2RpdmlkZW5kV2l0aGRyYXdhbHMnKVxuICAgICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBkaXZpZGVuZFdpdGhkcmF3YWxzIOmbhuWQiOW3suWIm+W7uicpXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09IDQ4KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0gZGl2aWRlbmRXaXRoZHJhd2FscyDpm4blkIjlt7LlrZjlnKgnKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDliJvlu7ogZGl2aWRlbmRXaXRoZHJhd2FscyDntKLlvJVcbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdkaXZpZGVuZFdpdGhkcmF3YWxzJykuY3JlYXRlSW5kZXgoeyB3aXRoZHJhd2FsSWQ6IDEgfSwgeyB1bmlxdWU6IHRydWUgfSlcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIGRpdmlkZW5kV2l0aGRyYXdhbHMud2l0aGRyYXdhbElkIOWUr+S4gOe0ouW8leW3suWIm+W7uicpXG5cbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdkaXZpZGVuZFdpdGhkcmF3YWxzJykuY3JlYXRlSW5kZXgoeyB1c2VyQWRkcmVzczogMSB9KVxuICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0gZGl2aWRlbmRXaXRoZHJhd2Fscy51c2VyQWRkcmVzcyDntKLlvJXlt7LliJvlu7onKVxuXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbignZGl2aWRlbmRXaXRoZHJhd2FscycpLmNyZWF0ZUluZGV4KHsgdHJhbnNhY3Rpb25IYXNoOiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBkaXZpZGVuZFdpdGhkcmF3YWxzLnRyYW5zYWN0aW9uSGFzaCDntKLlvJXlt7LliJvlu7onKVxuXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbignZGl2aWRlbmRXaXRoZHJhd2FscycpLmNyZWF0ZUluZGV4KHsgY3JlYXRlZEF0OiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBkaXZpZGVuZFdpdGhkcmF3YWxzLmNyZWF0ZWRBdCDntKLlvJXlt7LliJvlu7onKVxuXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbignZGl2aWRlbmRXaXRoZHJhd2FscycpLmNyZWF0ZUluZGV4KHsgc3RhdHVzOiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBkaXZpZGVuZFdpdGhkcmF3YWxzLnN0YXR1cyDntKLlvJXlt7LliJvlu7onKVxuXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSDmlbDmja7lupPliJ3lp4vljJblrozmiJAnKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tNb25nb0RCXSDliJ3lp4vljJblpLHotKU6JywgZXJyb3IpXG4gICAgdGhyb3cgZXJyb3JcbiAgfVxufVxuXG4vKipcbiAqIOa4heeQhui/h+acn+eahOiuoumYhVxuICog5a6a5pyf6LCD55So5q2k5Ye95pWw5Yig6Zmk5bey6L+H5pyf55qE6K6i6ZiF6K6w5b2VXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwRXhwaXJlZFN1YnNjcmlwdGlvbnMoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBkYiA9IGF3YWl0IGNvbm5lY3REQigpXG4gICAgY29uc3Qgbm93ID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMClcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3N1YnNjcmlwdGlvbnMnKS5kZWxldGVNYW55KHtcbiAgICAgIGV4cGlyZXNBdDogeyAkbHQ6IG5vdyB9LFxuICAgICAgc3RhdHVzOiAnaW5hY3RpdmUnLFxuICAgIH0pXG5cbiAgICBjb25zb2xlLmxvZyhgW01vbmdvREJdIOW3sua4heeQhiAke3Jlc3VsdC5kZWxldGVkQ291bnR9IOadoei/h+acn+iuoumYheiusOW9lWApXG4gICAgcmV0dXJuIHJlc3VsdC5kZWxldGVkQ291bnRcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbTW9uZ29EQl0g5riF55CG6L+H5pyf6K6i6ZiF5aSx6LSlOicsIGVycm9yKVxuICAgIHRocm93IGVycm9yXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsIk1PTkdPREJfVVJJIiwicHJvY2VzcyIsImVudiIsIk1PTkdPREJfREJfTkFNRSIsImNhY2hlZENsaWVudCIsImNhY2hlZERiIiwiY29ubmVjdERCIiwiY29uc29sZSIsImxvZyIsImNsaWVudCIsIm1heFBvb2xTaXplIiwibWluUG9vbFNpemUiLCJtYXhJZGxlVGltZU1TIiwiY29ubmVjdCIsImRiIiwiZXJyb3IiLCJjbG9zZURCIiwiY2xvc2UiLCJnZXREQiIsIkVycm9yIiwiaW5pdGlhbGl6ZURhdGFiYXNlIiwiY3JlYXRlQ29sbGVjdGlvbiIsImNvZGUiLCJjb2xsZWN0aW9uIiwiY3JlYXRlSW5kZXgiLCJ1c2VyQWRkcmVzcyIsInVuaXF1ZSIsImV4cGlyZXNBdCIsInN0YXR1cyIsInRpbWVzdGFtcCIsImNvbnRlbnRJZCIsImdhbWVUaXRsZSIsImNyZWF0ZWRBdCIsIndpdGhkcmF3YWxJZCIsInRyYW5zYWN0aW9uSGFzaCIsImNsZWFudXBFeHBpcmVkU3Vic2NyaXB0aW9ucyIsIm5vdyIsIk1hdGgiLCJmbG9vciIsIkRhdGUiLCJyZXN1bHQiLCJkZWxldGVNYW55IiwiJGx0IiwiZGVsZXRlZENvdW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/mongodb.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/axios","vendor-chunks/asynckit","vendor-chunks/math-intrinsics","vendor-chunks/es-errors","vendor-chunks/call-bind-apply-helpers","vendor-chunks/debug","vendor-chunks/get-proto","vendor-chunks/mime-db","vendor-chunks/has-symbols","vendor-chunks/gopd","vendor-chunks/function-bind","vendor-chunks/form-data","vendor-chunks/follow-redirects","vendor-chunks/supports-color","vendor-chunks/proxy-from-env","vendor-chunks/ms","vendor-chunks/mime-types","vendor-chunks/hasown","vendor-chunks/has-tostringtag","vendor-chunks/has-flag","vendor-chunks/get-intrinsic","vendor-chunks/es-set-tostringtag","vendor-chunks/es-object-atoms","vendor-chunks/es-define-property","vendor-chunks/dunder-proto","vendor-chunks/delayed-stream","vendor-chunks/combined-stream"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Finference%2Fchat%2Froute&page=%2Fapi%2Finference%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Finference%2Fchat%2Froute.ts&appDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();