"use strict";(()=>{var e={};e.id=152,e.ids=[152],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5999:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>A,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var r={};o.r(r),o.d(r,{GET:()=>c,OPTIONS:()=>d});var n=o(9303),s=o(8716),a=o(670),i=o(7070),l=o(2021),u=o(5029);async function c(e){try{let t=e.nextUrl.searchParams.get("address");if(!t)return console.warn("[Content Stats API] 缺少必需参数: address"),i.NextResponse.json({success:!1,error:"Missing required parameter: address"},{status:400});if(!(0,u.At)(t))return console.warn("[Content Stats API] 无效的钱包地址:",t),i.NextResponse.json({success:!1,error:"Invalid wallet address format"},{status:400});let o=(0,u.f0)(t);console.log("[Content Stats API] 查询创作者统计，地址:",o);let r=await (0,l.uD)(),n=await r.collection("gameContent").find({userAddress:o}).toArray(),s=n.length,a=n.filter(e=>"approved"===e.status).length,c=n.reduce((e,t)=>e+(t.queryCount||0),0),d="0",p="0",g="0";return n.forEach(e=>{let t=BigInt(e.rewardAmount||"0");d=(BigInt(d)+t).toString(),"distributed"===e.rewardStatus?p=(BigInt(p)+t).toString():"pending"===e.rewardStatus&&(g=(BigInt(g)+t).toString())}),console.log("[Content Stats API] 统计完成",{totalContent:s,publishedContent:a,totalQueryCount:c,totalRewardEarned:d}),i.NextResponse.json({success:!0,stats:{totalContent:s,publishedContent:a,totalQueryCount:c,totalRewardEarned:d,distributedReward:p,pendingReward:g}},{status:200})}catch(e){return console.error("[Content Stats API] 处理请求失败:",e),i.NextResponse.json({success:!1,error:"Failed to query content stats",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}let p=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/content/stats/route",pathname:"/api/content/stats",filename:"route",bundlePath:"app/api/content/stats/route"},resolvedPagePath:"/Users/daniel/Code/10_project/Game/server/app/api/content/stats/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:f}=p,A="/api/content/stats/route";function w(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},5029:(e,t,o)=>{function r(e){return/^0x[a-fA-F0-9]{40}$/.test(e)}function n(e){if(!r(e))throw Error("Invalid address format");return e.toLowerCase()}o.d(t,{At:()=>r,f0:()=>n})},2021:(e,t,o)=>{o.d(t,{uD:()=>l});var r=o(8013);let n=process.env.MONGODB_URI||"mongodb://localhost:27017",s=process.env.MONGODB_DB_NAME||"game-ai",a=null,i=null;async function l(){if(a&&i)return console.log("[MongoDB] 使用缓存连接"),i;try{console.log("[MongoDB] 正在连接...");let e=new r.MongoClient(n,{maxPoolSize:10,minPoolSize:2,maxIdleTimeMS:6e4});await e.connect(),console.log("[MongoDB] 连接成功");let t=e.db(s);return a=e,i=t,t}catch(e){throw console.error("[MongoDB] 连接失败:",e),e}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[789],()=>o(5999));module.exports=r})();