"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/subscription/activate/route";
exports.ids = ["app/api/subscription/activate/route"];
exports.modules = {

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubscription%2Factivate%2Froute&page=%2Fapi%2Fsubscription%2Factivate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubscription%2Factivate%2Froute.ts&appDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubscription%2Factivate%2Froute&page=%2Fapi%2Fsubscription%2Factivate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubscription%2Factivate%2Froute.ts&appDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_daniel_Code_10_project_Game_server_app_api_subscription_activate_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/subscription/activate/route.ts */ \"(rsc)/./app/api/subscription/activate/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/subscription/activate/route\",\n        pathname: \"/api/subscription/activate\",\n        filename: \"route\",\n        bundlePath: \"app/api/subscription/activate/route\"\n    },\n    resolvedPagePath: \"/Users/daniel/Code/10_project/Game/server/app/api/subscription/activate/route.ts\",\n    nextConfigOutput,\n    userland: _Users_daniel_Code_10_project_Game_server_app_api_subscription_activate_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/subscription/activate/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzdWJzY3JpcHRpb24lMkZhY3RpdmF0ZSUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGc3Vic2NyaXB0aW9uJTJGYWN0aXZhdGUlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZzdWJzY3JpcHRpb24lMkZhY3RpdmF0ZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmRhbmllbCUyRkNvZGUlMkYxMF9wcm9qZWN0JTJGR2FtZSUyRnNlcnZlciUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZkYW5pZWwlMkZDb2RlJTJGMTBfcHJvamVjdCUyRkdhbWUlMkZzZXJ2ZXImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ2dDO0FBQzdHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdhbWUtYWkvc2VydmVyLz82ZGI5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9kYW5pZWwvQ29kZS8xMF9wcm9qZWN0L0dhbWUvc2VydmVyL2FwcC9hcGkvc3Vic2NyaXB0aW9uL2FjdGl2YXRlL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9zdWJzY3JpcHRpb24vYWN0aXZhdGUvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zdWJzY3JpcHRpb24vYWN0aXZhdGVcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3N1YnNjcmlwdGlvbi9hY3RpdmF0ZS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9kYW5pZWwvQ29kZS8xMF9wcm9qZWN0L0dhbWUvc2VydmVyL2FwcC9hcGkvc3Vic2NyaXB0aW9uL2FjdGl2YXRlL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9zdWJzY3JpcHRpb24vYWN0aXZhdGUvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubscription%2Factivate%2Froute&page=%2Fapi%2Fsubscription%2Factivate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubscription%2Factivate%2Froute.ts&appDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/subscription/activate/route.ts":
/*!************************************************!*\
  !*** ./app/api/subscription/activate/route.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/mongodb */ \"(rsc)/./lib/mongodb.ts\");\n/* harmony import */ var _lib_address_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/address-utils */ \"(rsc)/./lib/address-utils.ts\");\n/* harmony import */ var _lib_blockchain__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/blockchain */ \"(rsc)/./lib/blockchain.ts\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ethers */ \"(rsc)/./node_modules/@ethersproject/providers/lib.esm/json-rpc-provider.js\");\n/**\n * 订阅激活 API 路由\n *\n * 功能：\n * 1. 验证链上交易\n * 2. 激活或续期订阅\n * 3. 返回新的到期时间\n *\n * 请求方式: POST /api/subscription/activate\n *\n * 请求体格式:\n * {\n *   \"userAddress\": \"0x...\",\n *   \"transactionHash\": \"0x...\",     // 支付交易哈希\n *   \"amount\": \"10\"                   // 支付金额（验证用）\n * }\n *\n * 响应格式:\n * {\n *   \"success\": true,\n *   \"expiresAt\": 1729876000,\n *   \"message\": \"订阅已激活，有效期30天\"\n * }\n */ \n\n\n\n\n// 订阅参数\nconst SUBSCRIPTION_AMOUNT = \"10\" // 10 $VIRTUAL\n;\nconst SUBSCRIPTION_PERIOD_DAYS = 30;\n/**\n * 验证链上交易\n * 连接到 Base RPC 验证交易是否有效\n */ async function verifyTransaction(transactionHash, userAddress, amount) {\n    try {\n        console.log(\"[Subscription Activate API] 验证交易...\");\n        console.log(\"[Subscription Activate API] 交易哈希:\", transactionHash);\n        console.log(\"[Subscription Activate API] 用户地址:\", userAddress);\n        console.log(\"[Subscription Activate API] 金额:\", amount);\n        // 基本格式验证\n        if (!/^0x[a-fA-F0-9]{64}$/.test(transactionHash)) {\n            console.warn(\"[Subscription Activate API] 交易哈希格式无效\");\n            return {\n                valid: false,\n                error: \"Invalid transaction hash format\"\n            };\n        }\n        // 使用 Base RPC 验证交易\n        const rpcUrl = process.env.BASE_SEPOLIA_RPC_URL || process.env.BASE_RPC_URL;\n        if (!rpcUrl) {\n            console.warn(\"[Subscription Activate API] RPC URL 未配置，跳过链上验证\");\n            // 开发环境中允许跳过链上验证，但只进行格式检查\n            return {\n                valid: true\n            };\n        }\n        try {\n            const provider = new ethers__WEBPACK_IMPORTED_MODULE_4__.JsonRpcProvider(rpcUrl);\n            console.log(\"[Subscription Activate API] 正在从 RPC 查询交易收据...\");\n            const receipt = await provider.getTransactionReceipt(transactionHash);\n            if (!receipt) {\n                console.warn(\"[Subscription Activate API] 交易尚未确认（收据不存在）\");\n                return {\n                    valid: false,\n                    error: \"Transaction not yet confirmed\"\n                };\n            }\n            console.log(\"[Subscription Activate API] 交易收据已获取，状态:\", receipt.status);\n            if (receipt.status === 0) {\n                console.warn(\"[Subscription Activate API] 交易失败\");\n                return {\n                    valid: false,\n                    error: \"Transaction failed on chain\"\n                };\n            }\n            console.log(\"[Subscription Activate API] 交易已验证，区块号:\", receipt.blockNumber);\n            return {\n                valid: true\n            };\n        } catch (rpcError) {\n            console.warn(\"[Subscription Activate API] RPC 查询失败:\", rpcError.message);\n            console.warn(\"[Subscription Activate API] 错误堆栈:\", rpcError.stack);\n            // 如果 RPC 查询失败，返回错误\n            return {\n                valid: false,\n                error: \"Failed to verify transaction on chain\"\n            };\n        }\n    } catch (error) {\n        console.error(\"[Subscription Activate API] 交易验证异常:\", error);\n        return {\n            valid: false,\n            error: \"Transaction verification error\"\n        };\n    }\n}\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const { userAddress, transactionHash, amount } = body;\n        // 参数验证\n        if (!userAddress || !transactionHash || !amount) {\n            console.warn(\"[Subscription Activate API] 缺少必需参数\");\n            return corsJson({\n                success: false,\n                error: \"Missing required parameters: userAddress, transactionHash, amount\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(\"[Subscription Activate API] 激活订阅请求，用户地址:\", userAddress);\n        // 验证地址格式\n        if (!(0,_lib_address_utils__WEBPACK_IMPORTED_MODULE_2__.isValidAddress)(userAddress)) {\n            console.warn(\"[Subscription Activate API] 无效的钱包地址:\", userAddress);\n            return corsJson({\n                success: false,\n                error: \"Invalid user address format\"\n            }, {\n                status: 400\n            });\n        }\n        const normalizedAddress = (0,_lib_address_utils__WEBPACK_IMPORTED_MODULE_2__.normalizeAddress)(userAddress);\n        // 验证金额\n        if (String(amount) !== SUBSCRIPTION_AMOUNT) {\n            console.warn(\"[Subscription Activate API] 无效的金额:\", amount, \"期望:\", SUBSCRIPTION_AMOUNT);\n            return corsJson({\n                success: false,\n                error: `Invalid amount. Expected ${SUBSCRIPTION_AMOUNT} $VIRTUAL, got ${amount}`\n            }, {\n                status: 400\n            });\n        }\n        // 验证交易\n        const txVerification = await verifyTransaction(transactionHash, normalizedAddress, amount);\n        if (!txVerification.valid) {\n            console.warn(\"[Subscription Activate API] 交易验证失败:\", txVerification.error);\n            return corsJson({\n                success: false,\n                error: \"Transaction verification failed\",\n                details: txVerification.error\n            }, {\n                status: 400\n            });\n        }\n        // 连接数据库\n        const db = await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectDB)();\n        // 计算新的到期时间（使用秒级 Unix 时间戳）\n        const now = Math.floor(Date.now() / 1000);\n        const expiresAt = now + SUBSCRIPTION_PERIOD_DAYS * 24 * 3600;\n        // 查询现有订阅\n        const existingSubscription = await db.collection(\"subscriptions\").findOne({\n            userAddress: normalizedAddress\n        });\n        let isRenewal = false;\n        if (existingSubscription) {\n            // 续期现有订阅\n            console.log(\"[Subscription Activate API] 续期现有订阅\");\n            await db.collection(\"subscriptions\").updateOne({\n                userAddress: normalizedAddress\n            }, {\n                $set: {\n                    status: \"active\",\n                    expiresAt,\n                    renewedAt: now,\n                    transactionHash,\n                    updatedAt: new Date()\n                }\n            });\n            isRenewal = true;\n        } else {\n            // 创建新订阅\n            console.log(\"[Subscription Activate API] 创建新订阅\");\n            await db.collection(\"subscriptions\").insertOne({\n                userAddress: normalizedAddress,\n                status: \"active\",\n                expiresAt,\n                startedAt: now,\n                renewedAt: now,\n                transactionHash,\n                createdAt: new Date(),\n                updatedAt: new Date()\n            });\n        }\n        console.log(\"[Subscription Activate API] 订阅\", isRenewal ? \"续期\" : \"激活\", \"成功，到期时间:\", new Date(expiresAt * 1000));\n        // 激活订阅成功后，调用合约更新分红\n        // 10 VIRTUAL 的 70% = 7 VIRTUAL 进入分红池\n        let dividendUpdateTxHash = null;\n        try {\n            const dividendPoolAddress = process.env.GAME_DIVIDEND_POOL_ADDRESS;\n            const dividendAmount = (0,_lib_blockchain__WEBPACK_IMPORTED_MODULE_3__.toWei)(\"7\") // 10 VIRTUAL 的 70%\n            ;\n            if (dividendPoolAddress) {\n                console.log(\"[Subscription Activate API] 准备更新分红池...\");\n                const blockchain = (0,_lib_blockchain__WEBPACK_IMPORTED_MODULE_3__.createBlockchainClient)();\n                const dividendTxResult = await blockchain.updateGameDividendPool(dividendPoolAddress, dividendAmount);\n                dividendUpdateTxHash = dividendTxResult.transactionHash;\n                console.log(\"[Subscription Activate API] 分红已更新，TX Hash:\", dividendUpdateTxHash);\n                // 可选：将 dividendUpdateTxHash 存储到数据库的订阅记录中\n                await db.collection(\"subscriptions\").updateOne({\n                    userAddress: normalizedAddress\n                }, {\n                    $set: {\n                        dividendUpdateTxHash,\n                        updatedAt: new Date()\n                    }\n                });\n            } else {\n                console.warn(\"[Subscription Activate API] GAME_DIVIDEND_POOL_ADDRESS 未配置，跳过分红更新\");\n            }\n        } catch (dividendError) {\n            console.error(\"[Subscription Activate API] 分红更新失败:\", dividendError);\n        // 不中断请求，订阅已经创建成功，分红更新可以后续重试\n        // 在实际生产环境中，可能需要添加重试机制或告警\n        }\n        return corsJson({\n            success: true,\n            expiresAt,\n            dividendUpdateTxHash,\n            message: isRenewal ? \"订阅已续期，有效期30天\" : \"订阅已激活，有效期30天\"\n        }, {\n            status: 200\n        });\n    } catch (error) {\n        console.error(\"[Subscription Activate API] 处理请求失败:\", error);\n        return corsJson({\n            success: false,\n            error: \"Failed to activate subscription\",\n            details: error instanceof Error ? error.message : \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n/**\n * 处理 OPTIONS 请求（用于 CORS 预检）\n */ async function OPTIONS() {\n    return corsJson(null, {\n        status: 200\n    });\n}\nfunction corsJson(body, init) {\n    const response = body === null ? new next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse(null, init) : next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(body, init);\n    response.headers.set(\"Access-Control-Allow-Origin\", \"*\");\n    response.headers.set(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n    response.headers.set(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n    response.headers.set(\"Access-Control-Allow-Credentials\", \"true\");\n    return response;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3N1YnNjcmlwdGlvbi9hY3RpdmF0ZS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0NBdUJDLEdBRXNEO0FBQ2Q7QUFDNkI7QUFDTjtBQUNqQztBQUUvQixPQUFPO0FBQ1AsTUFBTU8sc0JBQXNCLEtBQUssY0FBYzs7QUFDL0MsTUFBTUMsMkJBQTJCO0FBRWpDOzs7Q0FHQyxHQUNELGVBQWVDLGtCQUNiQyxlQUF1QixFQUN2QkMsV0FBbUIsRUFDbkJDLE1BQWM7SUFFZCxJQUFJO1FBQ0ZDLFFBQVFDLEdBQUcsQ0FBQztRQUNaRCxRQUFRQyxHQUFHLENBQUMscUNBQXFDSjtRQUNqREcsUUFBUUMsR0FBRyxDQUFDLHFDQUFxQ0g7UUFDakRFLFFBQVFDLEdBQUcsQ0FBQyxtQ0FBbUNGO1FBRS9DLFNBQVM7UUFDVCxJQUFJLENBQUMsc0JBQXNCRyxJQUFJLENBQUNMLGtCQUFrQjtZQUNoREcsUUFBUUcsSUFBSSxDQUFDO1lBQ2IsT0FBTztnQkFBRUMsT0FBTztnQkFBT0MsT0FBTztZQUFrQztRQUNsRTtRQUVBLG1CQUFtQjtRQUNuQixNQUFNQyxTQUFTQyxRQUFRQyxHQUFHLENBQUNDLG9CQUFvQixJQUFJRixRQUFRQyxHQUFHLENBQUNFLFlBQVk7UUFDM0UsSUFBSSxDQUFDSixRQUFRO1lBQ1hOLFFBQVFHLElBQUksQ0FBQztZQUNiLHlCQUF5QjtZQUN6QixPQUFPO2dCQUFFQyxPQUFPO1lBQUs7UUFDdkI7UUFFQSxJQUFJO1lBQ0YsTUFBTU8sV0FBVyxJQUFJbEIsbURBQWdDLENBQUNhO1lBQ3RETixRQUFRQyxHQUFHLENBQUM7WUFDWixNQUFNYSxVQUFVLE1BQU1ILFNBQVNJLHFCQUFxQixDQUFDbEI7WUFFckQsSUFBSSxDQUFDaUIsU0FBUztnQkFDWmQsUUFBUUcsSUFBSSxDQUFDO2dCQUNiLE9BQU87b0JBQUVDLE9BQU87b0JBQU9DLE9BQU87Z0JBQWdDO1lBQ2hFO1lBRUFM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RUFBRSxPQUFPb0QsZUFBZTtZQUN0QnZELFFBQVFLLEtBQUssQ0FBQyx1Q0FBdUNrRDtRQUNyRCw0QkFBNEI7UUFDNUIseUJBQXlCO1FBQzNCO1FBRUEsT0FBTzlCLFNBQ0w7WUFDRUMsU0FBUztZQUNUVTtZQUNBWTtZQUNBN0IsU0FBU3FCLFlBQVksaUJBQWlCO1FBQ3hDLEdBQ0E7WUFBRXhCLFFBQVE7UUFBSTtJQUVsQixFQUFFLE9BQU9YLE9BQU87UUFDZEwsUUFBUUssS0FBSyxDQUFDLHVDQUF1Q0E7UUFDckQsT0FBT29CLFNBQ0w7WUFDRUMsU0FBUztZQUNUckIsT0FBTztZQUNQeUIsU0FBU3pCLGlCQUFpQm1ELFFBQVFuRCxNQUFNYyxPQUFPLEdBQUc7UUFDcEQsR0FDQTtZQUFFSCxRQUFRO1FBQUk7SUFFbEI7QUFDRjtBQUVBOztDQUVDLEdBQ00sZUFBZXlDO0lBQ3BCLE9BQU9oQyxTQUFTLE1BQU07UUFBRVQsUUFBUTtJQUFJO0FBQ3RDO0FBRUEsU0FBU1MsU0FBU0YsSUFBUyxFQUFFbUMsSUFBbUI7SUFDOUMsTUFBTUMsV0FBV3BDLFNBQVMsT0FDdEIsSUFBSXBDLHFEQUFZQSxDQUFDLE1BQU11RSxRQUN2QnZFLHFEQUFZQSxDQUFDcUMsSUFBSSxDQUFDRCxNQUFNbUM7SUFDNUJDLFNBQVNDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLCtCQUErQjtJQUNwREYsU0FBU0MsT0FBTyxDQUFDQyxHQUFHLENBQUMsZ0NBQWdDO0lBQ3JERixTQUFTQyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxnQ0FBZ0M7SUFDckRGLFNBQVNDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLG9DQUFvQztJQUN6RCxPQUFPRjtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdhbWUtYWkvc2VydmVyLy4vYXBwL2FwaS9zdWJzY3JpcHRpb24vYWN0aXZhdGUvcm91dGUudHM/ODlhYyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIOiuoumYhea/gOa0uyBBUEkg6Lev55SxXG4gKlxuICog5Yqf6IO977yaXG4gKiAxLiDpqozor4Hpk77kuIrkuqTmmJNcbiAqIDIuIOa/gOa0u+aIlue7reacn+iuoumYhVxuICogMy4g6L+U5Zue5paw55qE5Yiw5pyf5pe26Ze0XG4gKlxuICog6K+35rGC5pa55byPOiBQT1NUIC9hcGkvc3Vic2NyaXB0aW9uL2FjdGl2YXRlXG4gKlxuICog6K+35rGC5L2T5qC85byPOlxuICoge1xuICogICBcInVzZXJBZGRyZXNzXCI6IFwiMHguLi5cIixcbiAqICAgXCJ0cmFuc2FjdGlvbkhhc2hcIjogXCIweC4uLlwiLCAgICAgLy8g5pSv5LuY5Lqk5piT5ZOI5biMXG4gKiAgIFwiYW1vdW50XCI6IFwiMTBcIiAgICAgICAgICAgICAgICAgICAvLyDmlK/ku5jph5Hpop3vvIjpqozor4HnlKjvvIlcbiAqIH1cbiAqXG4gKiDlk43lupTmoLzlvI86XG4gKiB7XG4gKiAgIFwic3VjY2Vzc1wiOiB0cnVlLFxuICogICBcImV4cGlyZXNBdFwiOiAxNzI5ODc2MDAwLFxuICogICBcIm1lc3NhZ2VcIjogXCLorqLpmIXlt7Lmv4DmtLvvvIzmnInmlYjmnJ8zMOWkqVwiXG4gKiB9XG4gKi9cblxuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgY29ubmVjdERCIH0gZnJvbSAnQC9saWIvbW9uZ29kYidcbmltcG9ydCB7IGlzVmFsaWRBZGRyZXNzLCBub3JtYWxpemVBZGRyZXNzIH0gZnJvbSAnQC9saWIvYWRkcmVzcy11dGlscydcbmltcG9ydCB7IGNyZWF0ZUJsb2NrY2hhaW5DbGllbnQsIHRvV2VpIH0gZnJvbSAnQC9saWIvYmxvY2tjaGFpbidcbmltcG9ydCB7IGV0aGVycyB9IGZyb20gJ2V0aGVycydcblxuLy8g6K6i6ZiF5Y+C5pWwXG5jb25zdCBTVUJTQ1JJUFRJT05fQU1PVU5UID0gJzEwJyAvLyAxMCAkVklSVFVBTFxuY29uc3QgU1VCU0NSSVBUSU9OX1BFUklPRF9EQVlTID0gMzBcblxuLyoqXG4gKiDpqozor4Hpk77kuIrkuqTmmJNcbiAqIOi/nuaOpeWIsCBCYXNlIFJQQyDpqozor4HkuqTmmJPmmK/lkKbmnInmlYhcbiAqL1xuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5VHJhbnNhY3Rpb24oXG4gIHRyYW5zYWN0aW9uSGFzaDogc3RyaW5nLFxuICB1c2VyQWRkcmVzczogc3RyaW5nLFxuICBhbW91bnQ6IHN0cmluZ1xuKTogUHJvbWlzZTx7IHZhbGlkOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9PiB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSDpqozor4HkuqTmmJMuLi4nKVxuICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uIEFjdGl2YXRlIEFQSV0g5Lqk5piT5ZOI5biMOicsIHRyYW5zYWN0aW9uSGFzaClcbiAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbiBBY3RpdmF0ZSBBUEldIOeUqOaIt+WcsOWdgDonLCB1c2VyQWRkcmVzcylcbiAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbiBBY3RpdmF0ZSBBUEldIOmHkeminTonLCBhbW91bnQpXG5cbiAgICAvLyDln7rmnKzmoLzlvI/pqozor4FcbiAgICBpZiAoIS9eMHhbYS1mQS1GMC05XXs2NH0kLy50ZXN0KHRyYW5zYWN0aW9uSGFzaCkpIHtcbiAgICAgIGNvbnNvbGUud2FybignW1N1YnNjcmlwdGlvbiBBY3RpdmF0ZSBBUEldIOS6pOaYk+WTiOW4jOagvOW8j+aXoOaViCcpXG4gICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnSW52YWxpZCB0cmFuc2FjdGlvbiBoYXNoIGZvcm1hdCcgfVxuICAgIH1cblxuICAgIC8vIOS9v+eUqCBCYXNlIFJQQyDpqozor4HkuqTmmJNcbiAgICBjb25zdCBycGNVcmwgPSBwcm9jZXNzLmVudi5CQVNFX1NFUE9MSUFfUlBDX1VSTCB8fCBwcm9jZXNzLmVudi5CQVNFX1JQQ19VUkxcbiAgICBpZiAoIXJwY1VybCkge1xuICAgICAgY29uc29sZS53YXJuKCdbU3Vic2NyaXB0aW9uIEFjdGl2YXRlIEFQSV0gUlBDIFVSTCDmnKrphY3nva7vvIzot7Pov4fpk77kuIrpqozor4EnKVxuICAgICAgLy8g5byA5Y+R546v5aKD5Lit5YWB6K646Lez6L+H6ZO+5LiK6aqM6K+B77yM5L2G5Y+q6L+b6KGM5qC85byP5qOA5p+lXG4gICAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSB9XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHByb3ZpZGVyID0gbmV3IGV0aGVycy5wcm92aWRlcnMuSnNvblJwY1Byb3ZpZGVyKHJwY1VybClcbiAgICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uIEFjdGl2YXRlIEFQSV0g5q2j5Zyo5LuOIFJQQyDmn6Xor6LkuqTmmJPmlLbmja4uLi4nKVxuICAgICAgY29uc3QgcmVjZWlwdCA9IGF3YWl0IHByb3ZpZGVyLmdldFRyYW5zYWN0aW9uUmVjZWlwdCh0cmFuc2FjdGlvbkhhc2gpXG5cbiAgICAgIGlmICghcmVjZWlwdCkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSDkuqTmmJPlsJrmnKrnoa7orqTvvIjmlLbmja7kuI3lrZjlnKjvvIknKVxuICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVHJhbnNhY3Rpb24gbm90IHlldCBjb25maXJtZWQnIH1cbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSDkuqTmmJPmlLbmja7lt7Lojrflj5bvvIznirbmgIE6JywgcmVjZWlwdC5zdGF0dXMpXG5cbiAgICAgIGlmIChyZWNlaXB0LnN0YXR1cyA9PT0gMCkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSDkuqTmmJPlpLHotKUnKVxuICAgICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVHJhbnNhY3Rpb24gZmFpbGVkIG9uIGNoYWluJyB9XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uIEFjdGl2YXRlIEFQSV0g5Lqk5piT5bey6aqM6K+B77yM5Yy65Z2X5Y+3OicsIHJlY2VpcHQuYmxvY2tOdW1iZXIpXG4gICAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSB9XG4gICAgfSBjYXRjaCAocnBjRXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS53YXJuKCdbU3Vic2NyaXB0aW9uIEFjdGl2YXRlIEFQSV0gUlBDIOafpeivouWksei0pTonLCBycGNFcnJvci5tZXNzYWdlKVxuICAgICAgY29uc29sZS53YXJuKCdbU3Vic2NyaXB0aW9uIEFjdGl2YXRlIEFQSV0g6ZSZ6K+v5aCG5qCIOicsIHJwY0Vycm9yLnN0YWNrKVxuICAgICAgLy8g5aaC5p6cIFJQQyDmn6Xor6LlpLHotKXvvIzov5Tlm57plJnor69cbiAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdGYWlsZWQgdG8gdmVyaWZ5IHRyYW5zYWN0aW9uIG9uIGNoYWluJyB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSDkuqTmmJPpqozor4HlvILluLg6JywgZXJyb3IpXG4gICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ1RyYW5zYWN0aW9uIHZlcmlmaWNhdGlvbiBlcnJvcicgfVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gICAgY29uc3QgeyB1c2VyQWRkcmVzcywgdHJhbnNhY3Rpb25IYXNoLCBhbW91bnQgfSA9IGJvZHlcblxuICAgIC8vIOWPguaVsOmqjOivgVxuICAgIGlmICghdXNlckFkZHJlc3MgfHwgIXRyYW5zYWN0aW9uSGFzaCB8fCAhYW1vdW50KSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSDnvLrlsJHlv4XpnIDlj4LmlbAnKVxuICAgICAgcmV0dXJuIGNvcnNKc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIHBhcmFtZXRlcnM6IHVzZXJBZGRyZXNzLCB0cmFuc2FjdGlvbkhhc2gsIGFtb3VudCcsXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uIEFjdGl2YXRlIEFQSV0g5r+A5rS76K6i6ZiF6K+35rGC77yM55So5oi35Zyw5Z2AOicsIHVzZXJBZGRyZXNzKVxuXG4gICAgLy8g6aqM6K+B5Zyw5Z2A5qC85byPXG4gICAgaWYgKCFpc1ZhbGlkQWRkcmVzcyh1c2VyQWRkcmVzcykpIHtcbiAgICAgIGNvbnNvbGUud2FybignW1N1YnNjcmlwdGlvbiBBY3RpdmF0ZSBBUEldIOaXoOaViOeahOmSseWMheWcsOWdgDonLCB1c2VyQWRkcmVzcylcbiAgICAgIHJldHVybiBjb3JzSnNvbihcbiAgICAgICAge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiAnSW52YWxpZCB1c2VyIGFkZHJlc3MgZm9ybWF0JyxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3Qgbm9ybWFsaXplZEFkZHJlc3MgPSBub3JtYWxpemVBZGRyZXNzKHVzZXJBZGRyZXNzKVxuXG4gICAgLy8g6aqM6K+B6YeR6aKdXG4gICAgaWYgKFN0cmluZyhhbW91bnQpICE9PSBTVUJTQ1JJUFRJT05fQU1PVU5UKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSDml6DmlYjnmoTph5Hpop06JywgYW1vdW50LCAn5pyf5pybOicsIFNVQlNDUklQVElPTl9BTU9VTlQpXG4gICAgICByZXR1cm4gY29yc0pzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjogYEludmFsaWQgYW1vdW50LiBFeHBlY3RlZCAke1NVQlNDUklQVElPTl9BTU9VTlR9ICRWSVJUVUFMLCBnb3QgJHthbW91bnR9YCxcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8g6aqM6K+B5Lqk5piTXG4gICAgY29uc3QgdHhWZXJpZmljYXRpb24gPSBhd2FpdCB2ZXJpZnlUcmFuc2FjdGlvbih0cmFuc2FjdGlvbkhhc2gsIG5vcm1hbGl6ZWRBZGRyZXNzLCBhbW91bnQpXG4gICAgaWYgKCF0eFZlcmlmaWNhdGlvbi52YWxpZCkge1xuICAgICAgY29uc29sZS53YXJuKCdbU3Vic2NyaXB0aW9uIEFjdGl2YXRlIEFQSV0g5Lqk5piT6aqM6K+B5aSx6LSlOicsIHR4VmVyaWZpY2F0aW9uLmVycm9yKVxuICAgICAgcmV0dXJuIGNvcnNKc29uKFxuICAgICAgICB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdUcmFuc2FjdGlvbiB2ZXJpZmljYXRpb24gZmFpbGVkJyxcbiAgICAgICAgICBkZXRhaWxzOiB0eFZlcmlmaWNhdGlvbi5lcnJvcixcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8g6L+e5o6l5pWw5o2u5bqTXG4gICAgY29uc3QgZGIgPSBhd2FpdCBjb25uZWN0REIoKVxuXG4gICAgLy8g6K6h566X5paw55qE5Yiw5pyf5pe26Ze077yI5L2/55So56eS57qnIFVuaXgg5pe26Ze05oiz77yJXG4gICAgY29uc3Qgbm93ID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMClcbiAgICBjb25zdCBleHBpcmVzQXQgPSBub3cgKyBTVUJTQ1JJUFRJT05fUEVSSU9EX0RBWVMgKiAyNCAqIDM2MDBcblxuICAgIC8vIOafpeivoueOsOacieiuoumYhVxuICAgIGNvbnN0IGV4aXN0aW5nU3Vic2NyaXB0aW9uID0gYXdhaXQgZGJcbiAgICAgIC5jb2xsZWN0aW9uKCdzdWJzY3JpcHRpb25zJylcbiAgICAgIC5maW5kT25lKHsgdXNlckFkZHJlc3M6IG5vcm1hbGl6ZWRBZGRyZXNzIH0pXG5cbiAgICBsZXQgaXNSZW5ld2FsID0gZmFsc2VcblxuICAgIGlmIChleGlzdGluZ1N1YnNjcmlwdGlvbikge1xuICAgICAgLy8g57ut5pyf546w5pyJ6K6i6ZiFXG4gICAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbiBBY3RpdmF0ZSBBUEldIOe7reacn+eOsOacieiuoumYhScpXG4gICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdzdWJzY3JpcHRpb25zJykudXBkYXRlT25lKFxuICAgICAgICB7IHVzZXJBZGRyZXNzOiBub3JtYWxpemVkQWRkcmVzcyB9LFxuICAgICAgICB7XG4gICAgICAgICAgJHNldDoge1xuICAgICAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgICAgIGV4cGlyZXNBdCxcbiAgICAgICAgICAgIHJlbmV3ZWRBdDogbm93LFxuICAgICAgICAgICAgdHJhbnNhY3Rpb25IYXNoLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIGlzUmVuZXdhbCA9IHRydWVcbiAgICB9IGVsc2Uge1xuICAgICAgLy8g5Yib5bu65paw6K6i6ZiFXG4gICAgICBjb25zb2xlLmxvZygnW1N1YnNjcmlwdGlvbiBBY3RpdmF0ZSBBUEldIOWIm+W7uuaWsOiuoumYhScpXG4gICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdzdWJzY3JpcHRpb25zJykuaW5zZXJ0T25lKHtcbiAgICAgICAgdXNlckFkZHJlc3M6IG5vcm1hbGl6ZWRBZGRyZXNzLFxuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgICBleHBpcmVzQXQsXG4gICAgICAgIHN0YXJ0ZWRBdDogbm93LFxuICAgICAgICByZW5ld2VkQXQ6IG5vdyxcbiAgICAgICAgdHJhbnNhY3Rpb25IYXNoLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSDorqLpmIUnLCBpc1JlbmV3YWwgPyAn57ut5pyfJyA6ICfmv4DmtLsnLCAn5oiQ5Yqf77yM5Yiw5pyf5pe26Ze0OicsIG5ldyBEYXRlKGV4cGlyZXNBdCAqIDEwMDApKVxuXG4gICAgLy8g5r+A5rS76K6i6ZiF5oiQ5Yqf5ZCO77yM6LCD55So5ZCI57qm5pu05paw5YiG57qiXG4gICAgLy8gMTAgVklSVFVBTCDnmoQgNzAlID0gNyBWSVJUVUFMIOi/m+WFpeWIhue6ouaxoFxuICAgIGxldCBkaXZpZGVuZFVwZGF0ZVR4SGFzaDogc3RyaW5nIHwgbnVsbCA9IG51bGxcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGl2aWRlbmRQb29sQWRkcmVzcyA9IHByb2Nlc3MuZW52LkdBTUVfRElWSURFTkRfUE9PTF9BRERSRVNTXG4gICAgICBjb25zdCBkaXZpZGVuZEFtb3VudCA9IHRvV2VpKCc3JykgLy8gMTAgVklSVFVBTCDnmoQgNzAlXG5cbiAgICAgIGlmIChkaXZpZGVuZFBvb2xBZGRyZXNzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbU3Vic2NyaXB0aW9uIEFjdGl2YXRlIEFQSV0g5YeG5aSH5pu05paw5YiG57qi5rGgLi4uJylcbiAgICAgICAgY29uc3QgYmxvY2tjaGFpbiA9IGNyZWF0ZUJsb2NrY2hhaW5DbGllbnQoKVxuICAgICAgICBjb25zdCBkaXZpZGVuZFR4UmVzdWx0ID0gYXdhaXQgYmxvY2tjaGFpbi51cGRhdGVHYW1lRGl2aWRlbmRQb29sKGRpdmlkZW5kUG9vbEFkZHJlc3MsIGRpdmlkZW5kQW1vdW50KVxuICAgICAgICBkaXZpZGVuZFVwZGF0ZVR4SGFzaCA9IGRpdmlkZW5kVHhSZXN1bHQudHJhbnNhY3Rpb25IYXNoXG5cbiAgICAgICAgY29uc29sZS5sb2coJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSDliIbnuqLlt7Lmm7TmlrDvvIxUWCBIYXNoOicsIGRpdmlkZW5kVXBkYXRlVHhIYXNoKVxuXG4gICAgICAgIC8vIOWPr+mAie+8muWwhiBkaXZpZGVuZFVwZGF0ZVR4SGFzaCDlrZjlgqjliLDmlbDmja7lupPnmoTorqLpmIXorrDlvZXkuK1cbiAgICAgICAgYXdhaXQgZGIuY29sbGVjdGlvbignc3Vic2NyaXB0aW9ucycpLnVwZGF0ZU9uZShcbiAgICAgICAgICB7IHVzZXJBZGRyZXNzOiBub3JtYWxpemVkQWRkcmVzcyB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgICRzZXQ6IHtcbiAgICAgICAgICAgICAgZGl2aWRlbmRVcGRhdGVUeEhhc2gsXG4gICAgICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSBHQU1FX0RJVklERU5EX1BPT0xfQUREUkVTUyDmnKrphY3nva7vvIzot7Pov4fliIbnuqLmm7TmlrAnKVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGRpdmlkZW5kRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tTdWJzY3JpcHRpb24gQWN0aXZhdGUgQVBJXSDliIbnuqLmm7TmlrDlpLHotKU6JywgZGl2aWRlbmRFcnJvcilcbiAgICAgIC8vIOS4jeS4reaWreivt+axgu+8jOiuoumYheW3sue7j+WIm+W7uuaIkOWKn++8jOWIhue6ouabtOaWsOWPr+S7peWQjue7remHjeivlVxuICAgICAgLy8g5Zyo5a6e6ZmF55Sf5Lqn546v5aKD5Lit77yM5Y+v6IO96ZyA6KaB5re75Yqg6YeN6K+V5py65Yi25oiW5ZGK6K2mXG4gICAgfVxuXG4gICAgcmV0dXJuIGNvcnNKc29uKFxuICAgICAge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBleHBpcmVzQXQsXG4gICAgICAgIGRpdmlkZW5kVXBkYXRlVHhIYXNoLFxuICAgICAgICBtZXNzYWdlOiBpc1JlbmV3YWwgPyAn6K6i6ZiF5bey57ut5pyf77yM5pyJ5pWI5pyfMzDlpKknIDogJ+iuoumYheW3sua/gOa0u++8jOacieaViOacnzMw5aSpJyxcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogMjAwIH1cbiAgICApXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW1N1YnNjcmlwdGlvbiBBY3RpdmF0ZSBBUEldIOWkhOeQhuivt+axguWksei0pTonLCBlcnJvcilcbiAgICByZXR1cm4gY29yc0pzb24oXG4gICAgICB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBhY3RpdmF0ZSBzdWJzY3JpcHRpb24nLFxuICAgICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuLyoqXG4gKiDlpITnkIYgT1BUSU9OUyDor7fmsYLvvIjnlKjkuo4gQ09SUyDpooTmo4DvvIlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIE9QVElPTlMoKSB7XG4gIHJldHVybiBjb3JzSnNvbihudWxsLCB7IHN0YXR1czogMjAwIH0pXG59XG5cbmZ1bmN0aW9uIGNvcnNKc29uKGJvZHk6IGFueSwgaW5pdD86IFJlc3BvbnNlSW5pdCkge1xuICBjb25zdCByZXNwb25zZSA9IGJvZHkgPT09IG51bGxcbiAgICA/IG5ldyBOZXh0UmVzcG9uc2UobnVsbCwgaW5pdClcbiAgICA6IE5leHRSZXNwb25zZS5qc29uKGJvZHksIGluaXQpXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpXG4gIHJlc3BvbnNlLmhlYWRlcnMuc2V0KCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ1BPU1QsIE9QVElPTlMnKVxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycycsICdDb250ZW50LVR5cGUsIEF1dGhvcml6YXRpb24nKVxuICByZXNwb25zZS5oZWFkZXJzLnNldCgnQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHMnLCAndHJ1ZScpXG4gIHJldHVybiByZXNwb25zZVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNvbm5lY3REQiIsImlzVmFsaWRBZGRyZXNzIiwibm9ybWFsaXplQWRkcmVzcyIsImNyZWF0ZUJsb2NrY2hhaW5DbGllbnQiLCJ0b1dlaSIsImV0aGVycyIsIlNVQlNDUklQVElPTl9BTU9VTlQiLCJTVUJTQ1JJUFRJT05fUEVSSU9EX0RBWVMiLCJ2ZXJpZnlUcmFuc2FjdGlvbiIsInRyYW5zYWN0aW9uSGFzaCIsInVzZXJBZGRyZXNzIiwiYW1vdW50IiwiY29uc29sZSIsImxvZyIsInRlc3QiLCJ3YXJuIiwidmFsaWQiLCJlcnJvciIsInJwY1VybCIsInByb2Nlc3MiLCJlbnYiLCJCQVNFX1NFUE9MSUFfUlBDX1VSTCIsIkJBU0VfUlBDX1VSTCIsInByb3ZpZGVyIiwicHJvdmlkZXJzIiwiSnNvblJwY1Byb3ZpZGVyIiwicmVjZWlwdCIsImdldFRyYW5zYWN0aW9uUmVjZWlwdCIsInN0YXR1cyIsImJsb2NrTnVtYmVyIiwicnBjRXJyb3IiLCJtZXNzYWdlIiwic3RhY2siLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJqc29uIiwiY29yc0pzb24iLCJzdWNjZXNzIiwibm9ybWFsaXplZEFkZHJlc3MiLCJTdHJpbmciLCJ0eFZlcmlmaWNhdGlvbiIsImRldGFpbHMiLCJkYiIsIm5vdyIsIk1hdGgiLCJmbG9vciIsIkRhdGUiLCJleHBpcmVzQXQiLCJleGlzdGluZ1N1YnNjcmlwdGlvbiIsImNvbGxlY3Rpb24iLCJmaW5kT25lIiwiaXNSZW5ld2FsIiwidXBkYXRlT25lIiwiJHNldCIsInJlbmV3ZWRBdCIsInVwZGF0ZWRBdCIsImluc2VydE9uZSIsInN0YXJ0ZWRBdCIsImNyZWF0ZWRBdCIsImRpdmlkZW5kVXBkYXRlVHhIYXNoIiwiZGl2aWRlbmRQb29sQWRkcmVzcyIsIkdBTUVfRElWSURFTkRfUE9PTF9BRERSRVNTIiwiZGl2aWRlbmRBbW91bnQiLCJibG9ja2NoYWluIiwiZGl2aWRlbmRUeFJlc3VsdCIsInVwZGF0ZUdhbWVEaXZpZGVuZFBvb2wiLCJkaXZpZGVuZEVycm9yIiwiRXJyb3IiLCJPUFRJT05TIiwiaW5pdCIsInJlc3BvbnNlIiwiaGVhZGVycyIsInNldCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/subscription/activate/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/address-utils.ts":
/*!******************************!*\
  !*** ./lib/address-utils.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isValidAddress: () => (/* binding */ isValidAddress),\n/* harmony export */   isValidTransactionHash: () => (/* binding */ isValidTransactionHash),\n/* harmony export */   normalizeAddress: () => (/* binding */ normalizeAddress)\n/* harmony export */ });\n/**\n * 地址验证和规范化工具\n * 独立于 ethers，避免 Next.js 兼容性问题\n */ /**\n * 验证是否为有效的以太坊地址\n * @param address 地址字符串\n * @returns 是否有效\n */ function isValidAddress(address) {\n    return /^0x[a-fA-F0-9]{40}$/.test(address);\n}\n/**\n * 规范化地址为小写格式\n * @param address 地址字符串\n * @returns 规范化后的地址\n */ function normalizeAddress(address) {\n    if (!isValidAddress(address)) {\n        throw new Error(\"Invalid address format\");\n    }\n    return address.toLowerCase();\n}\n/**\n * 验证交易哈希格式\n * @param hash 交易哈希\n * @returns 是否有效\n */ function isValidTransactionHash(hash) {\n    return /^0x[a-fA-F0-9]{64}$/.test(hash);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYWRkcmVzcy11dGlscy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7O0NBR0MsR0FFRDs7OztDQUlDLEdBQ00sU0FBU0EsZUFBZUMsT0FBZTtJQUM1QyxPQUFPLHNCQUFzQkMsSUFBSSxDQUFDRDtBQUNwQztBQUVBOzs7O0NBSUMsR0FDTSxTQUFTRSxpQkFBaUJGLE9BQWU7SUFDOUMsSUFBSSxDQUFDRCxlQUFlQyxVQUFVO1FBQzVCLE1BQU0sSUFBSUcsTUFBTTtJQUNsQjtJQUNBLE9BQU9ILFFBQVFJLFdBQVc7QUFDNUI7QUFFQTs7OztDQUlDLEdBQ00sU0FBU0MsdUJBQXVCQyxJQUFZO0lBQ2pELE9BQU8sc0JBQXNCTCxJQUFJLENBQUNLO0FBQ3BDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQGdhbWUtYWkvc2VydmVyLy4vbGliL2FkZHJlc3MtdXRpbHMudHM/NjNmMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIOWcsOWdgOmqjOivgeWSjOinhOiMg+WMluW3peWFt1xuICog54us56uL5LqOIGV0aGVyc++8jOmBv+WFjSBOZXh0LmpzIOWFvOWuueaAp+mXrumimFxuICovXG5cbi8qKlxuICog6aqM6K+B5piv5ZCm5Li65pyJ5pWI55qE5Lul5aSq5Z2K5Zyw5Z2AXG4gKiBAcGFyYW0gYWRkcmVzcyDlnLDlnYDlrZfnrKbkuLJcbiAqIEByZXR1cm5zIOaYr+WQpuacieaViFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZEFkZHJlc3MoYWRkcmVzczogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiAvXjB4W2EtZkEtRjAtOV17NDB9JC8udGVzdChhZGRyZXNzKVxufVxuXG4vKipcbiAqIOinhOiMg+WMluWcsOWdgOS4uuWwj+WGmeagvOW8j1xuICogQHBhcmFtIGFkZHJlc3Mg5Zyw5Z2A5a2X56ym5LiyXG4gKiBAcmV0dXJucyDop4TojIPljJblkI7nmoTlnLDlnYBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUFkZHJlc3MoYWRkcmVzczogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFpc1ZhbGlkQWRkcmVzcyhhZGRyZXNzKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhZGRyZXNzIGZvcm1hdCcpXG4gIH1cbiAgcmV0dXJuIGFkZHJlc3MudG9Mb3dlckNhc2UoKVxufVxuXG4vKipcbiAqIOmqjOivgeS6pOaYk+WTiOW4jOagvOW8j1xuICogQHBhcmFtIGhhc2gg5Lqk5piT5ZOI5biMXG4gKiBAcmV0dXJucyDmmK/lkKbmnInmlYhcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzVmFsaWRUcmFuc2FjdGlvbkhhc2goaGFzaDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiAvXjB4W2EtZkEtRjAtOV17NjR9JC8udGVzdChoYXNoKVxufVxuIl0sIm5hbWVzIjpbImlzVmFsaWRBZGRyZXNzIiwiYWRkcmVzcyIsInRlc3QiLCJub3JtYWxpemVBZGRyZXNzIiwiRXJyb3IiLCJ0b0xvd2VyQ2FzZSIsImlzVmFsaWRUcmFuc2FjdGlvbkhhc2giLCJoYXNoIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/address-utils.ts\n");

/***/ }),

/***/ "(rsc)/./lib/blockchain.ts":
/*!***************************!*\
  !*** ./lib/blockchain.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BlockchainClient: () => (/* binding */ BlockchainClient),\n/* harmony export */   createBlockchainClient: () => (/* binding */ createBlockchainClient),\n/* harmony export */   fromWei: () => (/* binding */ fromWei),\n/* harmony export */   toWei: () => (/* binding */ toWei)\n/* harmony export */ });\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ethers */ \"(rsc)/./node_modules/@ethersproject/providers/lib.esm/json-rpc-provider.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ethers */ \"(rsc)/./node_modules/@ethersproject/wallet/lib.esm/index.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ethers */ \"(rsc)/./node_modules/@ethersproject/address/lib.esm/index.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ethers */ \"(rsc)/./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ethers */ \"(rsc)/./node_modules/@ethersproject/units/lib.esm/index.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ethers */ \"(rsc)/./node_modules/@ethersproject/abi/lib.esm/interface.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ethers */ \"(rsc)/./node_modules/@ethersproject/contracts/lib.esm/index.js\");\n/**\n * 区块链交互模块\n * 用于与智能合约交互，进行代币转账等操作\n */ \n/**\n * IERC20 标准接口 ABI\n */ const ERC20_ABI = [\n    \"function transfer(address to, uint256 amount) public returns (bool)\",\n    \"function balanceOf(address account) public view returns (uint256)\",\n    \"function approve(address spender, uint256 amount) public returns (bool)\",\n    \"function allowance(address owner, address spender) public view returns (uint256)\"\n];\n/**\n * GameDividendPool 合约 ABI（只需要调用的方法）\n */ const DIVIDEND_POOL_ABI = [\n    \"function depositDividend(uint256 amount) external\",\n    \"function claimDividend() external nonReentrant returns (uint256 claimable)\",\n    \"function getPendingDividend(address user) external view returns (uint256)\",\n    \"function getUserDividendInfo(address user) external view returns (uint256 pending, uint256 claimed, uint256 gameBalance)\",\n    \"function getPoolStats() external view returns (uint256 _totalDividendPool, uint256 _totalClaimed, uint256 _totalPending, uint256 _totalDividendPerShare)\"\n];\n/**\n * 区块链客户端类\n */ class BlockchainClient {\n    provider;\n    signer;\n    rpcUrl;\n    privateKey;\n    constructor(config){\n        this.rpcUrl = config.rpcUrl;\n        this.privateKey = config.privateKey;\n        this.provider = new ethers__WEBPACK_IMPORTED_MODULE_0__.JsonRpcProvider(config.rpcUrl);\n        this.signer = new ethers__WEBPACK_IMPORTED_MODULE_1__.Wallet(config.privateKey, this.provider);\n    // 注意：chainId 目前未使用，可在未来需要时启用\n    }\n    /**\n   * 执行原始 JSON-RPC 调用\n   */ async callJsonRpc(method, params) {\n        const response = await fetch(this.rpcUrl, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                jsonrpc: \"2.0\",\n                id: Date.now(),\n                method,\n                params\n            })\n        });\n        const data = await response.json();\n        if (data.error) {\n            throw new Error(`JSON-RPC Error: ${data.error.message}`);\n        }\n        return data.result;\n    }\n    /**\n   * 转账 ERC20 代币\n   * @param tokenAddress 代币合约地址\n   * @param toAddress 接收地址\n   * @param amount 转账数量（单位：Wei）\n   * @returns 交易哈希\n   */ async transferERC20(tokenAddress, toAddress, amount) {\n        try {\n            console.log(\"[Blockchain] 准备转账 ERC20 代币\");\n            console.log(\"[Blockchain] 代币地址:\", tokenAddress);\n            console.log(\"[Blockchain] 接收地址:\", toAddress);\n            console.log(\"[Blockchain] 转账数量:\", amount);\n            // 验证地址格式\n            if (!ethers__WEBPACK_IMPORTED_MODULE_2__.isAddress(tokenAddress)) {\n                throw new Error(\"Invalid token address format\");\n            }\n            if (!ethers__WEBPACK_IMPORTED_MODULE_2__.isAddress(toAddress)) {\n                throw new Error(\"Invalid recipient address format\");\n            }\n            // 使用底层JSON-RPC调用而不是ethers.js Contract接口\n            // 以避免网络检测的问题\n            console.log(\"[Blockchain] 使用 JSON-RPC 构建转账交易...\");\n            // 创建钱包用于签名\n            const wallet = new ethers__WEBPACK_IMPORTED_MODULE_1__.Wallet(this.privateKey);\n            // 使用直接的 JSON-RPC 调用而不是通过 provider 接口\n            // 这样可以避免 ethers.js 的网络检测问题\n            console.log(\"[Blockchain] 通过原始 JSON-RPC 获取交易数据...\");\n            let nonce;\n            let gasPriceWei;\n            try {\n                // 直接调用 JSON-RPC\n                const nonceHex = await this.callJsonRpc(\"eth_getTransactionCount\", [\n                    wallet.address,\n                    \"latest\"\n                ]);\n                nonce = parseInt(nonceHex, 16);\n                console.log(\"[Blockchain] 获取 Nonce:\", nonce);\n            } catch (error) {\n                console.warn(\"[Blockchain] 无法获取 Nonce，使用默认值 0\");\n                nonce = 0;\n            }\n            try {\n                const gasPriceHex = await this.callJsonRpc(\"eth_gasPrice\", []);\n                gasPriceWei = ethers__WEBPACK_IMPORTED_MODULE_3__.BigNumber.from(gasPriceHex);\n                console.log(\"[Blockchain] 获取 Gas Price:\", ethers__WEBPACK_IMPORTED_MODULE_4__.formatUnits(gasPriceWei, \"gwei\"), \"gwei\");\n            } catch (error) {\n                console.warn(\"[Blockchain] 无法获取 Gas Price，使用默认值 1 gwei\");\n                gasPriceWei = ethers__WEBPACK_IMPORTED_MODULE_4__.parseUnits(\"1\", \"gwei\");\n            }\n            const gasLimit = ethers__WEBPACK_IMPORTED_MODULE_3__.BigNumber.from(\"100000\");\n            console.log(\"[Blockchain] 交易参数:\");\n            console.log(\"  • Nonce:\", nonce);\n            console.log(\"  • Gas Price:\", ethers__WEBPACK_IMPORTED_MODULE_4__.formatUnits(gasPriceWei, \"gwei\"), \"gwei\");\n            console.log(\"  • Gas Limit:\", gasLimit.toString());\n            // 构建 transfer() 函数调用数据\n            const iface = new ethers__WEBPACK_IMPORTED_MODULE_5__.Interface(ERC20_ABI);\n            const data = iface.encodeFunctionData(\"transfer\", [\n                toAddress,\n                amount\n            ]);\n            // 构建交易对象\n            const tx = {\n                to: tokenAddress,\n                from: wallet.address,\n                nonce: nonce,\n                gasLimit: gasLimit,\n                gasPrice: gasPriceWei,\n                data: data\n            };\n            console.log(\"[Blockchain] 签名交易...\");\n            // 签名交易\n            const signedTx = await wallet.signTransaction(tx);\n            console.log(\"[Blockchain] 发送签名的交易到网络...\");\n            // 直接通过 JSON-RPC 发送原始交易，避免 provider 的网络检测\n            const txHash = await this.callJsonRpc(\"eth_sendRawTransaction\", [\n                signedTx\n            ]);\n            console.log(\"[Blockchain] 交易已发送，Hash:\", txHash);\n            console.log(\"[Blockchain] 等待交易确认...\");\n            // 等待交易确认（最多等待 60 秒）\n            const maxAttempts = 30;\n            let receipt = null;\n            for(let i = 0; i < maxAttempts; i++){\n                try {\n                    const receiptData = await this.callJsonRpc(\"eth_getTransactionReceipt\", [\n                        txHash\n                    ]);\n                    if (receiptData) {\n                        receipt = receiptData;\n                        console.log(\"[Blockchain] 交易已确认，区块号:\", parseInt(receiptData.blockNumber, 16));\n                        break;\n                    }\n                } catch (error) {\n                    console.warn(\"[Blockchain] 等待确认中...\", i + 1);\n                }\n                // 等待 2 秒后重试\n                await new Promise((resolve)=>setTimeout(resolve, 2000));\n            }\n            return {\n                transactionHash: txHash,\n                blockNumber: receipt ? parseInt(receipt.blockNumber, 16) : undefined\n            };\n        } catch (error) {\n            const errorMsg = error.message;\n            console.error(\"[Blockchain] 转账失败:\", errorMsg);\n            throw error;\n        }\n    }\n    /**\n   * 检查 ERC20 代币余额\n   * @param tokenAddress 代币合约地址\n   * @param address 账户地址\n   * @returns 余额（单位：Wei）\n   */ async getERC20Balance(tokenAddress, address) {\n        try {\n            const tokenContract = new ethers__WEBPACK_IMPORTED_MODULE_6__.Contract(tokenAddress, ERC20_ABI, this.provider);\n            const balance = await tokenContract.balanceOf(address);\n            return balance.toString();\n        } catch (error) {\n            console.error(\"[Blockchain] 查询余额失败:\", error);\n            throw error;\n        }\n    }\n    /**\n   * 获取 Deployer 地址\n   */ async getSignerAddress() {\n        return await this.signer.getAddress();\n    }\n    /**\n   * 获取网络信息\n   */ async getNetworkInfo() {\n        const network = await this.provider.getNetwork();\n        return {\n            chainId: network.chainId,\n            name: network.name\n        };\n    }\n    /**\n   * 调用 GameDividendPool 的 depositDividend 方法，更新分红\n   * @param dividendPoolAddress 分红池合约地址\n   * @param amount VIRTUAL 代币金额（Wei 单位）\n   * @returns 交易哈希\n   */ async updateGameDividendPool(dividendPoolAddress, amount) {\n        try {\n            console.log(\"[Blockchain] 准备调用 GameDividendPool.depositDividend()\");\n            console.log(\"[Blockchain] 分红池地址:\", dividendPoolAddress);\n            console.log(\"[Blockchain] 分红金额:\", amount);\n            // 验证地址格式\n            if (!ethers__WEBPACK_IMPORTED_MODULE_2__.isAddress(dividendPoolAddress)) {\n                throw new Error(\"Invalid dividend pool address format\");\n            }\n            // 创建钱包用于签名\n            const wallet = new ethers__WEBPACK_IMPORTED_MODULE_1__.Wallet(this.privateKey);\n            let nonce;\n            let gasPriceWei;\n            try {\n                const nonceHex = await this.callJsonRpc(\"eth_getTransactionCount\", [\n                    wallet.address,\n                    \"latest\"\n                ]);\n                nonce = parseInt(nonceHex, 16);\n                console.log(\"[Blockchain] 获取 Nonce:\", nonce);\n            } catch (error) {\n                console.warn(\"[Blockchain] 无法获取 Nonce，使用默认值 0\");\n                nonce = 0;\n            }\n            try {\n                const gasPriceHex = await this.callJsonRpc(\"eth_gasPrice\", []);\n                gasPriceWei = ethers__WEBPACK_IMPORTED_MODULE_3__.BigNumber.from(gasPriceHex);\n                console.log(\"[Blockchain] 获取 Gas Price:\", ethers__WEBPACK_IMPORTED_MODULE_4__.formatUnits(gasPriceWei, \"gwei\"), \"gwei\");\n            } catch (error) {\n                console.warn(\"[Blockchain] 无法获取 Gas Price，使用默认值 1 gwei\");\n                gasPriceWei = ethers__WEBPACK_IMPORTED_MODULE_4__.parseUnits(\"1\", \"gwei\");\n            }\n            const gasLimit = ethers__WEBPACK_IMPORTED_MODULE_3__.BigNumber.from(\"150000\") // depositDividend 需要更多 gas\n            ;\n            console.log(\"[Blockchain] 交易参数:\");\n            console.log(\"  • Nonce:\", nonce);\n            console.log(\"  • Gas Price:\", ethers__WEBPACK_IMPORTED_MODULE_4__.formatUnits(gasPriceWei, \"gwei\"), \"gwei\");\n            console.log(\"  • Gas Limit:\", gasLimit.toString());\n            // 需要先调用 VIRTUAL 代币的 approve，授权 dividendPool 使用我们的代币\n            console.log(\"[Blockchain] 构建 approve 交易...\");\n            const virtualTokenAddress = process.env.VIRTUAL_TOKEN_ADDRESS;\n            if (!virtualTokenAddress) {\n                throw new Error(\"VIRTUAL_TOKEN_ADDRESS environment variable is not set\");\n            }\n            // 构建 approve 交易数据\n            const iface = new ethers__WEBPACK_IMPORTED_MODULE_5__.Interface(ERC20_ABI);\n            const approveData = iface.encodeFunctionData(\"approve\", [\n                dividendPoolAddress,\n                amount\n            ]);\n            const approveTx = {\n                to: virtualTokenAddress,\n                from: wallet.address,\n                nonce: nonce,\n                gasLimit: ethers__WEBPACK_IMPORTED_MODULE_3__.BigNumber.from(\"100000\"),\n                gasPrice: gasPriceWei,\n                data: approveData\n            };\n            console.log(\"[Blockchain] 签名 approve 交易...\");\n            const signedApproveTx = await wallet.signTransaction(approveTx);\n            console.log(\"[Blockchain] 发送 approve 交易...\");\n            const approveTxHash = await this.callJsonRpc(\"eth_sendRawTransaction\", [\n                signedApproveTx\n            ]);\n            console.log(\"[Blockchain] Approve 交易已发送，Hash:\", approveTxHash);\n            // 等待 approve 交易确认\n            console.log(\"[Blockchain] 等待 approve 交易确认...\");\n            for(let i = 0; i < 30; i++){\n                try {\n                    const receiptData = await this.callJsonRpc(\"eth_getTransactionReceipt\", [\n                        approveTxHash\n                    ]);\n                    if (receiptData) {\n                        console.log(\"[Blockchain] Approve 交易已确认\");\n                        break;\n                    }\n                } catch (error) {\n                    console.warn(\"[Blockchain] 等待 approve 确认中...\", i + 1);\n                }\n                await new Promise((resolve)=>setTimeout(resolve, 2000));\n            }\n            // 现在构建 depositDividend 交易\n            console.log(\"[Blockchain] 构建 depositDividend 交易...\");\n            const depositIface = new ethers__WEBPACK_IMPORTED_MODULE_5__.Interface(DIVIDEND_POOL_ABI);\n            const depositData = depositIface.encodeFunctionData(\"depositDividend\", [\n                amount\n            ]);\n            const depositTx = {\n                to: dividendPoolAddress,\n                from: wallet.address,\n                nonce: nonce + 1,\n                gasLimit: ethers__WEBPACK_IMPORTED_MODULE_3__.BigNumber.from(\"150000\"),\n                gasPrice: gasPriceWei,\n                data: depositData\n            };\n            console.log(\"[Blockchain] 签名 depositDividend 交易...\");\n            const signedDepositTx = await wallet.signTransaction(depositTx);\n            console.log(\"[Blockchain] 发送 depositDividend 交易...\");\n            const depositTxHash = await this.callJsonRpc(\"eth_sendRawTransaction\", [\n                signedDepositTx\n            ]);\n            console.log(\"[Blockchain] Deposit 交易已发送，Hash:\", depositTxHash);\n            // 等待 deposit 交易确认\n            console.log(\"[Blockchain] 等待 depositDividend 交易确认...\");\n            let receipt = null;\n            for(let i = 0; i < 30; i++){\n                try {\n                    const receiptData = await this.callJsonRpc(\"eth_getTransactionReceipt\", [\n                        depositTxHash\n                    ]);\n                    if (receiptData) {\n                        receipt = receiptData;\n                        console.log(\"[Blockchain] Deposit 交易已确认，区块号:\", parseInt(receiptData.blockNumber, 16));\n                        break;\n                    }\n                } catch (error) {\n                    console.warn(\"[Blockchain] 等待 deposit 确认中...\", i + 1);\n                }\n                await new Promise((resolve)=>setTimeout(resolve, 2000));\n            }\n            return {\n                transactionHash: depositTxHash,\n                blockNumber: receipt ? parseInt(receipt.blockNumber, 16) : undefined\n            };\n        } catch (error) {\n            const errorMsg = error.message;\n            console.error(\"[Blockchain] 分红更新失败:\", errorMsg);\n            throw error;\n        }\n    }\n    /**\n   * 查询用户的分红信息\n   * @param dividendPoolAddress 分红池合约地址\n   * @param userAddress 用户地址\n   * @returns 用户分红信息\n   */ async getUserDividendInfo(dividendPoolAddress, userAddress) {\n        try {\n            console.log(\"[Blockchain] 查询用户分红信息\");\n            console.log(\"[Blockchain] 分红池地址:\", dividendPoolAddress);\n            console.log(\"[Blockchain] 用户地址:\", userAddress);\n            // 验证地址格式\n            if (!ethers__WEBPACK_IMPORTED_MODULE_2__.isAddress(dividendPoolAddress)) {\n                throw new Error(\"Invalid dividend pool address format\");\n            }\n            if (!ethers__WEBPACK_IMPORTED_MODULE_2__.isAddress(userAddress)) {\n                throw new Error(\"Invalid user address format\");\n            }\n            // 创建合约实例并调用 view 函数\n            const contract = new ethers__WEBPACK_IMPORTED_MODULE_6__.Contract(dividendPoolAddress, DIVIDEND_POOL_ABI, this.provider);\n            const result = await contract.getUserDividendInfo(userAddress);\n            console.log(\"[Blockchain] 用户分红信息查询成功\");\n            console.log(\"[Blockchain] 待提取分红:\", result.pending.toString());\n            console.log(\"[Blockchain] 已提取分红:\", result.claimed.toString());\n            console.log(\"[Blockchain] GAME 余额:\", result.gameBalance.toString());\n            return {\n                pending: result.pending.toString(),\n                claimed: result.claimed.toString(),\n                gameBalance: result.gameBalance.toString()\n            };\n        } catch (error) {\n            const errorMsg = error.message;\n            console.error(\"[Blockchain] 查询分红信息失败:\", errorMsg);\n            throw error;\n        }\n    }\n    /**\n   * 查询分红池的统计数据\n   * @param dividendPoolAddress 分红池合约地址\n   * @returns 分红池统计信息\n   */ async getDividendPoolStats(dividendPoolAddress) {\n        try {\n            console.log(\"[Blockchain] 查询分红池统计信息\");\n            // 验证地址格式\n            if (!ethers__WEBPACK_IMPORTED_MODULE_2__.isAddress(dividendPoolAddress)) {\n                throw new Error(\"Invalid dividend pool address format\");\n            }\n            const contract = new ethers__WEBPACK_IMPORTED_MODULE_6__.Contract(dividendPoolAddress, DIVIDEND_POOL_ABI, this.provider);\n            const result = await contract.getPoolStats();\n            console.log(\"[Blockchain] 分红池统计信息查询成功\");\n            return {\n                totalDividendPool: result._totalDividendPool.toString(),\n                totalClaimed: result._totalClaimed.toString(),\n                totalPending: result._totalPending.toString(),\n                totalDividendPerShare: result._totalDividendPerShare.toString()\n            };\n        } catch (error) {\n            const errorMsg = error.message;\n            console.error(\"[Blockchain] 查询分红池统计失败:\", errorMsg);\n            throw error;\n        }\n    }\n}\n/**\n * 创建区块链客户端实例\n */ function createBlockchainClient() {\n    const rpcUrl = process.env.BASE_SEPOLIA_RPC_URL;\n    const privateKey = process.env.DEPLOYER_PRIVATE_KEY;\n    const chainId = parseInt(process.env.CHAIN_ID || \"84532\");\n    if (!rpcUrl) {\n        throw new Error(\"BASE_SEPOLIA_RPC_URL environment variable is not set\");\n    }\n    if (!privateKey) {\n        throw new Error(\"DEPLOYER_PRIVATE_KEY environment variable is not set\");\n    }\n    return new BlockchainClient({\n        rpcUrl,\n        privateKey,\n        chainId\n    });\n}\n/**\n * 将字符串数字转换为 Wei（ERC20 标准通常是 18 位小数）\n * @param amount 数字（如 \"1\"）\n * @param decimals 小数位数（默认 18）\n * @returns Wei 格式的字符串\n */ function toWei(amount, decimals = 18) {\n    return ethers__WEBPACK_IMPORTED_MODULE_4__.parseUnits(amount, decimals).toString();\n}\n/**\n * 将 Wei 转换为字符串数字\n * @param wei Wei 格式的字符串\n * @param decimals 小数位数（默认 18）\n * @returns 普通数字字符串\n */ function fromWei(wei, decimals = 18) {\n    return ethers__WEBPACK_IMPORTED_MODULE_4__.formatUnits(wei, decimals);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVNtRixRQUFRQyxHQUFHLENBQUM0QixvQkFBb0I7SUFDL0MsTUFBTS9HLGFBQWFrRixRQUFRQyxHQUFHLENBQUM2QixvQkFBb0I7SUFDbkQsTUFBTW5DLFVBQVV2QyxTQUFTNEMsUUFBUUMsR0FBRyxDQUFDOEIsUUFBUSxJQUFJO0lBRWpELElBQUksQ0FBQ2xILFFBQVE7UUFDWCxNQUFNLElBQUl1QixNQUFNO0lBQ2xCO0lBRUEsSUFBSSxDQUFDdEIsWUFBWTtRQUNmLE1BQU0sSUFBSXNCLE1BQU07SUFDbEI7SUFFQSxPQUFPLElBQUkxQixpQkFBaUI7UUFDMUJHO1FBQ0FDO1FBQ0E2RTtJQUNGO0FBQ0Y7QUFFQTs7Ozs7Q0FLQyxHQUNNLFNBQVNxQyxNQUFNdEYsTUFBYyxFQUFFdUYsV0FBbUIsRUFBRTtJQUN6RCxPQUFPMUgsOENBQXVCLENBQUNtQyxRQUFRdUYsVUFBVXJFLFFBQVE7QUFDM0Q7QUFFQTs7Ozs7Q0FLQyxHQUNNLFNBQVNzRSxRQUFRQyxHQUFXLEVBQUVGLFdBQW1CLEVBQUU7SUFDeEQsT0FBTzFILCtDQUF3QixDQUFDNEgsS0FBS0Y7QUFDdkMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AZ2FtZS1haS9zZXJ2ZXIvLi9saWIvYmxvY2tjaGFpbi50cz8wZmExIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICog5Yy65Z2X6ZO+5Lqk5LqS5qih5Z2XXG4gKiDnlKjkuo7kuI7mmbrog73lkIjnuqbkuqTkupLvvIzov5vooYzku6PluIHovazotKbnrYnmk43kvZxcbiAqL1xuXG5pbXBvcnQgeyBldGhlcnMgfSBmcm9tICdldGhlcnMnXG5cbi8qKlxuICogSUVSQzIwIOagh+WHhuaOpeWPoyBBQklcbiAqL1xuY29uc3QgRVJDMjBfQUJJID0gW1xuICAnZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKScsXG4gICdmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBhY2NvdW50KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KScsXG4gICdmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiBhbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKScsXG4gICdmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KScsXG5dXG5cbi8qKlxuICogR2FtZURpdmlkZW5kUG9vbCDlkIjnuqYgQUJJ77yI5Y+q6ZyA6KaB6LCD55So55qE5pa55rOV77yJXG4gKi9cbmNvbnN0IERJVklERU5EX1BPT0xfQUJJID0gW1xuICAnZnVuY3Rpb24gZGVwb3NpdERpdmlkZW5kKHVpbnQyNTYgYW1vdW50KSBleHRlcm5hbCcsXG4gICdmdW5jdGlvbiBjbGFpbURpdmlkZW5kKCkgZXh0ZXJuYWwgbm9uUmVlbnRyYW50IHJldHVybnMgKHVpbnQyNTYgY2xhaW1hYmxlKScsXG4gICdmdW5jdGlvbiBnZXRQZW5kaW5nRGl2aWRlbmQoYWRkcmVzcyB1c2VyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpJyxcbiAgJ2Z1bmN0aW9uIGdldFVzZXJEaXZpZGVuZEluZm8oYWRkcmVzcyB1c2VyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgcGVuZGluZywgdWludDI1NiBjbGFpbWVkLCB1aW50MjU2IGdhbWVCYWxhbmNlKScsXG4gICdmdW5jdGlvbiBnZXRQb29sU3RhdHMoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgX3RvdGFsRGl2aWRlbmRQb29sLCB1aW50MjU2IF90b3RhbENsYWltZWQsIHVpbnQyNTYgX3RvdGFsUGVuZGluZywgdWludDI1NiBfdG90YWxEaXZpZGVuZFBlclNoYXJlKScsXG5dXG5cbi8qKlxuICog5Yy65Z2X6ZO+5a6i5oi356uv6YWN572uXG4gKi9cbmludGVyZmFjZSBCbG9ja2NoYWluQ29uZmlnIHtcbiAgcnBjVXJsOiBzdHJpbmdcbiAgcHJpdmF0ZUtleTogc3RyaW5nXG4gIGNoYWluSWQ6IG51bWJlclxufVxuXG4vKipcbiAqIOWMuuWdl+mTvuWuouaIt+err+exu1xuICovXG5leHBvcnQgY2xhc3MgQmxvY2tjaGFpbkNsaWVudCB7XG4gIHByaXZhdGUgcHJvdmlkZXI6IGV0aGVycy5wcm92aWRlcnMuSnNvblJwY1Byb3ZpZGVyXG4gIHByaXZhdGUgc2lnbmVyOiBldGhlcnMuU2lnbmVyXG4gIHByaXZhdGUgcnBjVXJsOiBzdHJpbmdcbiAgcHJpdmF0ZSBwcml2YXRlS2V5OiBzdHJpbmdcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IEJsb2NrY2hhaW5Db25maWcpIHtcbiAgICB0aGlzLnJwY1VybCA9IGNvbmZpZy5ycGNVcmxcbiAgICB0aGlzLnByaXZhdGVLZXkgPSBjb25maWcucHJpdmF0ZUtleVxuICAgIHRoaXMucHJvdmlkZXIgPSBuZXcgZXRoZXJzLnByb3ZpZGVycy5Kc29uUnBjUHJvdmlkZXIoY29uZmlnLnJwY1VybClcbiAgICB0aGlzLnNpZ25lciA9IG5ldyBldGhlcnMuV2FsbGV0KGNvbmZpZy5wcml2YXRlS2V5LCB0aGlzLnByb3ZpZGVyKVxuICAgIC8vIOazqOaEj++8mmNoYWluSWQg55uu5YmN5pyq5L2/55So77yM5Y+v5Zyo5pyq5p2l6ZyA6KaB5pe25ZCv55SoXG4gIH1cblxuICAvKipcbiAgICog5omn6KGM5Y6f5aeLIEpTT04tUlBDIOiwg+eUqFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjYWxsSnNvblJwYyhtZXRob2Q6IHN0cmluZywgcGFyYW1zOiBhbnlbXSk6IFByb21pc2U8YW55PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh0aGlzLnJwY1VybCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBqc29ucnBjOiAnMi4wJyxcbiAgICAgICAgaWQ6IERhdGUubm93KCksXG4gICAgICAgIG1ldGhvZCxcbiAgICAgICAgcGFyYW1zLFxuICAgICAgfSksXG4gICAgfSlcblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICBpZiAoZGF0YS5lcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBKU09OLVJQQyBFcnJvcjogJHtkYXRhLmVycm9yLm1lc3NhZ2V9YClcbiAgICB9XG4gICAgcmV0dXJuIGRhdGEucmVzdWx0XG4gIH1cblxuICAvKipcbiAgICog6L2s6LSmIEVSQzIwIOS7o+W4gVxuICAgKiBAcGFyYW0gdG9rZW5BZGRyZXNzIOS7o+W4geWQiOe6puWcsOWdgFxuICAgKiBAcGFyYW0gdG9BZGRyZXNzIOaOpeaUtuWcsOWdgFxuICAgKiBAcGFyYW0gYW1vdW50IOi9rOi0puaVsOmHj++8iOWNleS9je+8mldlae+8iVxuICAgKiBAcmV0dXJucyDkuqTmmJPlk4jluIxcbiAgICovXG4gIGFzeW5jIHRyYW5zZmVyRVJDMjAoXG4gICAgdG9rZW5BZGRyZXNzOiBzdHJpbmcsXG4gICAgdG9BZGRyZXNzOiBzdHJpbmcsXG4gICAgYW1vdW50OiBzdHJpbmdcbiAgKTogUHJvbWlzZTx7IHRyYW5zYWN0aW9uSGFzaDogc3RyaW5nOyBibG9ja051bWJlcj86IG51bWJlciB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbQmxvY2tjaGFpbl0g5YeG5aSH6L2s6LSmIEVSQzIwIOS7o+W4gScpXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOS7o+W4geWcsOWdgDonLCB0b2tlbkFkZHJlc3MpXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOaOpeaUtuWcsOWdgDonLCB0b0FkZHJlc3MpXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOi9rOi0puaVsOmHjzonLCBhbW91bnQpXG5cbiAgICAgIC8vIOmqjOivgeWcsOWdgOagvOW8j1xuICAgICAgaWYgKCFldGhlcnMudXRpbHMuaXNBZGRyZXNzKHRva2VuQWRkcmVzcykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHRva2VuIGFkZHJlc3MgZm9ybWF0JylcbiAgICAgIH1cbiAgICAgIGlmICghZXRoZXJzLnV0aWxzLmlzQWRkcmVzcyh0b0FkZHJlc3MpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCByZWNpcGllbnQgYWRkcmVzcyBmb3JtYXQnKVxuICAgICAgfVxuXG4gICAgICAvLyDkvb/nlKjlupXlsYJKU09OLVJQQ+iwg+eUqOiAjOS4jeaYr2V0aGVycy5qcyBDb250cmFjdOaOpeWPo1xuICAgICAgLy8g5Lul6YG/5YWN572R57uc5qOA5rWL55qE6Zeu6aKYXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOS9v+eUqCBKU09OLVJQQyDmnoTlu7rovazotKbkuqTmmJMuLi4nKVxuXG4gICAgICAvLyDliJvlu7rpkrHljIXnlKjkuo7nrb7lkI1cbiAgICAgIGNvbnN0IHdhbGxldCA9IG5ldyBldGhlcnMuV2FsbGV0KHRoaXMucHJpdmF0ZUtleSlcblxuICAgICAgLy8g5L2/55So55u05o6l55qEIEpTT04tUlBDIOiwg+eUqOiAjOS4jeaYr+mAmui/hyBwcm92aWRlciDmjqXlj6NcbiAgICAgIC8vIOi/meagt+WPr+S7pemBv+WFjSBldGhlcnMuanMg55qE572R57uc5qOA5rWL6Zeu6aKYXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOmAmui/h+WOn+WniyBKU09OLVJQQyDojrflj5bkuqTmmJPmlbDmja4uLi4nKVxuXG4gICAgICBsZXQgbm9uY2U6IG51bWJlclxuICAgICAgbGV0IGdhc1ByaWNlV2VpOiBldGhlcnMuQmlnTnVtYmVyXG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIOebtOaOpeiwg+eUqCBKU09OLVJQQ1xuICAgICAgICBjb25zdCBub25jZUhleCA9IGF3YWl0IHRoaXMuY2FsbEpzb25ScGMoJ2V0aF9nZXRUcmFuc2FjdGlvbkNvdW50JywgW3dhbGxldC5hZGRyZXNzLCAnbGF0ZXN0J10pXG4gICAgICAgIG5vbmNlID0gcGFyc2VJbnQobm9uY2VIZXgsIDE2KVxuICAgICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOiOt+WPliBOb25jZTonLCBub25jZSlcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignW0Jsb2NrY2hhaW5dIOaXoOazleiOt+WPliBOb25jZe+8jOS9v+eUqOm7mOiupOWAvCAwJylcbiAgICAgICAgbm9uY2UgPSAwXG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGdhc1ByaWNlSGV4ID0gYXdhaXQgdGhpcy5jYWxsSnNvblJwYygnZXRoX2dhc1ByaWNlJywgW10pXG4gICAgICAgIGdhc1ByaWNlV2VpID0gZXRoZXJzLkJpZ051bWJlci5mcm9tKGdhc1ByaWNlSGV4KVxuICAgICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOiOt+WPliBHYXMgUHJpY2U6JywgZXRoZXJzLnV0aWxzLmZvcm1hdFVuaXRzKGdhc1ByaWNlV2VpLCAnZ3dlaScpLCAnZ3dlaScpXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tCbG9ja2NoYWluXSDml6Dms5Xojrflj5YgR2FzIFByaWNl77yM5L2/55So6buY6K6k5YC8IDEgZ3dlaScpXG4gICAgICAgIGdhc1ByaWNlV2VpID0gZXRoZXJzLnV0aWxzLnBhcnNlVW5pdHMoJzEnLCAnZ3dlaScpXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGdhc0xpbWl0ID0gZXRoZXJzLkJpZ051bWJlci5mcm9tKCcxMDAwMDAnKVxuXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOS6pOaYk+WPguaVsDonKVxuICAgICAgY29uc29sZS5sb2coJyAg4oCiIE5vbmNlOicsIG5vbmNlKVxuICAgICAgY29uc29sZS5sb2coJyAg4oCiIEdhcyBQcmljZTonLCBldGhlcnMudXRpbHMuZm9ybWF0VW5pdHMoZ2FzUHJpY2VXZWksICdnd2VpJyksICdnd2VpJylcbiAgICAgIGNvbnNvbGUubG9nKCcgIOKAoiBHYXMgTGltaXQ6JywgZ2FzTGltaXQudG9TdHJpbmcoKSlcblxuICAgICAgLy8g5p6E5bu6IHRyYW5zZmVyKCkg5Ye95pWw6LCD55So5pWw5o2uXG4gICAgICBjb25zdCBpZmFjZSA9IG5ldyBldGhlcnMudXRpbHMuSW50ZXJmYWNlKEVSQzIwX0FCSSlcbiAgICAgIGNvbnN0IGRhdGEgPSBpZmFjZS5lbmNvZGVGdW5jdGlvbkRhdGEoJ3RyYW5zZmVyJywgW3RvQWRkcmVzcywgYW1vdW50XSlcblxuICAgICAgLy8g5p6E5bu65Lqk5piT5a+56LGhXG4gICAgICBjb25zdCB0eCA9IHtcbiAgICAgICAgdG86IHRva2VuQWRkcmVzcyxcbiAgICAgICAgZnJvbTogd2FsbGV0LmFkZHJlc3MsXG4gICAgICAgIG5vbmNlOiBub25jZSxcbiAgICAgICAgZ2FzTGltaXQ6IGdhc0xpbWl0LFxuICAgICAgICBnYXNQcmljZTogZ2FzUHJpY2VXZWksXG4gICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCdbQmxvY2tjaGFpbl0g562+5ZCN5Lqk5piTLi4uJylcbiAgICAgIC8vIOetvuWQjeS6pOaYk1xuICAgICAgY29uc3Qgc2lnbmVkVHggPSBhd2FpdCB3YWxsZXQuc2lnblRyYW5zYWN0aW9uKHR4KVxuXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOWPkemAgeetvuWQjeeahOS6pOaYk+WIsOe9kee7nC4uLicpXG4gICAgICAvLyDnm7TmjqXpgJrov4cgSlNPTi1SUEMg5Y+R6YCB5Y6f5aeL5Lqk5piT77yM6YG/5YWNIHByb3ZpZGVyIOeahOe9kee7nOajgOa1i1xuICAgICAgY29uc3QgdHhIYXNoID0gYXdhaXQgdGhpcy5jYWxsSnNvblJwYygnZXRoX3NlbmRSYXdUcmFuc2FjdGlvbicsIFtzaWduZWRUeF0pXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOS6pOaYk+W3suWPkemAge+8jEhhc2g6JywgdHhIYXNoKVxuXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOetieW+heS6pOaYk+ehruiupC4uLicpXG4gICAgICAvLyDnrYnlvoXkuqTmmJPnoa7orqTvvIjmnIDlpJrnrYnlvoUgNjAg56eS77yJXG4gICAgICBjb25zdCBtYXhBdHRlbXB0cyA9IDMwXG4gICAgICBsZXQgcmVjZWlwdDogYW55ID0gbnVsbFxuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1heEF0dGVtcHRzOyBpKyspIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCByZWNlaXB0RGF0YSA9IGF3YWl0IHRoaXMuY2FsbEpzb25ScGMoJ2V0aF9nZXRUcmFuc2FjdGlvblJlY2VpcHQnLCBbdHhIYXNoXSlcbiAgICAgICAgICBpZiAocmVjZWlwdERhdGEpIHtcbiAgICAgICAgICAgIHJlY2VpcHQgPSByZWNlaXB0RGF0YVxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSDkuqTmmJPlt7Lnoa7orqTvvIzljLrlnZflj7c6JywgcGFyc2VJbnQocmVjZWlwdERhdGEuYmxvY2tOdW1iZXIsIDE2KSlcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUud2FybignW0Jsb2NrY2hhaW5dIOetieW+heehruiupOS4rS4uLicsIGkgKyAxKVxuICAgICAgICB9XG4gICAgICAgIC8vIOetieW+hSAyIOenkuWQjumHjeivlVxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAyMDAwKSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHJhbnNhY3Rpb25IYXNoOiB0eEhhc2gsXG4gICAgICAgIGJsb2NrTnVtYmVyOiByZWNlaXB0ID8gcGFyc2VJbnQocmVjZWlwdC5ibG9ja051bWJlciwgMTYpIDogdW5kZWZpbmVkLFxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1zZyA9IChlcnJvciBhcyBFcnJvcikubWVzc2FnZVxuICAgICAgY29uc29sZS5lcnJvcignW0Jsb2NrY2hhaW5dIOi9rOi0puWksei0pTonLCBlcnJvck1zZylcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOajgOafpSBFUkMyMCDku6PluIHkvZnpop1cbiAgICogQHBhcmFtIHRva2VuQWRkcmVzcyDku6PluIHlkIjnuqblnLDlnYBcbiAgICogQHBhcmFtIGFkZHJlc3Mg6LSm5oi35Zyw5Z2AXG4gICAqIEByZXR1cm5zIOS9memine+8iOWNleS9je+8mldlae+8iVxuICAgKi9cbiAgYXN5bmMgZ2V0RVJDMjBCYWxhbmNlKHRva2VuQWRkcmVzczogc3RyaW5nLCBhZGRyZXNzOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0b2tlbkNvbnRyYWN0ID0gbmV3IGV0aGVycy5Db250cmFjdCh0b2tlbkFkZHJlc3MsIEVSQzIwX0FCSSwgdGhpcy5wcm92aWRlcilcbiAgICAgIGNvbnN0IGJhbGFuY2UgPSBhd2FpdCB0b2tlbkNvbnRyYWN0LmJhbGFuY2VPZihhZGRyZXNzKVxuICAgICAgcmV0dXJuIGJhbGFuY2UudG9TdHJpbmcoKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbQmxvY2tjaGFpbl0g5p+l6K+i5L2Z6aKd5aSx6LSlOicsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6I635Y+WIERlcGxveWVyIOWcsOWdgFxuICAgKi9cbiAgYXN5bmMgZ2V0U2lnbmVyQWRkcmVzcygpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnNpZ25lci5nZXRBZGRyZXNzKClcbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bnvZHnu5zkv6Hmga9cbiAgICovXG4gIGFzeW5jIGdldE5ldHdvcmtJbmZvKCkge1xuICAgIGNvbnN0IG5ldHdvcmsgPSBhd2FpdCB0aGlzLnByb3ZpZGVyLmdldE5ldHdvcmsoKVxuICAgIHJldHVybiB7XG4gICAgICBjaGFpbklkOiBuZXR3b3JrLmNoYWluSWQsXG4gICAgICBuYW1lOiBuZXR3b3JrLm5hbWUsXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOiwg+eUqCBHYW1lRGl2aWRlbmRQb29sIOeahCBkZXBvc2l0RGl2aWRlbmQg5pa55rOV77yM5pu05paw5YiG57qiXG4gICAqIEBwYXJhbSBkaXZpZGVuZFBvb2xBZGRyZXNzIOWIhue6ouaxoOWQiOe6puWcsOWdgFxuICAgKiBAcGFyYW0gYW1vdW50IFZJUlRVQUwg5Luj5biB6YeR6aKd77yIV2VpIOWNleS9je+8iVxuICAgKiBAcmV0dXJucyDkuqTmmJPlk4jluIxcbiAgICovXG4gIGFzeW5jIHVwZGF0ZUdhbWVEaXZpZGVuZFBvb2woXG4gICAgZGl2aWRlbmRQb29sQWRkcmVzczogc3RyaW5nLFxuICAgIGFtb3VudDogc3RyaW5nXG4gICk6IFByb21pc2U8eyB0cmFuc2FjdGlvbkhhc2g6IHN0cmluZzsgYmxvY2tOdW1iZXI/OiBudW1iZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOWHhuWkh+iwg+eUqCBHYW1lRGl2aWRlbmRQb29sLmRlcG9zaXREaXZpZGVuZCgpJylcbiAgICAgIGNvbnNvbGUubG9nKCdbQmxvY2tjaGFpbl0g5YiG57qi5rGg5Zyw5Z2AOicsIGRpdmlkZW5kUG9vbEFkZHJlc3MpXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOWIhue6oumHkeminTonLCBhbW91bnQpXG5cbiAgICAgIC8vIOmqjOivgeWcsOWdgOagvOW8j1xuICAgICAgaWYgKCFldGhlcnMudXRpbHMuaXNBZGRyZXNzKGRpdmlkZW5kUG9vbEFkZHJlc3MpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBkaXZpZGVuZCBwb29sIGFkZHJlc3MgZm9ybWF0JylcbiAgICAgIH1cblxuICAgICAgLy8g5Yib5bu66ZKx5YyF55So5LqO562+5ZCNXG4gICAgICBjb25zdCB3YWxsZXQgPSBuZXcgZXRoZXJzLldhbGxldCh0aGlzLnByaXZhdGVLZXkpXG5cbiAgICAgIGxldCBub25jZTogbnVtYmVyXG4gICAgICBsZXQgZ2FzUHJpY2VXZWk6IGV0aGVycy5CaWdOdW1iZXJcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgbm9uY2VIZXggPSBhd2FpdCB0aGlzLmNhbGxKc29uUnBjKCdldGhfZ2V0VHJhbnNhY3Rpb25Db3VudCcsIFt3YWxsZXQuYWRkcmVzcywgJ2xhdGVzdCddKVxuICAgICAgICBub25jZSA9IHBhcnNlSW50KG5vbmNlSGV4LCAxNilcbiAgICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSDojrflj5YgTm9uY2U6Jywgbm9uY2UpXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tCbG9ja2NoYWluXSDml6Dms5Xojrflj5YgTm9uY2XvvIzkvb/nlKjpu5jorqTlgLwgMCcpXG4gICAgICAgIG5vbmNlID0gMFxuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBnYXNQcmljZUhleCA9IGF3YWl0IHRoaXMuY2FsbEpzb25ScGMoJ2V0aF9nYXNQcmljZScsIFtdKVxuICAgICAgICBnYXNQcmljZVdlaSA9IGV0aGVycy5CaWdOdW1iZXIuZnJvbShnYXNQcmljZUhleClcbiAgICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSDojrflj5YgR2FzIFByaWNlOicsIGV0aGVycy51dGlscy5mb3JtYXRVbml0cyhnYXNQcmljZVdlaSwgJ2d3ZWknKSwgJ2d3ZWknKVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbQmxvY2tjaGFpbl0g5peg5rOV6I635Y+WIEdhcyBQcmljZe+8jOS9v+eUqOm7mOiupOWAvCAxIGd3ZWknKVxuICAgICAgICBnYXNQcmljZVdlaSA9IGV0aGVycy51dGlscy5wYXJzZVVuaXRzKCcxJywgJ2d3ZWknKVxuICAgICAgfVxuXG4gICAgICBjb25zdCBnYXNMaW1pdCA9IGV0aGVycy5CaWdOdW1iZXIuZnJvbSgnMTUwMDAwJykgLy8gZGVwb3NpdERpdmlkZW5kIOmcgOimgeabtOWkmiBnYXNcblxuICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSDkuqTmmJPlj4LmlbA6JylcbiAgICAgIGNvbnNvbGUubG9nKCcgIOKAoiBOb25jZTonLCBub25jZSlcbiAgICAgIGNvbnNvbGUubG9nKCcgIOKAoiBHYXMgUHJpY2U6JywgZXRoZXJzLnV0aWxzLmZvcm1hdFVuaXRzKGdhc1ByaWNlV2VpLCAnZ3dlaScpLCAnZ3dlaScpXG4gICAgICBjb25zb2xlLmxvZygnICDigKIgR2FzIExpbWl0OicsIGdhc0xpbWl0LnRvU3RyaW5nKCkpXG5cbiAgICAgIC8vIOmcgOimgeWFiOiwg+eUqCBWSVJUVUFMIOS7o+W4geeahCBhcHByb3Zl77yM5o6I5p2DIGRpdmlkZW5kUG9vbCDkvb/nlKjmiJHku6znmoTku6PluIFcbiAgICAgIGNvbnNvbGUubG9nKCdbQmxvY2tjaGFpbl0g5p6E5bu6IGFwcHJvdmUg5Lqk5piTLi4uJylcbiAgICAgIGNvbnN0IHZpcnR1YWxUb2tlbkFkZHJlc3MgPSBwcm9jZXNzLmVudi5WSVJUVUFMX1RPS0VOX0FERFJFU1NcbiAgICAgIGlmICghdmlydHVhbFRva2VuQWRkcmVzcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ZJUlRVQUxfVE9LRU5fQUREUkVTUyBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0JylcbiAgICAgIH1cblxuICAgICAgLy8g5p6E5bu6IGFwcHJvdmUg5Lqk5piT5pWw5o2uXG4gICAgICBjb25zdCBpZmFjZSA9IG5ldyBldGhlcnMudXRpbHMuSW50ZXJmYWNlKEVSQzIwX0FCSSlcbiAgICAgIGNvbnN0IGFwcHJvdmVEYXRhID0gaWZhY2UuZW5jb2RlRnVuY3Rpb25EYXRhKCdhcHByb3ZlJywgW2RpdmlkZW5kUG9vbEFkZHJlc3MsIGFtb3VudF0pXG5cbiAgICAgIGNvbnN0IGFwcHJvdmVUeCA9IHtcbiAgICAgICAgdG86IHZpcnR1YWxUb2tlbkFkZHJlc3MsXG4gICAgICAgIGZyb206IHdhbGxldC5hZGRyZXNzLFxuICAgICAgICBub25jZTogbm9uY2UsXG4gICAgICAgIGdhc0xpbWl0OiBldGhlcnMuQmlnTnVtYmVyLmZyb20oJzEwMDAwMCcpLFxuICAgICAgICBnYXNQcmljZTogZ2FzUHJpY2VXZWksXG4gICAgICAgIGRhdGE6IGFwcHJvdmVEYXRhLFxuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOetvuWQjSBhcHByb3ZlIOS6pOaYky4uLicpXG4gICAgICBjb25zdCBzaWduZWRBcHByb3ZlVHggPSBhd2FpdCB3YWxsZXQuc2lnblRyYW5zYWN0aW9uKGFwcHJvdmVUeClcblxuICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSDlj5HpgIEgYXBwcm92ZSDkuqTmmJMuLi4nKVxuICAgICAgY29uc3QgYXBwcm92ZVR4SGFzaCA9IGF3YWl0IHRoaXMuY2FsbEpzb25ScGMoJ2V0aF9zZW5kUmF3VHJhbnNhY3Rpb24nLCBbc2lnbmVkQXBwcm92ZVR4XSlcbiAgICAgIGNvbnNvbGUubG9nKCdbQmxvY2tjaGFpbl0gQXBwcm92ZSDkuqTmmJPlt7Llj5HpgIHvvIxIYXNoOicsIGFwcHJvdmVUeEhhc2gpXG5cbiAgICAgIC8vIOetieW+hSBhcHByb3ZlIOS6pOaYk+ehruiupFxuICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSDnrYnlvoUgYXBwcm92ZSDkuqTmmJPnoa7orqQuLi4nKVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzMDsgaSsrKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcmVjZWlwdERhdGEgPSBhd2FpdCB0aGlzLmNhbGxKc29uUnBjKCdldGhfZ2V0VHJhbnNhY3Rpb25SZWNlaXB0JywgW2FwcHJvdmVUeEhhc2hdKVxuICAgICAgICAgIGlmIChyZWNlaXB0RGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSBBcHByb3ZlIOS6pOaYk+W3suehruiupCcpXG4gICAgICAgICAgICBicmVha1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ1tCbG9ja2NoYWluXSDnrYnlvoUgYXBwcm92ZSDnoa7orqTkuK0uLi4nLCBpICsgMSlcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAyMDAwKSlcbiAgICAgIH1cblxuICAgICAgLy8g546w5Zyo5p6E5bu6IGRlcG9zaXREaXZpZGVuZCDkuqTmmJNcbiAgICAgIGNvbnNvbGUubG9nKCdbQmxvY2tjaGFpbl0g5p6E5bu6IGRlcG9zaXREaXZpZGVuZCDkuqTmmJMuLi4nKVxuICAgICAgY29uc3QgZGVwb3NpdElmYWNlID0gbmV3IGV0aGVycy51dGlscy5JbnRlcmZhY2UoRElWSURFTkRfUE9PTF9BQkkpXG4gICAgICBjb25zdCBkZXBvc2l0RGF0YSA9IGRlcG9zaXRJZmFjZS5lbmNvZGVGdW5jdGlvbkRhdGEoJ2RlcG9zaXREaXZpZGVuZCcsIFthbW91bnRdKVxuXG4gICAgICBjb25zdCBkZXBvc2l0VHggPSB7XG4gICAgICAgIHRvOiBkaXZpZGVuZFBvb2xBZGRyZXNzLFxuICAgICAgICBmcm9tOiB3YWxsZXQuYWRkcmVzcyxcbiAgICAgICAgbm9uY2U6IG5vbmNlICsgMSwgLy8gTm9uY2Ug6ZyA6KaB6YCS5aKeXG4gICAgICAgIGdhc0xpbWl0OiBldGhlcnMuQmlnTnVtYmVyLmZyb20oJzE1MDAwMCcpLFxuICAgICAgICBnYXNQcmljZTogZ2FzUHJpY2VXZWksXG4gICAgICAgIGRhdGE6IGRlcG9zaXREYXRhLFxuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOetvuWQjSBkZXBvc2l0RGl2aWRlbmQg5Lqk5piTLi4uJylcbiAgICAgIGNvbnN0IHNpZ25lZERlcG9zaXRUeCA9IGF3YWl0IHdhbGxldC5zaWduVHJhbnNhY3Rpb24oZGVwb3NpdFR4KVxuXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOWPkemAgSBkZXBvc2l0RGl2aWRlbmQg5Lqk5piTLi4uJylcbiAgICAgIGNvbnN0IGRlcG9zaXRUeEhhc2ggPSBhd2FpdCB0aGlzLmNhbGxKc29uUnBjKCdldGhfc2VuZFJhd1RyYW5zYWN0aW9uJywgW3NpZ25lZERlcG9zaXRUeF0pXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIERlcG9zaXQg5Lqk5piT5bey5Y+R6YCB77yMSGFzaDonLCBkZXBvc2l0VHhIYXNoKVxuXG4gICAgICAvLyDnrYnlvoUgZGVwb3NpdCDkuqTmmJPnoa7orqRcbiAgICAgIGNvbnNvbGUubG9nKCdbQmxvY2tjaGFpbl0g562J5b6FIGRlcG9zaXREaXZpZGVuZCDkuqTmmJPnoa7orqQuLi4nKVxuICAgICAgbGV0IHJlY2VpcHQ6IGFueSA9IG51bGxcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzA7IGkrKykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlY2VpcHREYXRhID0gYXdhaXQgdGhpcy5jYWxsSnNvblJwYygnZXRoX2dldFRyYW5zYWN0aW9uUmVjZWlwdCcsIFtkZXBvc2l0VHhIYXNoXSlcbiAgICAgICAgICBpZiAocmVjZWlwdERhdGEpIHtcbiAgICAgICAgICAgIHJlY2VpcHQgPSByZWNlaXB0RGF0YVxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSBEZXBvc2l0IOS6pOaYk+W3suehruiupO+8jOWMuuWdl+WPtzonLCBwYXJzZUludChyZWNlaXB0RGF0YS5ibG9ja051bWJlciwgMTYpKVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdbQmxvY2tjaGFpbl0g562J5b6FIGRlcG9zaXQg56Gu6K6k5LitLi4uJywgaSArIDEpXG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMjAwMCkpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRyYW5zYWN0aW9uSGFzaDogZGVwb3NpdFR4SGFzaCxcbiAgICAgICAgYmxvY2tOdW1iZXI6IHJlY2VpcHQgPyBwYXJzZUludChyZWNlaXB0LmJsb2NrTnVtYmVyLCAxNikgOiB1bmRlZmluZWQsXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yTXNnID0gKGVycm9yIGFzIEVycm9yKS5tZXNzYWdlXG4gICAgICBjb25zb2xlLmVycm9yKCdbQmxvY2tjaGFpbl0g5YiG57qi5pu05paw5aSx6LSlOicsIGVycm9yTXNnKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5p+l6K+i55So5oi355qE5YiG57qi5L+h5oGvXG4gICAqIEBwYXJhbSBkaXZpZGVuZFBvb2xBZGRyZXNzIOWIhue6ouaxoOWQiOe6puWcsOWdgFxuICAgKiBAcGFyYW0gdXNlckFkZHJlc3Mg55So5oi35Zyw5Z2AXG4gICAqIEByZXR1cm5zIOeUqOaIt+WIhue6ouS/oeaBr1xuICAgKi9cbiAgYXN5bmMgZ2V0VXNlckRpdmlkZW5kSW5mbyhcbiAgICBkaXZpZGVuZFBvb2xBZGRyZXNzOiBzdHJpbmcsXG4gICAgdXNlckFkZHJlc3M6IHN0cmluZ1xuICApOiBQcm9taXNlPHtcbiAgICBwZW5kaW5nOiBzdHJpbmdcbiAgICBjbGFpbWVkOiBzdHJpbmdcbiAgICBnYW1lQmFsYW5jZTogc3RyaW5nXG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSDmn6Xor6LnlKjmiLfliIbnuqLkv6Hmga8nKVxuICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSDliIbnuqLmsaDlnLDlnYA6JywgZGl2aWRlbmRQb29sQWRkcmVzcylcbiAgICAgIGNvbnNvbGUubG9nKCdbQmxvY2tjaGFpbl0g55So5oi35Zyw5Z2AOicsIHVzZXJBZGRyZXNzKVxuXG4gICAgICAvLyDpqozor4HlnLDlnYDmoLzlvI9cbiAgICAgIGlmICghZXRoZXJzLnV0aWxzLmlzQWRkcmVzcyhkaXZpZGVuZFBvb2xBZGRyZXNzKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZGl2aWRlbmQgcG9vbCBhZGRyZXNzIGZvcm1hdCcpXG4gICAgICB9XG4gICAgICBpZiAoIWV0aGVycy51dGlscy5pc0FkZHJlc3ModXNlckFkZHJlc3MpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB1c2VyIGFkZHJlc3MgZm9ybWF0JylcbiAgICAgIH1cblxuICAgICAgLy8g5Yib5bu65ZCI57qm5a6e5L6L5bm26LCD55SoIHZpZXcg5Ye95pWwXG4gICAgICBjb25zdCBjb250cmFjdCA9IG5ldyBldGhlcnMuQ29udHJhY3QoZGl2aWRlbmRQb29sQWRkcmVzcywgRElWSURFTkRfUE9PTF9BQkksIHRoaXMucHJvdmlkZXIpXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cmFjdC5nZXRVc2VyRGl2aWRlbmRJbmZvKHVzZXJBZGRyZXNzKVxuXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOeUqOaIt+WIhue6ouS/oeaBr+afpeivouaIkOWKnycpXG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOW+heaPkOWPluWIhue6ojonLCByZXN1bHQucGVuZGluZy50b1N0cmluZygpKVxuICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSDlt7Lmj5Dlj5bliIbnuqI6JywgcmVzdWx0LmNsYWltZWQudG9TdHJpbmcoKSlcbiAgICAgIGNvbnNvbGUubG9nKCdbQmxvY2tjaGFpbl0gR0FNRSDkvZnpop06JywgcmVzdWx0LmdhbWVCYWxhbmNlLnRvU3RyaW5nKCkpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBlbmRpbmc6IHJlc3VsdC5wZW5kaW5nLnRvU3RyaW5nKCksXG4gICAgICAgIGNsYWltZWQ6IHJlc3VsdC5jbGFpbWVkLnRvU3RyaW5nKCksXG4gICAgICAgIGdhbWVCYWxhbmNlOiByZXN1bHQuZ2FtZUJhbGFuY2UudG9TdHJpbmcoKSxcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JNc2cgPSAoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2VcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tCbG9ja2NoYWluXSDmn6Xor6LliIbnuqLkv6Hmga/lpLHotKU6JywgZXJyb3JNc2cpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmn6Xor6LliIbnuqLmsaDnmoTnu5/orqHmlbDmja5cbiAgICogQHBhcmFtIGRpdmlkZW5kUG9vbEFkZHJlc3Mg5YiG57qi5rGg5ZCI57qm5Zyw5Z2AXG4gICAqIEByZXR1cm5zIOWIhue6ouaxoOe7n+iuoeS/oeaBr1xuICAgKi9cbiAgYXN5bmMgZ2V0RGl2aWRlbmRQb29sU3RhdHMoXG4gICAgZGl2aWRlbmRQb29sQWRkcmVzczogc3RyaW5nXG4gICk6IFByb21pc2U8e1xuICAgIHRvdGFsRGl2aWRlbmRQb29sOiBzdHJpbmdcbiAgICB0b3RhbENsYWltZWQ6IHN0cmluZ1xuICAgIHRvdGFsUGVuZGluZzogc3RyaW5nXG4gICAgdG90YWxEaXZpZGVuZFBlclNoYXJlOiBzdHJpbmdcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnW0Jsb2NrY2hhaW5dIOafpeivouWIhue6ouaxoOe7n+iuoeS/oeaBrycpXG5cbiAgICAgIC8vIOmqjOivgeWcsOWdgOagvOW8j1xuICAgICAgaWYgKCFldGhlcnMudXRpbHMuaXNBZGRyZXNzKGRpdmlkZW5kUG9vbEFkZHJlc3MpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBkaXZpZGVuZCBwb29sIGFkZHJlc3MgZm9ybWF0JylcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29udHJhY3QgPSBuZXcgZXRoZXJzLkNvbnRyYWN0KGRpdmlkZW5kUG9vbEFkZHJlc3MsIERJVklERU5EX1BPT0xfQUJJLCB0aGlzLnByb3ZpZGVyKVxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJhY3QuZ2V0UG9vbFN0YXRzKClcblxuICAgICAgY29uc29sZS5sb2coJ1tCbG9ja2NoYWluXSDliIbnuqLmsaDnu5/orqHkv6Hmga/mn6Xor6LmiJDlip8nKVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b3RhbERpdmlkZW5kUG9vbDogcmVzdWx0Ll90b3RhbERpdmlkZW5kUG9vbC50b1N0cmluZygpLFxuICAgICAgICB0b3RhbENsYWltZWQ6IHJlc3VsdC5fdG90YWxDbGFpbWVkLnRvU3RyaW5nKCksXG4gICAgICAgIHRvdGFsUGVuZGluZzogcmVzdWx0Ll90b3RhbFBlbmRpbmcudG9TdHJpbmcoKSxcbiAgICAgICAgdG90YWxEaXZpZGVuZFBlclNoYXJlOiByZXN1bHQuX3RvdGFsRGl2aWRlbmRQZXJTaGFyZS50b1N0cmluZygpLFxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1zZyA9IChlcnJvciBhcyBFcnJvcikubWVzc2FnZVxuICAgICAgY29uc29sZS5lcnJvcignW0Jsb2NrY2hhaW5dIOafpeivouWIhue6ouaxoOe7n+iuoeWksei0pTonLCBlcnJvck1zZylcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG59XG5cbi8qKlxuICog5Yib5bu65Yy65Z2X6ZO+5a6i5oi356uv5a6e5L6LXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVCbG9ja2NoYWluQ2xpZW50KCk6IEJsb2NrY2hhaW5DbGllbnQge1xuICBjb25zdCBycGNVcmwgPSBwcm9jZXNzLmVudi5CQVNFX1NFUE9MSUFfUlBDX1VSTFxuICBjb25zdCBwcml2YXRlS2V5ID0gcHJvY2Vzcy5lbnYuREVQTE9ZRVJfUFJJVkFURV9LRVlcbiAgY29uc3QgY2hhaW5JZCA9IHBhcnNlSW50KHByb2Nlc3MuZW52LkNIQUlOX0lEIHx8ICc4NDUzMicpXG5cbiAgaWYgKCFycGNVcmwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JBU0VfU0VQT0xJQV9SUENfVVJMIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIG5vdCBzZXQnKVxuICB9XG5cbiAgaWYgKCFwcml2YXRlS2V5KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdERVBMT1lFUl9QUklWQVRFX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0JylcbiAgfVxuXG4gIHJldHVybiBuZXcgQmxvY2tjaGFpbkNsaWVudCh7XG4gICAgcnBjVXJsLFxuICAgIHByaXZhdGVLZXksXG4gICAgY2hhaW5JZCxcbiAgfSlcbn1cblxuLyoqXG4gKiDlsIblrZfnrKbkuLLmlbDlrZfovazmjaLkuLogV2Vp77yIRVJDMjAg5qCH5YeG6YCa5bi45pivIDE4IOS9jeWwj+aVsO+8iVxuICogQHBhcmFtIGFtb3VudCDmlbDlrZfvvIjlpoIgXCIxXCLvvIlcbiAqIEBwYXJhbSBkZWNpbWFscyDlsI/mlbDkvY3mlbDvvIjpu5jorqQgMTjvvIlcbiAqIEByZXR1cm5zIFdlaSDmoLzlvI/nmoTlrZfnrKbkuLJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvV2VpKGFtb3VudDogc3RyaW5nLCBkZWNpbWFsczogbnVtYmVyID0gMTgpOiBzdHJpbmcge1xuICByZXR1cm4gZXRoZXJzLnV0aWxzLnBhcnNlVW5pdHMoYW1vdW50LCBkZWNpbWFscykudG9TdHJpbmcoKVxufVxuXG4vKipcbiAqIOWwhiBXZWkg6L2s5o2i5Li65a2X56ym5Liy5pWw5a2XXG4gKiBAcGFyYW0gd2VpIFdlaSDmoLzlvI/nmoTlrZfnrKbkuLJcbiAqIEBwYXJhbSBkZWNpbWFscyDlsI/mlbDkvY3mlbDvvIjpu5jorqQgMTjvvIlcbiAqIEByZXR1cm5zIOaZrumAmuaVsOWtl+Wtl+espuS4slxuICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbVdlaSh3ZWk6IHN0cmluZywgZGVjaW1hbHM6IG51bWJlciA9IDE4KTogc3RyaW5nIHtcbiAgcmV0dXJuIGV0aGVycy51dGlscy5mb3JtYXRVbml0cyh3ZWksIGRlY2ltYWxzKVxufVxuIl0sIm5hbWVzIjpbImV0aGVycyIsIkVSQzIwX0FCSSIsIkRJVklERU5EX1BPT0xfQUJJIiwiQmxvY2tjaGFpbkNsaWVudCIsInByb3ZpZGVyIiwic2lnbmVyIiwicnBjVXJsIiwicHJpdmF0ZUtleSIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwicHJvdmlkZXJzIiwiSnNvblJwY1Byb3ZpZGVyIiwiV2FsbGV0IiwiY2FsbEpzb25ScGMiLCJtZXRob2QiLCJwYXJhbXMiLCJyZXNwb25zZSIsImZldGNoIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwianNvbnJwYyIsImlkIiwiRGF0ZSIsIm5vdyIsImRhdGEiLCJqc29uIiwiZXJyb3IiLCJFcnJvciIsIm1lc3NhZ2UiLCJyZXN1bHQiLCJ0cmFuc2ZlckVSQzIwIiwidG9rZW5BZGRyZXNzIiwidG9BZGRyZXNzIiwiYW1vdW50IiwiY29uc29sZSIsImxvZyIsInV0aWxzIiwiaXNBZGRyZXNzIiwid2FsbGV0Iiwibm9uY2UiLCJnYXNQcmljZVdlaSIsIm5vbmNlSGV4IiwiYWRkcmVzcyIsInBhcnNlSW50Iiwid2FybiIsImdhc1ByaWNlSGV4IiwiQmlnTnVtYmVyIiwiZnJvbSIsImZvcm1hdFVuaXRzIiwicGFyc2VVbml0cyIsImdhc0xpbWl0IiwidG9TdHJpbmciLCJpZmFjZSIsIkludGVyZmFjZSIsImVuY29kZUZ1bmN0aW9uRGF0YSIsInR4IiwidG8iLCJnYXNQcmljZSIsInNpZ25lZFR4Iiwic2lnblRyYW5zYWN0aW9uIiwidHhIYXNoIiwibWF4QXR0ZW1wdHMiLCJyZWNlaXB0IiwiaSIsInJlY2VpcHREYXRhIiwiYmxvY2tOdW1iZXIiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJ0cmFuc2FjdGlvbkhhc2giLCJ1bmRlZmluZWQiLCJlcnJvck1zZyIsImdldEVSQzIwQmFsYW5jZSIsInRva2VuQ29udHJhY3QiLCJDb250cmFjdCIsImJhbGFuY2UiLCJiYWxhbmNlT2YiLCJnZXRTaWduZXJBZGRyZXNzIiwiZ2V0QWRkcmVzcyIsImdldE5ldHdvcmtJbmZvIiwibmV0d29yayIsImdldE5ldHdvcmsiLCJjaGFpbklkIiwibmFtZSIsInVwZGF0ZUdhbWVEaXZpZGVuZFBvb2wiLCJkaXZpZGVuZFBvb2xBZGRyZXNzIiwidmlydHVhbFRva2VuQWRkcmVzcyIsInByb2Nlc3MiLCJlbnYiLCJWSVJUVUFMX1RPS0VOX0FERFJFU1MiLCJhcHByb3ZlRGF0YSIsImFwcHJvdmVUeCIsInNpZ25lZEFwcHJvdmVUeCIsImFwcHJvdmVUeEhhc2giLCJkZXBvc2l0SWZhY2UiLCJkZXBvc2l0RGF0YSIsImRlcG9zaXRUeCIsInNpZ25lZERlcG9zaXRUeCIsImRlcG9zaXRUeEhhc2giLCJnZXRVc2VyRGl2aWRlbmRJbmZvIiwidXNlckFkZHJlc3MiLCJjb250cmFjdCIsInBlbmRpbmciLCJjbGFpbWVkIiwiZ2FtZUJhbGFuY2UiLCJnZXREaXZpZGVuZFBvb2xTdGF0cyIsImdldFBvb2xTdGF0cyIsInRvdGFsRGl2aWRlbmRQb29sIiwiX3RvdGFsRGl2aWRlbmRQb29sIiwidG90YWxDbGFpbWVkIiwiX3RvdGFsQ2xhaW1lZCIsInRvdGFsUGVuZGluZyIsIl90b3RhbFBlbmRpbmciLCJ0b3RhbERpdmlkZW5kUGVyU2hhcmUiLCJfdG90YWxEaXZpZGVuZFBlclNoYXJlIiwiY3JlYXRlQmxvY2tjaGFpbkNsaWVudCIsIkJBU0VfU0VQT0xJQV9SUENfVVJMIiwiREVQTE9ZRVJfUFJJVkFURV9LRVkiLCJDSEFJTl9JRCIsInRvV2VpIiwiZGVjaW1hbHMiLCJmcm9tV2VpIiwid2VpIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/blockchain.ts\n");

/***/ }),

/***/ "(rsc)/./lib/mongodb.ts":
/*!************************!*\
  !*** ./lib/mongodb.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   cleanupExpiredSubscriptions: () => (/* binding */ cleanupExpiredSubscriptions),\n/* harmony export */   closeDB: () => (/* binding */ closeDB),\n/* harmony export */   connectDB: () => (/* binding */ connectDB),\n/* harmony export */   getDB: () => (/* binding */ getDB),\n/* harmony export */   initializeDatabase: () => (/* binding */ initializeDatabase)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n/**\n * MongoDB 连接管理模块\n * 使用单例模式缓存连接，避免每次重复连接\n */ \nconst MONGODB_URI = process.env.MONGODB_URI || \"mongodb://localhost:27017\";\nconst MONGODB_DB_NAME = process.env.MONGODB_DB_NAME || \"game-ai\";\n/**\n * 缓存的连接实例\n */ let cachedClient = null;\nlet cachedDb = null;\n/**\n * 连接到 MongoDB\n * 使用单例模式确保只创建一个连接\n */ async function connectDB() {\n    // 如果已有连接，直接返回\n    if (cachedClient && cachedDb) {\n        console.log(\"[MongoDB] 使用缓存连接\");\n        return cachedDb;\n    }\n    try {\n        console.log(\"[MongoDB] 正在连接...\");\n        const client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(MONGODB_URI, {\n            maxPoolSize: 10,\n            minPoolSize: 2,\n            maxIdleTimeMS: 60000\n        });\n        await client.connect();\n        console.log(\"[MongoDB] 连接成功\");\n        // 获取数据库实例\n        const db = client.db(MONGODB_DB_NAME);\n        // 缓存连接和数据库实例\n        cachedClient = client;\n        cachedDb = db;\n        return db;\n    } catch (error) {\n        console.error(\"[MongoDB] 连接失败:\", error);\n        throw error;\n    }\n}\n/**\n * 关闭 MongoDB 连接\n */ async function closeDB() {\n    if (cachedClient) {\n        await cachedClient.close();\n        cachedClient = null;\n        cachedDb = null;\n        console.log(\"[MongoDB] 连接已关闭\");\n    }\n}\n/**\n * 获取当前数据库实例\n */ function getDB() {\n    if (!cachedDb) {\n        throw new Error(\"Database not connected. Call connectDB() first.\");\n    }\n    return cachedDb;\n}\n/**\n * 创建必要的集合和索引\n */ async function initializeDatabase() {\n    try {\n        const db = await connectDB();\n        console.log(\"[MongoDB] 初始化数据库...\");\n        // 创建 subscriptions 集合\n        try {\n            await db.createCollection(\"subscriptions\");\n            console.log(\"[MongoDB] subscriptions 集合已创建\");\n        } catch (error) {\n            if (error.code === 48) {\n                // 集合已存在\n                console.log(\"[MongoDB] subscriptions 集合已存在\");\n            } else {\n                throw error;\n            }\n        }\n        // 创建 subscriptions 索引\n        await db.collection(\"subscriptions\").createIndex({\n            userAddress: 1\n        }, {\n            unique: true\n        });\n        console.log(\"[MongoDB] subscriptions.userAddress 唯一索引已创建\");\n        await db.collection(\"subscriptions\").createIndex({\n            expiresAt: 1\n        });\n        console.log(\"[MongoDB] subscriptions.expiresAt 索引已创建\");\n        await db.collection(\"subscriptions\").createIndex({\n            status: 1\n        });\n        console.log(\"[MongoDB] subscriptions.status 索引已创建\");\n        // 创建 chat_logs 集合（可选）\n        try {\n            await db.createCollection(\"chat_logs\");\n            console.log(\"[MongoDB] chat_logs 集合已创建\");\n        } catch (error) {\n            if (error.code === 48) {\n                console.log(\"[MongoDB] chat_logs 集合已存在\");\n            } else {\n                throw error;\n            }\n        }\n        // 创建 chat_logs 索引\n        await db.collection(\"chat_logs\").createIndex({\n            userAddress: 1\n        });\n        console.log(\"[MongoDB] chat_logs.userAddress 索引已创建\");\n        await db.collection(\"chat_logs\").createIndex({\n            timestamp: 1\n        });\n        console.log(\"[MongoDB] chat_logs.timestamp 索引已创建\");\n        // 创建 gameContent 集合\n        try {\n            await db.createCollection(\"gameContent\");\n            console.log(\"[MongoDB] gameContent 集合已创建\");\n        } catch (error) {\n            if (error.code === 48) {\n                console.log(\"[MongoDB] gameContent 集合已存在\");\n            } else {\n                throw error;\n            }\n        }\n        // 创建 gameContent 索引\n        await db.collection(\"gameContent\").createIndex({\n            contentId: 1\n        }, {\n            unique: true\n        });\n        console.log(\"[MongoDB] gameContent.contentId 唯一索引已创建\");\n        await db.collection(\"gameContent\").createIndex({\n            userAddress: 1\n        });\n        console.log(\"[MongoDB] gameContent.userAddress 索引已创建\");\n        await db.collection(\"gameContent\").createIndex({\n            gameTitle: 1\n        });\n        console.log(\"[MongoDB] gameContent.gameTitle 索引已创建\");\n        await db.collection(\"gameContent\").createIndex({\n            createdAt: 1\n        });\n        console.log(\"[MongoDB] gameContent.createdAt 索引已创建\");\n        // 创建 dividendWithdrawals 集合\n        try {\n            await db.createCollection(\"dividendWithdrawals\");\n            console.log(\"[MongoDB] dividendWithdrawals 集合已创建\");\n        } catch (error) {\n            if (error.code === 48) {\n                console.log(\"[MongoDB] dividendWithdrawals 集合已存在\");\n            } else {\n                throw error;\n            }\n        }\n        // 创建 dividendWithdrawals 索引\n        await db.collection(\"dividendWithdrawals\").createIndex({\n            withdrawalId: 1\n        }, {\n            unique: true\n        });\n        console.log(\"[MongoDB] dividendWithdrawals.withdrawalId 唯一索引已创建\");\n        await db.collection(\"dividendWithdrawals\").createIndex({\n            userAddress: 1\n        });\n        console.log(\"[MongoDB] dividendWithdrawals.userAddress 索引已创建\");\n        await db.collection(\"dividendWithdrawals\").createIndex({\n            transactionHash: 1\n        });\n        console.log(\"[MongoDB] dividendWithdrawals.transactionHash 索引已创建\");\n        await db.collection(\"dividendWithdrawals\").createIndex({\n            createdAt: 1\n        });\n        console.log(\"[MongoDB] dividendWithdrawals.createdAt 索引已创建\");\n        await db.collection(\"dividendWithdrawals\").createIndex({\n            status: 1\n        });\n        console.log(\"[MongoDB] dividendWithdrawals.status 索引已创建\");\n        console.log(\"[MongoDB] 数据库初始化完成\");\n    } catch (error) {\n        console.error(\"[MongoDB] 初始化失败:\", error);\n        throw error;\n    }\n}\n/**\n * 清理过期的订阅\n * 定期调用此函数删除已过期的订阅记录\n */ async function cleanupExpiredSubscriptions() {\n    try {\n        const db = await connectDB();\n        const now = Math.floor(Date.now() / 1000);\n        const result = await db.collection(\"subscriptions\").deleteMany({\n            expiresAt: {\n                $lt: now\n            },\n            status: \"inactive\"\n        });\n        console.log(`[MongoDB] 已清理 ${result.deletedCount} 条过期订阅记录`);\n        return result.deletedCount;\n    } catch (error) {\n        console.error(\"[MongoDB] 清理过期订阅失败:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVFDLEdBQUcsQ0FBQztRQUVaLE1BQU1NLEdBQUdTLFVBQVUsQ0FBQyx1QkFBdUJDLFdBQVcsQ0FBQztZQUFFVSxpQkFBaUI7UUFBRTtRQUM1RTNCLFFBQVFDLEdBQUcsQ0FBQztRQUVaLE1BQU1NLEdBQUdTLFVBQVUsQ0FBQyx1QkFBdUJDLFdBQVcsQ0FBQztZQUFFUSxXQUFXO1FBQUU7UUFDdEV6QixRQUFRQyxHQUFHLENBQUM7UUFFWixNQUFNTSxHQUFHUyxVQUFVLENBQUMsdUJBQXVCQyxXQUFXLENBQUM7WUFBRUksUUFBUTtRQUFFO1FBQ25FckIsUUFBUUMsR0FBRyxDQUFDO1FBRVpELFFBQVFDLEdBQUcsQ0FBQztJQUNkLEVBQUUsT0FBT08sT0FBTztRQUNkUixRQUFRUSxLQUFLLENBQUMsb0JBQW9CQTtRQUNsQyxNQUFNQTtJQUNSO0FBQ0Y7QUFFQTs7O0NBR0MsR0FDTSxlQUFlb0I7SUFDcEIsSUFBSTtRQUNGLE1BQU1yQixLQUFLLE1BQU1SO1FBQ2pCLE1BQU04QixNQUFNQyxLQUFLQyxLQUFLLENBQUNDLEtBQUtILEdBQUcsS0FBSztRQUVwQyxNQUFNSSxTQUFTLE1BQU0xQixHQUFHUyxVQUFVLENBQUMsaUJBQWlCa0IsVUFBVSxDQUFDO1lBQzdEZCxXQUFXO2dCQUFFZSxLQUFLTjtZQUFJO1lBQ3RCUixRQUFRO1FBQ1Y7UUFFQXJCLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGNBQWMsRUFBRWdDLE9BQU9HLFlBQVksQ0FBQyxRQUFRLENBQUM7UUFDMUQsT0FBT0gsT0FBT0csWUFBWTtJQUM1QixFQUFFLE9BQU81QixPQUFPO1FBQ2RSLFFBQVFRLEtBQUssQ0FBQyx1QkFBdUJBO1FBQ3JDLE1BQU1BO0lBQ1I7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL0BnYW1lLWFpL3NlcnZlci8uL2xpYi9tb25nb2RiLnRzPzA1YmQiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNb25nb0RCIOi/nuaOpeeuoeeQhuaooeWdl1xuICog5L2/55So5Y2V5L6L5qih5byP57yT5a2Y6L+e5o6l77yM6YG/5YWN5q+P5qyh6YeN5aSN6L+e5o6lXG4gKi9cblxuaW1wb3J0IHsgTW9uZ29DbGllbnQsIERiIH0gZnJvbSAnbW9uZ29kYidcblxuY29uc3QgTU9OR09EQl9VUkkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSSB8fCAnbW9uZ29kYjovL2xvY2FsaG9zdDoyNzAxNydcbmNvbnN0IE1PTkdPREJfREJfTkFNRSA9IHByb2Nlc3MuZW52Lk1PTkdPREJfREJfTkFNRSB8fCAnZ2FtZS1haSdcblxuLyoqXG4gKiDnvJPlrZjnmoTov57mjqXlrp7kvotcbiAqL1xubGV0IGNhY2hlZENsaWVudDogTW9uZ29DbGllbnQgfCBudWxsID0gbnVsbFxubGV0IGNhY2hlZERiOiBEYiB8IG51bGwgPSBudWxsXG5cbi8qKlxuICog6L+e5o6l5YiwIE1vbmdvREJcbiAqIOS9v+eUqOWNleS+i+aooeW8j+ehruS/neWPquWIm+W7uuS4gOS4qui/nuaOpVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29ubmVjdERCKCk6IFByb21pc2U8RGI+IHtcbiAgLy8g5aaC5p6c5bey5pyJ6L+e5o6l77yM55u05o6l6L+U5ZueXG4gIGlmIChjYWNoZWRDbGllbnQgJiYgY2FjaGVkRGIpIHtcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIOS9v+eUqOe8k+WtmOi/nuaOpScpXG4gICAgcmV0dXJuIGNhY2hlZERiXG4gIH1cblxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0g5q2j5Zyo6L+e5o6lLi4uJylcblxuICAgIGNvbnN0IGNsaWVudCA9IG5ldyBNb25nb0NsaWVudChNT05HT0RCX1VSSSEsIHtcbiAgICAgIG1heFBvb2xTaXplOiAxMCxcbiAgICAgIG1pblBvb2xTaXplOiAyLFxuICAgICAgbWF4SWRsZVRpbWVNUzogNjAwMDAsXG4gICAgfSlcblxuICAgIGF3YWl0IGNsaWVudC5jb25uZWN0KClcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIOi/nuaOpeaIkOWKnycpXG5cbiAgICAvLyDojrflj5bmlbDmja7lupPlrp7kvotcbiAgICBjb25zdCBkYiA9IGNsaWVudC5kYihNT05HT0RCX0RCX05BTUUpXG5cbiAgICAvLyDnvJPlrZjov57mjqXlkozmlbDmja7lupPlrp7kvotcbiAgICBjYWNoZWRDbGllbnQgPSBjbGllbnRcbiAgICBjYWNoZWREYiA9IGRiXG5cbiAgICByZXR1cm4gZGJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbTW9uZ29EQl0g6L+e5o6l5aSx6LSlOicsIGVycm9yKVxuICAgIHRocm93IGVycm9yXG4gIH1cbn1cblxuLyoqXG4gKiDlhbPpl60gTW9uZ29EQiDov57mjqVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsb3NlREIoKTogUHJvbWlzZTx2b2lkPiB7XG4gIGlmIChjYWNoZWRDbGllbnQpIHtcbiAgICBhd2FpdCBjYWNoZWRDbGllbnQuY2xvc2UoKVxuICAgIGNhY2hlZENsaWVudCA9IG51bGxcbiAgICBjYWNoZWREYiA9IG51bGxcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIOi/nuaOpeW3suWFs+mXrScpXG4gIH1cbn1cblxuLyoqXG4gKiDojrflj5blvZPliY3mlbDmja7lupPlrp7kvotcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERCKCk6IERiIHtcbiAgaWYgKCFjYWNoZWREYikge1xuICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2Ugbm90IGNvbm5lY3RlZC4gQ2FsbCBjb25uZWN0REIoKSBmaXJzdC4nKVxuICB9XG4gIHJldHVybiBjYWNoZWREYlxufVxuXG4vKipcbiAqIOWIm+W7uuW/heimgeeahOmbhuWQiOWSjOe0ouW8lVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZURhdGFiYXNlKCk6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgY29ubmVjdERCKClcblxuICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0g5Yid5aeL5YyW5pWw5o2u5bqTLi4uJylcblxuICAgIC8vIOWIm+W7uiBzdWJzY3JpcHRpb25zIOmbhuWQiFxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkYi5jcmVhdGVDb2xsZWN0aW9uKCdzdWJzY3JpcHRpb25zJylcbiAgICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0gc3Vic2NyaXB0aW9ucyDpm4blkIjlt7LliJvlu7onKVxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSA0OCkge1xuICAgICAgICAvLyDpm4blkIjlt7LlrZjlnKhcbiAgICAgICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBzdWJzY3JpcHRpb25zIOmbhuWQiOW3suWtmOWcqCcpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOWIm+W7uiBzdWJzY3JpcHRpb25zIOe0ouW8lVxuICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3N1YnNjcmlwdGlvbnMnKS5jcmVhdGVJbmRleChcbiAgICAgIHsgdXNlckFkZHJlc3M6IDEgfSxcbiAgICAgIHsgdW5pcXVlOiB0cnVlIH1cbiAgICApXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBzdWJzY3JpcHRpb25zLnVzZXJBZGRyZXNzIOWUr+S4gOe0ouW8leW3suWIm+W7uicpXG5cbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdzdWJzY3JpcHRpb25zJykuY3JlYXRlSW5kZXgoeyBleHBpcmVzQXQ6IDEgfSlcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIHN1YnNjcmlwdGlvbnMuZXhwaXJlc0F0IOe0ouW8leW3suWIm+W7uicpXG5cbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdzdWJzY3JpcHRpb25zJykuY3JlYXRlSW5kZXgoeyBzdGF0dXM6IDEgfSlcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIHN1YnNjcmlwdGlvbnMuc3RhdHVzIOe0ouW8leW3suWIm+W7uicpXG5cbiAgICAvLyDliJvlu7ogY2hhdF9sb2dzIOmbhuWQiO+8iOWPr+mAie+8iVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkYi5jcmVhdGVDb2xsZWN0aW9uKCdjaGF0X2xvZ3MnKVxuICAgICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBjaGF0X2xvZ3Mg6ZuG5ZCI5bey5Yib5bu6JylcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gNDgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBjaGF0X2xvZ3Mg6ZuG5ZCI5bey5a2Y5ZyoJylcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IGVycm9yXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g5Yib5bu6IGNoYXRfbG9ncyDntKLlvJVcbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjaGF0X2xvZ3MnKS5jcmVhdGVJbmRleCh7IHVzZXJBZGRyZXNzOiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBjaGF0X2xvZ3MudXNlckFkZHJlc3Mg57Si5byV5bey5Yib5bu6JylcblxuICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NoYXRfbG9ncycpLmNyZWF0ZUluZGV4KHsgdGltZXN0YW1wOiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBjaGF0X2xvZ3MudGltZXN0YW1wIOe0ouW8leW3suWIm+W7uicpXG5cbiAgICAvLyDliJvlu7ogZ2FtZUNvbnRlbnQg6ZuG5ZCIXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGRiLmNyZWF0ZUNvbGxlY3Rpb24oJ2dhbWVDb250ZW50JylcbiAgICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0gZ2FtZUNvbnRlbnQg6ZuG5ZCI5bey5Yib5bu6JylcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gNDgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBnYW1lQ29udGVudCDpm4blkIjlt7LlrZjlnKgnKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDliJvlu7ogZ2FtZUNvbnRlbnQg57Si5byVXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbignZ2FtZUNvbnRlbnQnKS5jcmVhdGVJbmRleCh7IGNvbnRlbnRJZDogMSB9LCB7IHVuaXF1ZTogdHJ1ZSB9KVxuICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0gZ2FtZUNvbnRlbnQuY29udGVudElkIOWUr+S4gOe0ouW8leW3suWIm+W7uicpXG5cbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdnYW1lQ29udGVudCcpLmNyZWF0ZUluZGV4KHsgdXNlckFkZHJlc3M6IDEgfSlcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIGdhbWVDb250ZW50LnVzZXJBZGRyZXNzIOe0ouW8leW3suWIm+W7uicpXG5cbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdnYW1lQ29udGVudCcpLmNyZWF0ZUluZGV4KHsgZ2FtZVRpdGxlOiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBnYW1lQ29udGVudC5nYW1lVGl0bGUg57Si5byV5bey5Yib5bu6JylcblxuICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2dhbWVDb250ZW50JykuY3JlYXRlSW5kZXgoeyBjcmVhdGVkQXQ6IDEgfSlcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIGdhbWVDb250ZW50LmNyZWF0ZWRBdCDntKLlvJXlt7LliJvlu7onKVxuXG4gICAgLy8g5Yib5bu6IGRpdmlkZW5kV2l0aGRyYXdhbHMg6ZuG5ZCIXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGRiLmNyZWF0ZUNvbGxlY3Rpb24oJ2RpdmlkZW5kV2l0aGRyYXdhbHMnKVxuICAgICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBkaXZpZGVuZFdpdGhkcmF3YWxzIOmbhuWQiOW3suWIm+W7uicpXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yLmNvZGUgPT09IDQ4KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0gZGl2aWRlbmRXaXRoZHJhd2FscyDpm4blkIjlt7LlrZjlnKgnKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDliJvlu7ogZGl2aWRlbmRXaXRoZHJhd2FscyDntKLlvJVcbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdkaXZpZGVuZFdpdGhkcmF3YWxzJykuY3JlYXRlSW5kZXgoeyB3aXRoZHJhd2FsSWQ6IDEgfSwgeyB1bmlxdWU6IHRydWUgfSlcbiAgICBjb25zb2xlLmxvZygnW01vbmdvREJdIGRpdmlkZW5kV2l0aGRyYXdhbHMud2l0aGRyYXdhbElkIOWUr+S4gOe0ouW8leW3suWIm+W7uicpXG5cbiAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCdkaXZpZGVuZFdpdGhkcmF3YWxzJykuY3JlYXRlSW5kZXgoeyB1c2VyQWRkcmVzczogMSB9KVxuICAgIGNvbnNvbGUubG9nKCdbTW9uZ29EQl0gZGl2aWRlbmRXaXRoZHJhd2Fscy51c2VyQWRkcmVzcyDntKLlvJXlt7LliJvlu7onKVxuXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbignZGl2aWRlbmRXaXRoZHJhd2FscycpLmNyZWF0ZUluZGV4KHsgdHJhbnNhY3Rpb25IYXNoOiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBkaXZpZGVuZFdpdGhkcmF3YWxzLnRyYW5zYWN0aW9uSGFzaCDntKLlvJXlt7LliJvlu7onKVxuXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbignZGl2aWRlbmRXaXRoZHJhd2FscycpLmNyZWF0ZUluZGV4KHsgY3JlYXRlZEF0OiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBkaXZpZGVuZFdpdGhkcmF3YWxzLmNyZWF0ZWRBdCDntKLlvJXlt7LliJvlu7onKVxuXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbignZGl2aWRlbmRXaXRoZHJhd2FscycpLmNyZWF0ZUluZGV4KHsgc3RhdHVzOiAxIH0pXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSBkaXZpZGVuZFdpdGhkcmF3YWxzLnN0YXR1cyDntKLlvJXlt7LliJvlu7onKVxuXG4gICAgY29uc29sZS5sb2coJ1tNb25nb0RCXSDmlbDmja7lupPliJ3lp4vljJblrozmiJAnKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tNb25nb0RCXSDliJ3lp4vljJblpLHotKU6JywgZXJyb3IpXG4gICAgdGhyb3cgZXJyb3JcbiAgfVxufVxuXG4vKipcbiAqIOa4heeQhui/h+acn+eahOiuoumYhVxuICog5a6a5pyf6LCD55So5q2k5Ye95pWw5Yig6Zmk5bey6L+H5pyf55qE6K6i6ZiF6K6w5b2VXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbnVwRXhwaXJlZFN1YnNjcmlwdGlvbnMoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBkYiA9IGF3YWl0IGNvbm5lY3REQigpXG4gICAgY29uc3Qgbm93ID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMClcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3N1YnNjcmlwdGlvbnMnKS5kZWxldGVNYW55KHtcbiAgICAgIGV4cGlyZXNBdDogeyAkbHQ6IG5vdyB9LFxuICAgICAgc3RhdHVzOiAnaW5hY3RpdmUnLFxuICAgIH0pXG5cbiAgICBjb25zb2xlLmxvZyhgW01vbmdvREJdIOW3sua4heeQhiAke3Jlc3VsdC5kZWxldGVkQ291bnR9IOadoei/h+acn+iuoumYheiusOW9lWApXG4gICAgcmV0dXJuIHJlc3VsdC5kZWxldGVkQ291bnRcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbTW9uZ29EQl0g5riF55CG6L+H5pyf6K6i6ZiF5aSx6LSlOicsIGVycm9yKVxuICAgIHRocm93IGVycm9yXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsIk1PTkdPREJfVVJJIiwicHJvY2VzcyIsImVudiIsIk1PTkdPREJfREJfTkFNRSIsImNhY2hlZENsaWVudCIsImNhY2hlZERiIiwiY29ubmVjdERCIiwiY29uc29sZSIsImxvZyIsImNsaWVudCIsIm1heFBvb2xTaXplIiwibWluUG9vbFNpemUiLCJtYXhJZGxlVGltZU1TIiwiY29ubmVjdCIsImRiIiwiZXJyb3IiLCJjbG9zZURCIiwiY2xvc2UiLCJnZXREQiIsIkVycm9yIiwiaW5pdGlhbGl6ZURhdGFiYXNlIiwiY3JlYXRlQ29sbGVjdGlvbiIsImNvZGUiLCJjb2xsZWN0aW9uIiwiY3JlYXRlSW5kZXgiLCJ1c2VyQWRkcmVzcyIsInVuaXF1ZSIsImV4cGlyZXNBdCIsInN0YXR1cyIsInRpbWVzdGFtcCIsImNvbnRlbnRJZCIsImdhbWVUaXRsZSIsImNyZWF0ZWRBdCIsIndpdGhkcmF3YWxJZCIsInRyYW5zYWN0aW9uSGFzaCIsImNsZWFudXBFeHBpcmVkU3Vic2NyaXB0aW9ucyIsIm5vdyIsIk1hdGgiLCJmbG9vciIsIkRhdGUiLCJyZXN1bHQiLCJkZWxldGVNYW55IiwiJGx0IiwiZGVsZXRlZENvdW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/mongodb.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@ethersproject","vendor-chunks/bn.js","vendor-chunks/aes-js","vendor-chunks/hash.js","vendor-chunks/js-sha3","vendor-chunks/scrypt-js","vendor-chunks/bech32","vendor-chunks/inherits","vendor-chunks/minimalistic-assert"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubscription%2Factivate%2Froute&page=%2Fapi%2Fsubscription%2Factivate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubscription%2Factivate%2Froute.ts&appDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdaniel%2FCode%2F10_project%2FGame%2Fserver&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();