"use strict";(()=>{var e={};e.id=838,e.ids=[838],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7920:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>w,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>A,staticGenerationAsyncStorage:()=>g});var n={};o.r(n),o.d(n,{GET:()=>u,OPTIONS:()=>d});var r=o(9303),s=o(8716),a=o(670),i=o(7070),l=o(2021),c=o(5029);async function u(e){try{let t=e.nextUrl.searchParams,o=t.get("address"),n=Math.min(parseInt(t.get("limit")||"20"),100),r=Math.max(parseInt(t.get("skip")||"0"),0);if(!o)return console.warn("[Content List API] 缺少必需参数: address"),i.NextResponse.json({success:!1,error:"Missing required parameter: address"},{status:400});if(!(0,c.At)(o))return console.warn("[Content List API] 无效的钱包地址:",o),i.NextResponse.json({success:!1,error:"Invalid wallet address format"},{status:400});let s=(0,c.f0)(o);console.log("[Content List API] 查询用户内容，地址:",s,"分页:",{limit:n,skip:r});let a=await (0,l.uD)(),u=await a.collection("gameContent").countDocuments({userAddress:s}),d=await a.collection("gameContent").find({userAddress:s}).sort({createdAt:-1}).limit(n).skip(r).toArray();return console.log("[Content List API] 找到",d.length,"条内容，总共",u,"条"),i.NextResponse.json({success:!0,total:u,contents:d.map(e=>({contentId:e.contentId,gameTitle:e.gameTitle,title:e.title,description:e.description,status:e.status,queryCount:e.queryCount,rewardAmount:e.rewardAmount,rewardStatus:e.rewardStatus,createdAt:e.createdAt}))},{status:200})}catch(e){return console.error("[Content List API] 处理请求失败:",e),i.NextResponse.json({success:!1,error:"Failed to query content list",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}let p=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/content/list/route",pathname:"/api/content/list",filename:"route",bundlePath:"app/api/content/list/route"},resolvedPagePath:"/Users/daniel/Code/10_project/Game/server/app/api/content/list/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:A}=p,w="/api/content/list/route";function f(){return(0,a.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:g})}},5029:(e,t,o)=>{function n(e){return/^0x[a-fA-F0-9]{40}$/.test(e)}function r(e){if(!n(e))throw Error("Invalid address format");return e.toLowerCase()}o.d(t,{At:()=>n,f0:()=>r})},2021:(e,t,o)=>{o.d(t,{uD:()=>l});var n=o(8013);let r=process.env.MONGODB_URI||"mongodb://localhost:27017",s=process.env.MONGODB_DB_NAME||"game-ai",a=null,i=null;async function l(){if(a&&i)return console.log("[MongoDB] 使用缓存连接"),i;try{console.log("[MongoDB] 正在连接...");let e=new n.MongoClient(r,{maxPoolSize:10,minPoolSize:2,maxIdleTimeMS:6e4});await e.connect(),console.log("[MongoDB] 连接成功");let t=e.db(s);return a=e,i=t,t}catch(e){throw console.error("[MongoDB] 连接失败:",e),e}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),n=t.X(0,[789],()=>o(7920));module.exports=n})();